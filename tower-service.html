<!DOCTYPE html><html lang="en-us" class="__variable_bc0dcf scroll-smooth"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" href="/_next/static/media/7cba1811e3c25a15-s.p.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="stylesheet" href="/_next/static/css/cd219d613ad8989f.css" crossorigin="" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/959e61cd6bf7e234.css" crossorigin="" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/c1c99bc127b9f571.css" crossorigin="" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-ecd884431e5f35c6.js" crossorigin=""/><script src="/_next/static/chunks/fd9d1056-8aef1845bba99dc3.js" async="" crossorigin=""></script><script src="/_next/static/chunks/472-d0e0ddc81fc62ec9.js" async="" crossorigin=""></script><script src="/_next/static/chunks/main-app-e720945cf7a6a687.js" async="" crossorigin=""></script><script src="/_next/static/chunks/9da6db1e-fe005e7e52eb3467.js" async=""></script><script src="/_next/static/chunks/326-f0b929b9e51900a5.js" async=""></script><script src="/_next/static/chunks/app/layout-2ffae3625ca75b72.js" async=""></script><script src="/_next/static/chunks/app/(blog)/%5B...slug%5D/page-47a78e5a6d2fc851.js" async=""></script><title>Implementing the Tower Service Trait | Omar Abid - Personal Blog</title><meta name="description" content="Implementing the Tower Service Trait for WebAssembly."/><meta name="robots" content="index, follow"/><meta name="googlebot" content="index, follow, max-video-preview:-1, max-image-preview:large, max-snippet:-1"/><link rel="canonical" href="https://omarabid.com/tower-service"/><link rel="alternate" type="application/rss+xml" href="https://omarabid.com/feed.xml"/><meta property="og:title" content="Implementing the Tower Service Trait"/><meta property="og:description" content="Implementing the Tower Service Trait for WebAssembly."/><meta property="og:url" content="https://omarabid.com/tower-service"/><meta property="og:site_name" content="Omar Abid - Personal Blog"/><meta property="og:locale" content="en_US"/><meta property="og:type" content="article"/><meta property="article:published_time" content="2024-10-23T00:00:00.000Z"/><meta property="article:modified_time" content="2024-10-23T00:00:00.000Z"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:title" content="Implementing the Tower Service Trait"/><meta name="twitter:description" content="Implementing the Tower Service Trait for WebAssembly."/><meta name="next-size-adjust"/><link rel="apple-touch-icon" sizes="76x76" href="/favicon.svg"/><link rel="icon" type="image/png" sizes="32x32" href="/favicon.svg"/><link rel="icon" type="image/png" sizes="16x16" href="/favicon.svg"/><link rel="manifest" href="/static/favicons/site.webmanifest"/><link rel="mask-icon" href="/favicon.svg" color="#5bbad5"/><meta name="msapplication-TileColor" content="#000000"/><meta name="theme-color" media="(prefers-color-scheme: light)" content="#fff"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#000"/><link rel="alternate" type="application/rss+xml" href="/feed.xml"/><script src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js" crossorigin="" noModule=""></script></head><body class="m-auto max-w-2xl dark:text-gray-100"><script>!function(){try{var d=document.documentElement,c=d.classList;c.remove('light','dark');var e=localStorage.getItem('theme');if('system'===e||(!e&&true)){var t='(prefers-color-scheme: dark)',m=window.matchMedia(t);if(m.media!==t||m.matches){d.style.colorScheme = 'dark';c.add('dark')}else{d.style.colorScheme = 'light';c.add('light')}}else if(e){c.add(e|| '')}if(e==='light'||e==='dark')d.style.colorScheme=e}catch(e){}}()</script><main class="min-h-screen p-6 pt-3 md:pt-6"><header class="mb-5 flex items-center md:mb-10"><span class="text-md whitespace-nowrap font-bold md:text-lg"><a class="-ml-2 rounded-sm p-2 transition-[background-color] hover:bg-gray-200 active:bg-gray-300 dark:hover:bg-[#313131] dark:active:bg-[#242424]" href="/">Omar Abid</a></span><nav class="flex grow items-center justify-end gap-1 font-mono text-xs md:gap-3"><a class="inline-flex rounded-sm p-2 transition-[background-color] hover:bg-gray-200 active:bg-gray-300 dark:hover:bg-[#313131] dark:active:bg-[#242424]" href="/about">About</a></nav></header><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","headline":"Implementing the Tower Service Trait","datePublished":"2024-10-23T00:00:00.000Z","dateModified":"2024-10-23T00:00:00.000Z","description":"Implementing the Tower Service Trait for WebAssembly.","url":"https://omarabid.com/tower-service","author":[{"@type":"Person"}]}</script><section class="mx-auto max-w-3xl px-4 sm:px-6 xl:max-w-5xl xl:px-0"><div class="fixed bottom-8 right-8 hidden flex-col gap-3 md:hidden"><button aria-label="Scroll To Top" class="rounded-full bg-gray-200 p-2 text-gray-500 transition-all hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-400 dark:hover:bg-gray-600"><svg height="24" viewBox="0 0 48 48" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M14.83 30.83l9.17-9.17 9.17 9.17 2.83-2.83-12-12-12 12z"></path><path d="M0 0h48v48h-48z" fill="none"></path></svg></button></div><div class="xl:divide-y xl:divide-gray-200 xl:dark:divide-gray-700"><header class="pt-6 xl:pb-6"><h1 class="text-2xl font-bold mb-1 dark:text-gray-100">Implementing the Tower Service Trait</h1><p class="font-mono flex text-xs text-gray-500 dark:text-gray-500"><span class="flex-grow"><span class="hidden md:inline"><span><a href="https://github.com/omarabid" class="hover:text-gray-800 dark:hover:text-gray-400" target="_blank">@omarabid</a></span><span class="mx-2">|</span></span><span><time dateTime="2024-10-23T00:00:00.000Z">Wednesday, October 23, 2024</time></span></span><span class="pr-1.5"></span></p></header><article class="text-gray-800 dark:text-gray-300 mb-10"><div class="prose max-w-none pb-8 pt-10 dark:prose-invert"><p>A few years back, <a target="_blank" rel="noopener noreferrer" href="https://tokio.rs">Tokio</a> introduced the <a target="_blank" rel="noopener noreferrer" href="https://tokio.rs/#tk-lib-tower">Tower</a> library. The aim is to create a set of reusable traits, structs, and functions for building network services. For an in-depth understanding of the rationale behind it (which I highly recommend reading first), check out: <a target="_blank" rel="noopener noreferrer" href="https://tokio.rs/blog/2021-05-14-inventing-the-service-trait">Inventing the Service trait</a>.</p><p>However, there is limited documentation or guidance on implementing the trait itself. First, let&#x27;s recap a scenario where such an implementation is necessary:</p><ol><li>You have a library that accepts a client compatible with Tower&#x27;s Service trait.</li><li>There isn&#x27;t an existing implementation for such a client. This can be the case on <em>untypical</em> platforms, like WebAssembly.</li></ol><h3 id="the-library"><a href="#the-library" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>The Library</h3><p>The library in question is <a target="_blank" rel="noopener noreferrer" href="https://github.com/XAMPPRocky/octocrab">Octocrab</a>. Octocrab includes networking support by default via Tokio, which does not support WebAssembly. It does, however, allow the use of a custom client.</p><p>Full source: <a target="_blank" rel="noopener noreferrer" href="https://github.com/XAMPPRocky/octocrab/blob/main/examples/custom_client.rs">custom_client.rs</a></p><div class="relative"><pre><code class="language-rust code-highlight"><span class="code-line">    <span class="token keyword">let</span> client <span class="token operator">=</span> <span class="token namespace">hyper_util<span class="token punctuation">::</span>client<span class="token punctuation">::</span>legacy<span class="token punctuation">::</span></span><span class="token class-name">Client</span><span class="token punctuation">::</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token namespace">hyper_util<span class="token punctuation">::</span>rt<span class="token punctuation">::</span></span><span class="token class-name">TokioExecutor</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line">        <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span>connector<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token keyword">let</span> octocrab <span class="token operator">=</span> <span class="token class-name">OctocrabBuilder</span><span class="token punctuation">::</span><span class="token function">new_empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">        <span class="token punctuation">.</span><span class="token function">with_service</span><span class="token punctuation">(</span>client<span class="token punctuation">)</span>
</span><span class="code-line">        <span class="token punctuation">.</span><span class="token function">with_layer</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token class-name">BaseUriLayer</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token class-name">Uri</span><span class="token punctuation">::</span><span class="token function">from_static</span><span class="token punctuation">(</span>
</span><span class="code-line">            <span class="token string">&quot;https://api.github.com&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">        <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line">        <span class="token punctuation">.</span><span class="token function">with_layer</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token class-name">ExtraHeadersLayer</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token class-name">Arc</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token macro property">vec!</span><span class="token punctuation">[</span><span class="token punctuation">(</span>
</span><span class="code-line">            <span class="token constant">USER_AGENT</span><span class="token punctuation">,</span>
</span><span class="code-line">            <span class="token string">&quot;octocrab&quot;</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">        <span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line">        <span class="token punctuation">.</span><span class="token function">with_auth</span><span class="token punctuation">(</span><span class="token class-name">AuthState</span><span class="token punctuation">::</span><span class="token class-name">None</span><span class="token punctuation">)</span>
</span><span class="code-line">        <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">        <span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></code></pre></div><p>Now, we just need to employ a different client that supports our target platform.</p><h3 id="the-platform"><a href="#the-platform" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>The Platform</h3><p>The platform is Cloudflare Workers, which uses WebAssembly to execute compiled Rust code. Where WASM is executed here matters: Cloudflare Workers run on a customized V8 engine and does not support <a target="_blank" rel="noopener noreferrer" href="https://github.com/WebAssembly/WASI">WASI</a> (which is not a finalized standard yet). As such, your code won&#x27;t have access to regular networking APIs.</p><p>HTTP requests here are made using the <a target="_blank" rel="noopener noreferrer" href="https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API">Fetch API</a>, which is a JavaScript API for making network requests. This API is exposed to Rust via the <a target="_blank" rel="noopener noreferrer" href="https://rustwasm.github.io/docs/wasm-bindgen/">wasm-bindgen</a> crate. Cloudflare offers a <a target="_blank" rel="noopener noreferrer" href="https://github.com/cloudflare/workers-rs/tree/main">worker crate</a>, which exposes some functionalities for making HTTP requests.</p><h3 id="the-implementation"><a href="#the-implementation" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>The implementation</h3><p>The trait could be implemented to any struct but since there isn&#x27;t an actual &quot;client&quot; in the worker crate, I made a dedicated struct for it. The bulk of the implementation is in the <code>call</code> method and the bulk of the work is converting between the <code>http</code> crate types and the JavaScript ones.</p><div class="relative"><pre><code class="language-rust code-highlight"><span class="code-line"><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>convert<span class="token punctuation">::</span></span><span class="token class-name">TryInto</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>task<span class="token punctuation">::</span></span><span class="token class-name">Context</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token namespace">future<span class="token punctuation">::</span></span><span class="token class-name">Future</span><span class="token punctuation">,</span> <span class="token namespace">pin<span class="token punctuation">::</span></span><span class="token class-name">Pin</span><span class="token punctuation">,</span> <span class="token namespace">task<span class="token punctuation">::</span></span><span class="token class-name">Poll</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">use</span> <span class="token keyword">crate</span><span class="token namespace module-declaration"><span class="token punctuation">::</span>send<span class="token punctuation">::</span></span><span class="token class-name">SendFuture</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token keyword">use</span> <span class="token keyword">crate</span><span class="token punctuation">::</span><span class="token punctuation">{</span><span class="token class-name">Body</span><span class="token punctuation">,</span> <span class="token class-name">Error</span><span class="token punctuation">,</span> <span class="token class-name">Fetch</span><span class="token punctuation">,</span> <span class="token class-name">HttpResponse</span><span class="token punctuation">,</span> <span class="token class-name">Request</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token comment">/// A Tower-compatible Service implementation for Cloudflare Workers.</span>
</span><span class="code-line"><span class="token comment">///</span>
</span><span class="code-line"><span class="token comment">/// This struct implements the `tower::Service` trait, allowing it to be used</span>
</span><span class="code-line"><span class="token comment">/// as a service in the Tower middleware ecosystem.</span>
</span><span class="code-line"><span class="token attr-name attribute">#[derive(Debug, Default, Clone, Copy)]</span>
</span><span class="code-line"><span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token class-name type-definition">Service</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">impl</span><span class="token operator">&lt;</span><span class="token class-name">B</span><span class="token punctuation">:</span> <span class="token namespace">http_body<span class="token punctuation">::</span></span><span class="token class-name">Body</span><span class="token operator">&lt;</span><span class="token class-name">Data</span> <span class="token operator">=</span> <span class="token namespace">bytes<span class="token punctuation">::</span></span><span class="token class-name">Bytes</span><span class="token operator">&gt;</span> <span class="token operator">+</span> <span class="token class-name">Clone</span> <span class="token operator">+</span> <span class="token lifetime-annotation symbol">&#x27;static</span><span class="token operator">&gt;</span> <span class="token namespace">tower<span class="token punctuation">::</span></span><span class="token class-name">Service</span><span class="token operator">&lt;</span><span class="token namespace">http<span class="token punctuation">::</span></span><span class="token class-name">Request</span><span class="token operator">&lt;</span><span class="token class-name">B</span><span class="token operator">&gt;&gt;</span>
</span><span class="code-line">    <span class="token keyword">for</span> <span class="token class-name">Service</span>
</span><span class="code-line"><span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">type</span> <span class="token class-name type-definition">Response</span> <span class="token operator">=</span> <span class="token namespace">http<span class="token punctuation">::</span></span><span class="token class-name">Response</span><span class="token operator">&lt;</span><span class="token class-name">Body</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token keyword">type</span> <span class="token class-name type-definition">Error</span> <span class="token operator">=</span> <span class="token class-name">Error</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token keyword">type</span> <span class="token class-name type-definition">Future</span> <span class="token operator">=</span>
</span><span class="code-line">        <span class="token class-name">Pin</span><span class="token operator">&lt;</span><span class="token class-name">Box</span><span class="token operator">&lt;</span><span class="token keyword">dyn</span> <span class="token class-name">Future</span><span class="token operator">&lt;</span><span class="token class-name">Output</span> <span class="token operator">=</span> <span class="token namespace">std<span class="token punctuation">::</span>result<span class="token punctuation">::</span></span><span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token keyword">Self</span><span class="token punctuation">::</span><span class="token class-name">Response</span><span class="token punctuation">,</span> <span class="token keyword">Self</span><span class="token punctuation">::</span><span class="token class-name">Error</span><span class="token operator">&gt;&gt;</span> <span class="token operator">+</span> <span class="token class-name">Send</span><span class="token operator">&gt;&gt;</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token keyword">fn</span> <span class="token function function-definition">poll_ready</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">,</span> _cx<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token class-name">Context</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">&#x27;_</span><span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Poll</span><span class="token operator">&lt;</span><span class="token namespace">std<span class="token punctuation">::</span>result<span class="token punctuation">::</span></span><span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">Self</span><span class="token punctuation">::</span><span class="token class-name">Error</span><span class="token operator">&gt;&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token class-name">Poll</span><span class="token punctuation">::</span><span class="token class-name">Ready</span><span class="token punctuation">(</span><span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token keyword">fn</span> <span class="token function function-definition">call</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">,</span> req<span class="token punctuation">:</span> <span class="token namespace">http<span class="token punctuation">::</span></span><span class="token class-name">Request</span><span class="token operator">&lt;</span><span class="token class-name">B</span><span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token keyword">Self</span><span class="token punctuation">::</span><span class="token class-name">Future</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token comment">// Convert a http Request to a worker Request</span>
</span><span class="code-line">        <span class="token keyword">let</span> worker_request<span class="token punctuation">:</span> <span class="token class-name">Request</span> <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">try_into</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">        <span class="token comment">// Send the request with Fetch and receive a Future</span>
</span><span class="code-line">        <span class="token keyword">let</span> fut <span class="token operator">=</span> <span class="token class-name">Fetch</span><span class="token punctuation">::</span><span class="token class-name">Request</span><span class="token punctuation">(</span>worker_request<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">        <span class="token comment">// Convert the Future output to a HttpResponse</span>
</span><span class="code-line">        <span class="token keyword">let</span> http_response <span class="token operator">=</span>
</span><span class="code-line">            <span class="token keyword">async</span> <span class="token punctuation">{</span> <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token class-name">TryInto</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token class-name">HttpResponse</span><span class="token operator">&gt;</span><span class="token punctuation">::</span><span class="token function">try_into</span><span class="token punctuation">(</span>fut<span class="token punctuation">.</span><span class="token keyword">await</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">        <span class="token comment">// Wrap the Future in a SendFuture to make it Send</span>
</span><span class="code-line">        <span class="token keyword">let</span> wrapped <span class="token operator">=</span> <span class="token class-name">SendFuture</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span>http_response<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">        <span class="token class-name">Box</span><span class="token punctuation">::</span><span class="token function">pin</span><span class="token punctuation">(</span>wrapped<span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p>Full Pull Request: <a target="_blank" rel="noopener noreferrer" href="https://github.com/cloudflare/workers-rs/pull/659">Tower Service Trait implementation</a></p><h3 id="custom-executors-and-buffer"><a href="#custom-executors-and-buffer" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Custom executors and Buffer</h3><p>While the <code>call</code> method is responsible for receiving requests and sending responses, a runtime where it will be executed is needed. This is a non-issue if the environment supports Tokio; otherwise, you need to provide the runtime.</p><p>The method <a target="_blank" rel="noopener noreferrer" href="https://docs.rs/tower/0.5.1/tower/buffer/struct.Buffer.html#method.pair">Buffer::pair</a> provides a way to inject the <code>call</code> method into your own runtime.</p><blockquote><p>Creates a new Buffer wrapping service, but returns the background worker. This is useful if you do not want to spawn directly onto the tokio runtime but instead want to use your own executor. This will return the Buffer and the background Worker that you can then spawn.</p></blockquote><p>The runtime in our case is a simple executor. It is a closure that accepts the background worker returned from <code>Buffer::pair</code> as an argument.</p><div class="relative"><pre><code class="language-rust code-highlight"><span class="code-line">executor<span class="token punctuation">:</span> <span class="token class-name">Box</span><span class="token operator">&lt;</span><span class="token keyword">dyn</span> <span class="token class-name">Fn</span><span class="token punctuation">(</span><span class="token class-name">Pin</span><span class="token operator">&lt;</span><span class="token class-name">Box</span><span class="token operator">&lt;</span><span class="token keyword">dyn</span> <span class="token class-name">Future</span><span class="token operator">&lt;</span><span class="token class-name">Output</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span>
</span></code></pre></div><p>Since Octocrab didn&#x27;t support that, a few changes had to be made. Mainly, using <code>Buffer::pair</code> instead of <code>Buffer::new</code>, accepting the executor closure, and passing the worker to it.</p><div class="relative"><pre><code class="language-rust code-highlight"><span class="code-line"><span class="token comment">/// Creates a new `Octocrab` with a custom executor</span>
</span><span class="code-line"><span class="token keyword">fn</span> <span class="token function function-definition">new_with_executor</span><span class="token operator">&lt;</span><span class="token class-name">S</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>
</span><span class="code-line">	service<span class="token punctuation">:</span> <span class="token class-name">S</span><span class="token punctuation">,</span>
</span><span class="code-line">	auth_state<span class="token punctuation">:</span> <span class="token class-name">AuthState</span><span class="token punctuation">,</span>
</span><span class="code-line">	executor<span class="token punctuation">:</span> <span class="token class-name">Box</span><span class="token operator">&lt;</span><span class="token keyword">dyn</span> <span class="token class-name">Fn</span><span class="token punctuation">(</span><span class="token class-name">Pin</span><span class="token operator">&lt;</span><span class="token class-name">Box</span><span class="token operator">&lt;</span><span class="token keyword">dyn</span> <span class="token class-name">Future</span><span class="token operator">&lt;</span><span class="token class-name">Output</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
</span><span class="code-line"><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token keyword">Self</span>
</span><span class="code-line"><span class="token keyword">where</span>
</span><span class="code-line">	<span class="token class-name">S</span><span class="token punctuation">:</span> <span class="token class-name">Service</span><span class="token operator">&lt;</span><span class="token class-name">Request</span><span class="token operator">&lt;</span><span class="token class-name">OctoBody</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> <span class="token class-name">Response</span> <span class="token operator">=</span> <span class="token class-name">Response</span><span class="token operator">&lt;</span><span class="token class-name">BoxBody</span><span class="token operator">&lt;</span><span class="token class-name">Bytes</span><span class="token punctuation">,</span> <span class="token keyword">crate</span><span class="token punctuation">::</span><span class="token class-name">Error</span><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span>
</span><span class="code-line">		<span class="token operator">+</span> <span class="token class-name">Send</span>
</span><span class="code-line">		<span class="token operator">+</span> <span class="token lifetime-annotation symbol">&#x27;static</span><span class="token punctuation">,</span>
</span><span class="code-line">	<span class="token class-name">S</span><span class="token punctuation">::</span><span class="token class-name">Future</span><span class="token punctuation">:</span> <span class="token class-name">Send</span> <span class="token operator">+</span> <span class="token lifetime-annotation symbol">&#x27;static</span><span class="token punctuation">,</span>
</span><span class="code-line">	<span class="token class-name">S</span><span class="token punctuation">::</span><span class="token class-name">Error</span><span class="token punctuation">:</span> <span class="token class-name">Into</span><span class="token operator">&lt;</span><span class="token class-name">BoxError</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
</span><span class="code-line"><span class="token punctuation">{</span>
</span><span class="code-line">	<span class="token comment">// Use Buffer pair to return the background worker</span>
</span><span class="code-line">	<span class="token keyword">let</span> <span class="token punctuation">(</span>service<span class="token punctuation">,</span> worker<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token class-name">Buffer</span><span class="token punctuation">::</span><span class="token function">pair</span><span class="token punctuation">(</span><span class="token class-name">BoxService</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span>service<span class="token punctuation">.</span><span class="token function">map_err</span><span class="token punctuation">(</span><span class="token class-name">Into</span><span class="token punctuation">::</span>into<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">	<span class="token comment">// Execute the background worker with the custom executor</span>
</span><span class="code-line">	<span class="token function">executor</span><span class="token punctuation">(</span><span class="token class-name">Box</span><span class="token punctuation">::</span><span class="token function">pin</span><span class="token punctuation">(</span>worker<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">	<span class="token keyword">Self</span> <span class="token punctuation">{</span>
</span><span class="code-line">		client<span class="token punctuation">:</span> service<span class="token punctuation">,</span>
</span><span class="code-line">		auth_state<span class="token punctuation">,</span>
</span><span class="code-line">	<span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p>Full Pull Request: <a target="_blank" rel="noopener noreferrer" href="https://github.com/XAMPPRocky/octocrab/pull/728">Custom executor for Wasm Support</a></p><h3 id="usage-with-workers"><a href="#usage-with-workers" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Usage with workers</h3><p>Finally, we get to the part where we use this with workers. First, we need to create the executor. It must capture the context, so make sure to expose it before. Then, we call the <code>wait_until</code> function and pass the worker to it. The <a target="_blank" rel="noopener noreferrer" href="https://docs.rs/worker/latest/worker/struct.Context.html#method.wait_until">wait_until</a> function will start a new parallel thread to execute the worker.</p><div class="relative"><pre><code class="language-rust code-highlight"><span class="code-line"><span class="token keyword">let</span> my_executor <span class="token operator">=</span> <span class="token keyword">move</span> <span class="token closure-params"><span class="token punctuation closure-punctuation">|</span>worker<span class="token punctuation">:</span> <span class="token class-name">Pin</span><span class="token operator">&lt;</span><span class="token class-name">Box</span><span class="token operator">&lt;</span><span class="token keyword">dyn</span> <span class="token class-name">Future</span><span class="token operator">&lt;</span><span class="token class-name">Output</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span><span class="token punctuation closure-punctuation">|</span></span> <span class="token punctuation">{</span>
</span><span class="code-line">	context<span class="token punctuation">.</span><span class="token function">wait_until</span><span class="token punctuation">(</span>worker<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span><span class="token punctuation">;</span>
</span></code></pre></div><p>And pass both the service and the executor to OctocrabBuilder.</p><div class="relative"><pre><code class="language-rust code-highlight"><span class="code-line"><span class="token keyword">let</span> octocrabis <span class="token operator">=</span> <span class="token namespace">octocrab<span class="token punctuation">::</span></span><span class="token class-name">OctocrabBuilder</span><span class="token punctuation">::</span><span class="token function">new_empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">	<span class="token punctuation">.</span><span class="token function">with_service</span><span class="token punctuation">(</span>service<span class="token punctuation">)</span>
</span><span class="code-line">	<span class="token punctuation">.</span><span class="token function">with_executor</span><span class="token punctuation">(</span><span class="token class-name">Box</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span>my_executor<span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line">	<span class="token punctuation">...</span>             
</span></code></pre></div><div class="my-8 w-full rounded-lg bg-gray-50 px-4 py-8 dark:bg-gray-800"><div class="mx-auto max-w-2xl"><h3 class="mb-2 text-xl font-bold text-gray-900 dark:text-white">Subscribe to the Newsletter</h3><p class="mb-4 text-gray-600 dark:text-gray-300">Get the latest posts from this blog delivered to your inbox. No spam.</p><form class="space-y-4"><div class="flex gap-2"><input type="email" placeholder="Enter your email" required="" class="flex-1 border border-gray-300 bg-white px-4 py-2 text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-500 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-100" value=""/><button type="submit" class="bg-blue-600 px-6 py-2 text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50">Subscribe</button></div></form></div></div></div></article></div></section></main><footer class="mt-3 flex p-6 pb-6 pt-3 text-center font-mono text-xs text-gray-500 dark:text-gray-400"><div class="grow text-left">Omar Abid (<a class="border-b border-gray-300 text-gray-600 transition-[border-color] hover:border-gray-600 dark:border-gray-500 dark:text-white dark:hover:border-white " target="_blank" href="https://github.com/omarabid">@omarabid</a>)</div><div></div></footer><script src="/_next/static/chunks/webpack-ecd884431e5f35c6.js" crossorigin="" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0]);self.__next_f.push([2,null])</script><script>self.__next_f.push([1,"1:HL[\"/_next/static/media/7cba1811e3c25a15-s.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n2:HL[\"/_next/static/css/cd219d613ad8989f.css\",\"style\",{\"crossOrigin\":\"\"}]\n3:HL[\"/_next/static/css/959e61cd6bf7e234.css\",\"style\",{\"crossOrigin\":\"\"}]\n0:\"$L4\"\n"])</script><script>self.__next_f.push([1,"5:HL[\"/_next/static/css/c1c99bc127b9f571.css\",\"style\",{\"crossOrigin\":\"\"}]\n"])</script><script>self.__next_f.push([1,"6:I[3728,[],\"\"]\n8:I[9928,[],\"\"]\n9:I[1087,[\"878\",\"static/chunks/9da6db1e-fe005e7e52eb3467.js\",\"326\",\"static/chunks/326-f0b929b9e51900a5.js\",\"185\",\"static/chunks/app/layout-2ffae3625ca75b72.js\"],\"CSPostHogProvider\"]\na:I[7821,[\"878\",\"static/chunks/9da6db1e-fe005e7e52eb3467.js\",\"326\",\"static/chunks/326-f0b929b9e51900a5.js\",\"185\",\"static/chunks/app/layout-2ffae3625ca75b72.js\"],\"ThemeProviders\"]\nb:I[8326,[\"326\",\"static/chunks/326-f0b929b9e51900a5.js\",\"202\",\"static/chunks/app/(blog)/%5B...slug%5D/page-47a78e5a6d2f"])</script><script>self.__next_f.push([1,"c851.js\"],\"\"]\nc:I[5235,[\"878\",\"static/chunks/9da6db1e-fe005e7e52eb3467.js\",\"326\",\"static/chunks/326-f0b929b9e51900a5.js\",\"185\",\"static/chunks/app/layout-2ffae3625ca75b72.js\"],\"\"]\nd:I[6954,[],\"\"]\ne:I[7264,[],\"\"]\n"])</script><script>self.__next_f.push([1,"4:[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/cd219d613ad8989f.css\",\"precedence\":\"next\",\"crossOrigin\":\"\"}],[\"$\",\"link\",\"1\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/959e61cd6bf7e234.css\",\"precedence\":\"next\",\"crossOrigin\":\"\"}]],[\"$\",\"$L6\",null,{\"buildId\":\"8A17WgayQp_T-PygQTLuw\",\"assetPrefix\":\"\",\"initialCanonicalUrl\":\"/tower-service\",\"initialTree\":[\"\",{\"children\":[\"(blog)\",{\"children\":[[\"slug\",\"tower-service\",\"c\"],{\"children\":[\"__PAGE__?{\\\"slug\\\":[\\\"tower-service\\\"]}\",{}]}]}]},\"$undefined\",\"$undefined\",true],\"initialHead\":[false,\"$L7\"],\"globalErrorComponent\":\"$8\",\"children\":[null,[\"$\",\"html\",null,{\"lang\":\"en-us\",\"className\":\"__variable_bc0dcf scroll-smooth\",\"suppressHydrationWarning\":true,\"children\":[[\"$\",\"link\",null,{\"rel\":\"apple-touch-icon\",\"sizes\":\"76x76\",\"href\":\"/favicon.svg\"}],[\"$\",\"link\",null,{\"rel\":\"icon\",\"type\":\"image/png\",\"sizes\":\"32x32\",\"href\":\"/favicon.svg\"}],[\"$\",\"link\",null,{\"rel\":\"icon\",\"type\":\"image/png\",\"sizes\":\"16x16\",\"href\":\"/favicon.svg\"}],[\"$\",\"link\",null,{\"rel\":\"manifest\",\"href\":\"/static/favicons/site.webmanifest\"}],[\"$\",\"link\",null,{\"rel\":\"mask-icon\",\"href\":\"/favicon.svg\",\"color\":\"#5bbad5\"}],[\"$\",\"meta\",null,{\"name\":\"msapplication-TileColor\",\"content\":\"#000000\"}],[\"$\",\"meta\",null,{\"name\":\"theme-color\",\"media\":\"(prefers-color-scheme: light)\",\"content\":\"#fff\"}],[\"$\",\"meta\",null,{\"name\":\"theme-color\",\"media\":\"(prefers-color-scheme: dark)\",\"content\":\"#000\"}],[\"$\",\"link\",null,{\"rel\":\"alternate\",\"type\":\"application/rss+xml\",\"href\":\"/feed.xml\"}],[\"$\",\"$L9\",null,{\"children\":[\"$\",\"body\",null,{\"className\":\"m-auto max-w-2xl dark:text-gray-100\",\"children\":[\"$\",\"$La\",null,{\"children\":[[\"$\",\"main\",null,{\"className\":\"min-h-screen p-6 pt-3 md:pt-6\",\"children\":[[\"$\",\"header\",null,{\"className\":\"mb-5 flex items-center md:mb-10\",\"children\":[[\"$\",\"span\",null,{\"className\":\"text-md whitespace-nowrap font-bold md:text-lg\",\"children\":[\"$\",\"$Lb\",null,{\"href\":\"/\",\"className\":\"-ml-2 rounded-sm p-2 transition-[background-color] hover:bg-gray-200 active:bg-gray-300 dark:hover:bg-[#313131] dark:active:bg-[#242424]\",\"children\":\"Omar Abid\"}]}],[\"$\",\"nav\",null,{\"className\":\"flex grow items-center justify-end gap-1 font-mono text-xs md:gap-3\",\"children\":[[\"$\",\"$Lc\",null,{}],[\"$\",\"a\",null,{\"className\":\"inline-flex rounded-sm p-2 transition-[background-color] hover:bg-gray-200 active:bg-gray-300 dark:hover:bg-[#313131] dark:active:bg-[#242424]\",\"href\":\"/about\",\"children\":\"About\"}]]}]]}],[\"$\",\"$Ld\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"loadingScripts\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$Le\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[\"$\",\"div\",null,{\"className\":\"flex flex-col items-start justify-start md:mt-24 md:flex-row md:items-center md:justify-center md:space-x-6\",\"children\":[[\"$\",\"div\",null,{\"className\":\"space-x-2 pb-8 pt-6 md:space-y-5\",\"children\":[\"$\",\"h1\",null,{\"className\":\"text-6xl font-extrabold leading-9 tracking-tight text-gray-900 dark:text-gray-100 md:border-r-2 md:px-6 md:text-8xl md:leading-14\",\"children\":\"404\"}]}],[\"$\",\"div\",null,{\"className\":\"max-w-md\",\"children\":[[\"$\",\"p\",null,{\"className\":\"mb-4 text-xl font-bold leading-normal md:text-2xl\",\"children\":\"Sorry we couldn't find this page.\"}],[\"$\",\"p\",null,{\"className\":\"mb-8\",\"children\":\"But dont worry, you can find plenty of other things on our homepage.\"}],[\"$\",\"$Lb\",null,{\"href\":\"/\",\"className\":\"focus:shadow-outline-blue inline rounded-lg border border-transparent bg-blue-600 px-4 py-2 text-sm font-medium leading-5 text-white shadow transition-colors duration-150 hover:bg-blue-700 focus:outline-none dark:hover:bg-blue-500\",\"children\":\"Back to homepage\"}]]}]]}],\"notFoundStyles\":[],\"initialChildNode\":[\"$\",\"$Ld\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"(blog)\",\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"loadingScripts\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$Le\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"initialChildNode\":[\"$\",\"$Ld\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"(blog)\",\"children\",[\"slug\",\"tower-service\",\"c\"],\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"loadingScripts\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$Le\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"initialChildNode\":[\"$Lf\",\"$L10\",null],\"childPropSegment\":\"__PAGE__?{\\\"slug\\\":[\\\"tower-service\\\"]}\",\"styles\":[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/c1c99bc127b9f571.css\",\"precedence\":\"next\",\"crossOrigin\":\"\"}]]}],\"childPropSegment\":[\"slug\",\"tower-service\",\"c\"],\"styles\":null}],\"childPropSegment\":\"(blog)\",\"styles\":null}]]}],[\"$\",\"footer\",null,{\"className\":\"mt-3 flex p-6 pb-6 pt-3 text-center font-mono text-xs text-gray-500 dark:text-gray-400\",\"children\":[[\"$\",\"div\",null,{\"className\":\"grow text-left\",\"children\":[\"Omar Abid (\",[\"$\",\"a\",null,{\"className\":\"border-b border-gray-300 text-gray-600 transition-[border-color] hover:border-gray-600 dark:border-gray-500 dark:text-white dark:hover:border-white \",\"target\":\"_blank\",\"href\":\"https://github.com/omarabid\",\"children\":\"@omarabid\"}],\")\"]}],[\"$\",\"div\",null,{}]]}]]}]}]}]]}],null]}]]\n"])</script><script>self.__next_f.push([1,"11:I[1514,[\"326\",\"static/chunks/326-f0b929b9e51900a5.js\",\"202\",\"static/chunks/app/(blog)/%5B...slug%5D/page-47a78e5a6d2fc851.js\"],\"\"]\n12:I[2529,[\"326\",\"static/chunks/326-f0b929b9e51900a5.js\",\"202\",\"static/chunks/app/(blog)/%5B...slug%5D/page-47a78e5a6d2fc851.js\"],\"\"]\n13:I[6598,[\"326\",\"static/chunks/326-f0b929b9e51900a5.js\",\"202\",\"static/chunks/app/(blog)/%5B...slug%5D/page-47a78e5a6d2fc851.js\"],\"\"]\n"])</script><script>self.__next_f.push([1,"10:[[\"$\",\"script\",null,{\"type\":\"application/ld+json\",\"dangerouslySetInnerHTML\":{\"__html\":\"{\\\"@context\\\":\\\"https://schema.org\\\",\\\"@type\\\":\\\"BlogPosting\\\",\\\"headline\\\":\\\"Implementing the Tower Service Trait\\\",\\\"datePublished\\\":\\\"2024-10-23T00:00:00.000Z\\\",\\\"dateModified\\\":\\\"2024-10-23T00:00:00.000Z\\\",\\\"description\\\":\\\"Implementing the Tower Service Trait for WebAssembly.\\\",\\\"url\\\":\\\"https://omarabid.com/tower-service\\\",\\\"author\\\":[{\\\"@type\\\":\\\"Person\\\"}]}\"}}],[\"$\",\"section\",null,{\"className\":\"mx-auto max-w-3xl px-4 sm:px-6 xl:max-w-5xl xl:px-0\",\"children\":[[\"$\",\"$L11\",null,{}],[\"$\",\"div\",null,{\"className\":\"xl:divide-y xl:divide-gray-200 xl:dark:divide-gray-700\",\"children\":[[\"$\",\"header\",null,{\"className\":\"pt-6 xl:pb-6\",\"children\":[[\"$\",\"h1\",null,{\"className\":\"text-2xl font-bold mb-1 dark:text-gray-100\",\"children\":\"Implementing the Tower Service Trait\"}],[\"$\",\"p\",null,{\"className\":\"font-mono flex text-xs text-gray-500 dark:text-gray-500\",\"children\":[[\"$\",\"span\",null,{\"className\":\"flex-grow\",\"children\":[[\"$\",\"span\",null,{\"className\":\"hidden md:inline\",\"children\":[[\"$\",\"span\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"https://github.com/omarabid\",\"className\":\"hover:text-gray-800 dark:hover:text-gray-400\",\"target\":\"_blank\",\"children\":\"@omarabid\"}]}],[\"$\",\"span\",null,{\"className\":\"mx-2\",\"children\":\"|\"}]]}],[\"$\",\"span\",null,{\"children\":[\"$\",\"time\",null,{\"dateTime\":\"2024-10-23T00:00:00.000Z\",\"children\":\"Wednesday, October 23, 2024\"}]}]]}],[\"$\",\"span\",null,{\"className\":\"pr-1.5\"}]]}]]}],[\"$\",\"article\",null,{\"className\":\"text-gray-800 dark:text-gray-300 mb-10\",\"children\":[\"$\",\"div\",null,{\"className\":\"prose max-w-none pb-8 pt-10 dark:prose-invert\",\"children\":[[[\"$\",\"p\",null,{\"children\":[\"A few years back, \",[\"$\",\"a\",null,{\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://tokio.rs\",\"children\":\"Tokio\"}],\" introduced the \",[\"$\",\"a\",null,{\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://tokio.rs/#tk-lib-tower\",\"children\":\"Tower\"}],\" library. The aim is to create a set of reusable traits, structs, and functions for building network services. For an in-depth understanding of the rationale behind it (which I highly recommend reading first), check out: \",[\"$\",\"a\",null,{\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://tokio.rs/blog/2021-05-14-inventing-the-service-trait\",\"children\":\"Inventing the Service trait\"}],\".\"]}],[\"$\",\"p\",null,{\"children\":\"However, there is limited documentation or guidance on implementing the trait itself. First, let's recap a scenario where such an implementation is necessary:\"}],[\"$\",\"ol\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":\"You have a library that accepts a client compatible with Tower's Service trait.\"}],[\"$\",\"li\",null,{\"children\":[\"There isn't an existing implementation for such a client. This can be the case on \",[\"$\",\"em\",null,{\"children\":\"untypical\"}],\" platforms, like WebAssembly.\"]}]]}],[\"$\",\"h3\",null,{\"id\":\"the-library\",\"children\":[[\"$\",\"a\",null,{\"href\":\"#the-library\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"icon icon-link\"}]}],\"The Library\"]}],[\"$\",\"p\",null,{\"children\":[\"The library in question is \",[\"$\",\"a\",null,{\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://github.com/XAMPPRocky/octocrab\",\"children\":\"Octocrab\"}],\". Octocrab includes networking support by default via Tokio, which does not support WebAssembly. It does, however, allow the use of a custom client.\"]}],[\"$\",\"p\",null,{\"children\":[\"Full source: \",[\"$\",\"a\",null,{\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://github.com/XAMPPRocky/octocrab/blob/main/examples/custom_client.rs\",\"children\":\"custom_client.rs\"}]]}],[\"$\",\"$L12\",null,{\"className\":\"language-rust\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-rust code-highlight\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"let\"}],\" client \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token namespace\",\"children\":[\"hyper_util\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}],\"client\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}],\"legacy\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}]]}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Client\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"builder\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token namespace\",\"children\":[\"hyper_util\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}],\"rt\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}]]}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"TokioExecutor\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"new\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"build\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"connector\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"let\"}],\" octocrab \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"OctocrabBuilder\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"new_empty\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"with_service\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"client\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"with_layer\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"BaseUriLayer\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"new\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Uri\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"from_static\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"            \",[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"https://api.github.com\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"with_layer\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"ExtraHeadersLayer\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"new\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Arc\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"new\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token macro property\",\"children\":\"vec!\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"[\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"            \",[\"$\",\"span\",null,{\"className\":\"token constant\",\"children\":\"USER_AGENT\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"            \",[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"octocrab\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"parse\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"unwrap\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"]\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"with_auth\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"AuthState\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"None\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"build\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"unwrap\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}]]}]}],[\"$\",\"p\",null,{\"children\":\"Now, we just need to employ a different client that supports our target platform.\"}],[\"$\",\"h3\",null,{\"id\":\"the-platform\",\"children\":[[\"$\",\"a\",null,{\"href\":\"#the-platform\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"icon icon-link\"}]}],\"The Platform\"]}],[\"$\",\"p\",null,{\"children\":[\"The platform is Cloudflare Workers, which uses WebAssembly to execute compiled Rust code. Where WASM is executed here matters: Cloudflare Workers run on a customized V8 engine and does not support \",[\"$\",\"a\",null,{\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://github.com/WebAssembly/WASI\",\"children\":\"WASI\"}],\" (which is not a finalized standard yet). As such, your code won't have access to regular networking APIs.\"]}],[\"$\",\"p\",null,{\"children\":[\"HTTP requests here are made using the \",[\"$\",\"a\",null,{\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API\",\"children\":\"Fetch API\"}],\", which is a JavaScript API for making network requests. This API is exposed to Rust via the \",[\"$\",\"a\",null,{\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://rustwasm.github.io/docs/wasm-bindgen/\",\"children\":\"wasm-bindgen\"}],\" crate. Cloudflare offers a \",[\"$\",\"a\",null,{\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://github.com/cloudflare/workers-rs/tree/main\",\"children\":\"worker crate\"}],\", which exposes some functionalities for making HTTP requests.\"]}],[\"$\",\"h3\",null,{\"id\":\"the-implementation\",\"children\":[[\"$\",\"a\",null,{\"href\":\"#the-implementation\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"icon icon-link\"}]}],\"The implementation\"]}],[\"$\",\"p\",null,{\"children\":[\"The trait could be implemented to any struct but since there isn't an actual \\\"client\\\" in the worker crate, I made a dedicated struct for it. The bulk of the implementation is in the \",[\"$\",\"code\",null,{\"children\":\"call\"}],\" method and the bulk of the work is converting between the \",[\"$\",\"code\",null,{\"children\":\"http\"}],\" crate types and the JavaScript ones.\"]}],[\"$\",\"$L12\",null,{\"className\":\"language-rust\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-rust code-highlight\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"use\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token namespace\",\"children\":[\"std\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}],\"convert\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}]]}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"TryInto\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"use\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token namespace\",\"children\":[\"std\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}],\"task\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}]]}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Context\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"use\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token namespace\",\"children\":[\"std\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}]]}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],[\"$\",\"span\",null,{\"className\":\"token namespace\",\"children\":[\"future\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}]]}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Future\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token namespace\",\"children\":[\"pin\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}]]}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Pin\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token namespace\",\"children\":[\"task\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}]]}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Poll\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"use\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"crate\"}],[\"$\",\"span\",null,{\"className\":\"token namespace module-declaration\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}],\"send\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}]]}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"SendFuture\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"use\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"crate\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Body\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Error\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Fetch\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"HttpResponse\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Request\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"/// A Tower-compatible Service implementation for Cloudflare Workers.\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"///\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"/// This struct implements the `tower::Service` trait, allowing it to be used\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"/// as a service in the Tower middleware ecosystem.\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token attr-name attribute\",\"children\":\"#[derive(Debug, Default, Clone, Copy)]\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"pub\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"struct\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name type-definition\",\"children\":\"Service\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"impl\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"B\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token namespace\",\"children\":[\"http_body\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}]]}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Body\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Data\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token namespace\",\"children\":[\"bytes\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}]]}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Bytes\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"+\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Clone\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"+\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token lifetime-annotation symbol\",\"children\":\"'static\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token namespace\",\"children\":[\"tower\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}]]}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Service\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token namespace\",\"children\":[\"http\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}]]}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Request\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"B\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\u003e\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"for\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Service\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"type\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name type-definition\",\"children\":\"Response\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token namespace\",\"children\":[\"http\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}]]}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Response\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Body\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"type\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name type-definition\",\"children\":\"Error\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Error\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"type\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name type-definition\",\"children\":\"Future\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Pin\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Box\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"dyn\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Future\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Output\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token namespace\",\"children\":[\"std\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}],\"result\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}]]}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Result\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"Self\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Response\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"Self\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Error\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\u003e\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"+\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Send\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\u003e\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"fn\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function function-definition\",\"children\":\"poll_ready\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"mut\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"self\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" _cx\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"mut\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Context\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token lifetime-annotation symbol\",\"children\":\"'_\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\u003e\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Poll\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token namespace\",\"children\":[\"std\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}],\"result\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}]]}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Result\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"Self\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Error\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\u003e\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Poll\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Ready\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Ok\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"fn\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function function-definition\",\"children\":\"call\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"mut\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"self\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" req\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token namespace\",\"children\":[\"http\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}]]}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Request\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"B\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\u003e\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"Self\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Future\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// Convert a http Request to a worker Request\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"let\"}],\" worker_request\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Request\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" req\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"try_into\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"unwrap\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// Send the request with Fetch and receive a Future\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"let\"}],\" fut \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Fetch\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Request\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"worker_request\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"send\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// Convert the Future output to a HttpResponse\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"let\"}],\" http_response \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"            \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"async\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Ok\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"TryInto\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"HttpResponse\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"try_into\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"fut\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"await\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"unwrap\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"unwrap\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// Wrap the Future in a SendFuture to make it Send\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"let\"}],\" wrapped \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"SendFuture\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"new\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"http_response\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Box\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"pin\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"wrapped\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}]]}]}],[\"$\",\"p\",null,{\"children\":[\"Full Pull Request: \",[\"$\",\"a\",null,{\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://github.com/cloudflare/workers-rs/pull/659\",\"children\":\"Tower Service Trait implementation\"}]]}],[\"$\",\"h3\",null,{\"id\":\"custom-executors-and-buffer\",\"children\":[[\"$\",\"a\",null,{\"href\":\"#custom-executors-and-buffer\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"icon icon-link\"}]}],\"Custom executors and Buffer\"]}],[\"$\",\"p\",null,{\"children\":[\"While the \",[\"$\",\"code\",null,{\"children\":\"call\"}],\" method is responsible for receiving requests and sending responses, a runtime where it will be executed is needed. This is a non-issue if the environment supports Tokio; otherwise, you need to provide the runtime.\"]}],[\"$\",\"p\",null,{\"children\":[\"The method \",[\"$\",\"a\",null,{\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://docs.rs/tower/0.5.1/tower/buffer/struct.Buffer.html#method.pair\",\"children\":\"Buffer::pair\"}],\" provides a way to inject the \",[\"$\",\"code\",null,{\"children\":\"call\"}],\" method into your own runtime.\"]}],[\"$\",\"blockquote\",null,{\"children\":[\"$\",\"p\",null,{\"children\":\"Creates a new Buffer wrapping service, but returns the background worker. This is useful if you do not want to spawn directly onto the tokio runtime but instead want to use your own executor. This will return the Buffer and the background Worker that you can then spawn.\"}]}],[\"$\",\"p\",null,{\"children\":[\"The runtime in our case is a simple executor. It is a closure that accepts the background worker returned from \",[\"$\",\"code\",null,{\"children\":\"Buffer::pair\"}],\" as an argument.\"]}],[\"$\",\"$L12\",null,{\"className\":\"language-rust\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-rust code-highlight\",\"children\":[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"executor\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Box\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"dyn\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Fn\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Pin\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Box\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"dyn\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Future\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Output\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\u003e\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\u003e\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\"}],\"\\n\"]}]}]}],[\"$\",\"p\",null,{\"children\":[\"Since Octocrab didn't support that, a few changes had to be made. Mainly, using \",[\"$\",\"code\",null,{\"children\":\"Buffer::pair\"}],\" instead of \",[\"$\",\"code\",null,{\"children\":\"Buffer::new\"}],\", accepting the executor closure, and passing the worker to it.\"]}],[\"$\",\"$L12\",null,{\"className\":\"language-rust\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-rust code-highlight\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"/// Creates a new `Octocrab` with a custom executor\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"fn\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function function-definition\",\"children\":\"new_with_executor\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"S\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"\\tservice\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"S\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"\\tauth_state\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"AuthState\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"\\texecutor\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Box\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"dyn\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Fn\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Pin\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Box\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"dyn\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Future\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Output\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\u003e\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\u003e\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\u003e\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"Self\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"where\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"\\t\",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"S\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Service\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Request\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"OctoBody\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Response\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Response\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"BoxBody\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Bytes\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"crate\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Error\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\u003e\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"\\t\\t\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"+\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Send\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"\\t\\t\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"+\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token lifetime-annotation symbol\",\"children\":\"'static\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"\\t\",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"S\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Future\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Send\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"+\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token lifetime-annotation symbol\",\"children\":\"'static\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"\\t\",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"S\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Error\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Into\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"BoxError\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"\\t\",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// Use Buffer pair to return the background worker\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"\\t\",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"let\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"service\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" worker\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Buffer\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"pair\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"BoxService\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"new\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"service\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"map_err\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Into\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}],\"into\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"1024\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"\\t\",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// Execute the background worker with the custom executor\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"\\t\",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"executor\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Box\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"pin\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"worker\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"\\t\",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"Self\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"\\t\\tclient\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" service\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"\\t\\tauth_state\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"\\t\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}]]}]}],[\"$\",\"p\",null,{\"children\":[\"Full Pull Request: \",[\"$\",\"a\",null,{\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://github.com/XAMPPRocky/octocrab/pull/728\",\"children\":\"Custom executor for Wasm Support\"}]]}],[\"$\",\"h3\",null,{\"id\":\"usage-with-workers\",\"children\":[[\"$\",\"a\",null,{\"href\":\"#usage-with-workers\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"icon icon-link\"}]}],\"Usage with workers\"]}],[\"$\",\"p\",null,{\"children\":[\"Finally, we get to the part where we use this with workers. First, we need to create the executor. It must capture the context, so make sure to expose it before. Then, we call the \",[\"$\",\"code\",null,{\"children\":\"wait_until\"}],\" function and pass the worker to it. The \",[\"$\",\"a\",null,{\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://docs.rs/worker/latest/worker/struct.Context.html#method.wait_until\",\"children\":\"wait_until\"}],\" function will start a new parallel thread to execute the worker.\"]}],[\"$\",\"$L12\",null,{\"className\":\"language-rust\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-rust code-highlight\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"let\"}],\" my_executor \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"move\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token closure-params\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation closure-punctuation\",\"children\":\"|\"}],\"worker\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Pin\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Box\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"dyn\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Future\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Output\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\u003e\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation closure-punctuation\",\"children\":\"|\"}]]}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"\\tcontext\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"wait_until\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"worker\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}]]}]}],[\"$\",\"p\",null,{\"children\":\"And pass both the service and the executor to OctocrabBuilder.\"}],[\"$\",\"$L12\",null,{\"className\":\"language-rust\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-rust code-highlight\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"let\"}],\" octocrabis \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token namespace\",\"children\":[\"octocrab\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}]]}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"OctocrabBuilder\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"new_empty\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"\\t\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"with_service\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"service\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"\\t\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"with_executor\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Box\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"new\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"my_executor\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"\\t\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"...\"}],\"             \\n\"]}]]}]}]],[\"$\",\"$L13\",null,{}]]}]}]]}]]}]]\n"])</script><script>self.__next_f.push([1,"7:[[\"$\",\"meta\",\"0\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}],[\"$\",\"meta\",\"1\",{\"charSet\":\"utf-8\"}],[\"$\",\"title\",\"2\",{\"children\":\"Implementing the Tower Service Trait | Omar Abid - Personal Blog\"}],[\"$\",\"meta\",\"3\",{\"name\":\"description\",\"content\":\"Implementing the Tower Service Trait for WebAssembly.\"}],[\"$\",\"meta\",\"4\",{\"name\":\"robots\",\"content\":\"index, follow\"}],[\"$\",\"meta\",\"5\",{\"name\":\"googlebot\",\"content\":\"index, follow, max-video-preview:-1, max-image-preview:large, max-snippet:-1\"}],[\"$\",\"link\",\"6\",{\"rel\":\"canonical\",\"href\":\"https://omarabid.com/tower-service\"}],[\"$\",\"link\",\"7\",{\"rel\":\"alternate\",\"type\":\"application/rss+xml\",\"href\":\"https://omarabid.com/feed.xml\"}],[\"$\",\"meta\",\"8\",{\"property\":\"og:title\",\"content\":\"Implementing the Tower Service Trait\"}],[\"$\",\"meta\",\"9\",{\"property\":\"og:description\",\"content\":\"Implementing the Tower Service Trait for WebAssembly.\"}],[\"$\",\"meta\",\"10\",{\"property\":\"og:url\",\"content\":\"https://omarabid.com/tower-service\"}],[\"$\",\"meta\",\"11\",{\"property\":\"og:site_name\",\"content\":\"Omar Abid - Personal Blog\"}],[\"$\",\"meta\",\"12\",{\"property\":\"og:locale\",\"content\":\"en_US\"}],[\"$\",\"meta\",\"13\",{\"property\":\"og:type\",\"content\":\"article\"}],[\"$\",\"meta\",\"14\",{\"property\":\"article:published_time\",\"content\":\"2024-10-23T00:00:00.000Z\"}],[\"$\",\"meta\",\"15\",{\"property\":\"article:modified_time\",\"content\":\"2024-10-23T00:00:00.000Z\"}],[\"$\",\"meta\",\"16\",{\"name\":\"twitter:card\",\"content\":\"summary_large_image\"}],[\"$\",\"meta\",\"17\",{\"name\":\"twitter:title\",\"content\":\"Implementing the Tower Service Trait\"}],[\"$\",\"meta\",\"18\",{\"name\":\"twitter:description\",\"content\":\"Implementing the Tower Service Trait for WebAssembly.\"}],[\"$\",\"meta\",\"19\",{\"name\":\"next-size-adjust\"}]]\n"])</script><script>self.__next_f.push([1,"f:null\n"])</script><script>self.__next_f.push([1,""])</script></body></html>