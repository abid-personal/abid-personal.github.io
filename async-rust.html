<!DOCTYPE html><html lang="en-us" class="__variable_bc0dcf scroll-smooth"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" href="/_next/static/media/7cba1811e3c25a15-s.p.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="stylesheet" href="/_next/static/css/cd219d613ad8989f.css" crossorigin="" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/959e61cd6bf7e234.css" crossorigin="" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/c1c99bc127b9f571.css" crossorigin="" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-ecd884431e5f35c6.js" crossorigin=""/><script src="/_next/static/chunks/fd9d1056-8aef1845bba99dc3.js" async="" crossorigin=""></script><script src="/_next/static/chunks/472-d0e0ddc81fc62ec9.js" async="" crossorigin=""></script><script src="/_next/static/chunks/main-app-e720945cf7a6a687.js" async="" crossorigin=""></script><script src="/_next/static/chunks/326-f0b929b9e51900a5.js" async=""></script><script src="/_next/static/chunks/app/layout-3c45d3b9abe07049.js" async=""></script><script src="/_next/static/chunks/app/(blog)/%5B...slug%5D/page-47a78e5a6d2fc851.js" async=""></script><title>A primer to Rust Async | Omar Abid - Personal Blog</title><meta name="description" content="An introduction to Rust Async programming"/><meta name="robots" content="index, follow"/><meta name="googlebot" content="index, follow, max-video-preview:-1, max-image-preview:large, max-snippet:-1"/><link rel="canonical" href="https://omarabid.com/async-rust"/><link rel="alternate" type="application/rss+xml" href="https://omarabid.com/feed.xml"/><meta property="og:title" content="A primer to Rust Async"/><meta property="og:description" content="An introduction to Rust Async programming"/><meta property="og:url" content="https://omarabid.com/async-rust"/><meta property="og:site_name" content="Omar Abid - Personal Blog"/><meta property="og:locale" content="en_US"/><meta property="og:type" content="article"/><meta property="article:published_time" content="2020-02-10T00:00:00.000Z"/><meta property="article:modified_time" content="2020-02-10T00:00:00.000Z"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:title" content="A primer to Rust Async"/><meta name="twitter:description" content="An introduction to Rust Async programming"/><meta name="next-size-adjust"/><link rel="apple-touch-icon" sizes="76x76" href="/favicon.svg"/><link rel="icon" type="image/png" sizes="32x32" href="/favicon.svg"/><link rel="icon" type="image/png" sizes="16x16" href="/favicon.svg"/><link rel="manifest" href="/static/favicons/site.webmanifest"/><link rel="mask-icon" href="/favicon.svg" color="#5bbad5"/><meta name="msapplication-TileColor" content="#000000"/><meta name="theme-color" media="(prefers-color-scheme: light)" content="#fff"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#000"/><link rel="alternate" type="application/rss+xml" href="/feed.xml"/><script src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js" crossorigin="" noModule=""></script></head><body class="m-auto max-w-2xl dark:text-gray-100"><script>!function(){try{var d=document.documentElement,c=d.classList;c.remove('light','dark');var e=localStorage.getItem('theme');if('system'===e||(!e&&true)){var t='(prefers-color-scheme: dark)',m=window.matchMedia(t);if(m.media!==t||m.matches){d.style.colorScheme = 'dark';c.add('dark')}else{d.style.colorScheme = 'light';c.add('light')}}else if(e){c.add(e|| '')}if(e==='light'||e==='dark')d.style.colorScheme=e}catch(e){}}()</script><main class="min-h-screen p-6 pt-3 md:pt-6"><header class="mb-5 flex items-center md:mb-10"><span class="text-md whitespace-nowrap font-bold md:text-lg"><a class="-ml-2 rounded-sm p-2 transition-[background-color] hover:bg-gray-200 active:bg-gray-300 dark:hover:bg-[#313131] dark:active:bg-[#242424]" href="/">Omar Abid</a></span><nav class="flex grow items-center justify-end gap-1 font-mono text-xs md:gap-3"><a class="inline-flex rounded-sm p-2 transition-[background-color] hover:bg-gray-200 active:bg-gray-300 dark:hover:bg-[#313131] dark:active:bg-[#242424]" href="/about">About</a></nav></header><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","headline":"A primer to Rust Async","datePublished":"2020-02-10T00:00:00.000Z","dateModified":"2020-02-10T00:00:00.000Z","description":"An introduction to Rust Async programming","url":"https://omarabid.com/async-rust","author":[{"@type":"Person"}]}</script><section class="mx-auto max-w-3xl px-4 sm:px-6 xl:max-w-5xl xl:px-0"><div class="fixed bottom-8 right-8 hidden flex-col gap-3 md:hidden"><button aria-label="Scroll To Top" class="rounded-full bg-gray-200 p-2 text-gray-500 transition-all hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-400 dark:hover:bg-gray-600"><svg height="24" viewBox="0 0 48 48" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M14.83 30.83l9.17-9.17 9.17 9.17 2.83-2.83-12-12-12 12z"></path><path d="M0 0h48v48h-48z" fill="none"></path></svg></button></div><div class="xl:divide-y xl:divide-gray-200 xl:dark:divide-gray-700"><header class="pt-6 xl:pb-6"><h1 class="text-2xl font-bold mb-1 dark:text-gray-100">A primer to Rust Async</h1><p class="font-mono flex text-xs text-gray-500 dark:text-gray-500"><span class="flex-grow"><span class="hidden md:inline"><span><a href="https://github.com/omarabid" class="hover:text-gray-800 dark:hover:text-gray-400" target="_blank">@omarabid</a></span><span class="mx-2">|</span></span><span><time dateTime="2020-02-10T00:00:00.000Z">Monday, February 10, 2020</time></span></span><span class="pr-1.5"></span></p></header><article class="text-gray-800 dark:text-gray-300 mb-10"><div class="prose max-w-none pb-8 pt-10 dark:prose-invert"><p>This article is not comprehensive on the Rust Async topic but could be an easy overview if you have no idea about <a target="_blank" rel="noopener noreferrer" href="https://en.wikipedia.org/wiki/Asynchrony_(computer_programming)">Async Programming</a> in Rust or in general. If you are wondering about the new <code>async/await</code> keywords, Futures, and intrigued what <a target="_blank" rel="noopener noreferrer" href="https://tokio.rs">Tokio</a> is useful for, then you should feel less clueless by the end.</p><p>Rust Async is the <a target="_blank" rel="noopener noreferrer" href="https://blog.rust-lang.org/2019/11/07/Async-await-stable.html">new hot thing</a> in Rust&#x27;s land. It has been hailed as a big milestone for Rust; especially for people developing highly performant networking applications. The long time for development, the different incompatible versions, and the various libraries; however, might made it <em>not</em> very straightforward to grasp. There is a lot going and it&#x27;s not obvious from where to start.</p><p>Let&#x27;s start from the beginning.</p><h3 id="what-is-async"><a href="#what-is-async" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>What is Async?</h3><p>There are several articles, books and videos that goes in depth on Async; but I&#x27;ll give you the short version: If you have a single processor and want to execute two tasks simultaneously (kind of), how would you do it? The solution is to run a little bit of the first task, then switch and run a little bit of the second task, then switch back, etc... until both tasks are complete.</p><p>This is useful if you want to give the impression that the computer is running both tasks simultaneously and the computer is fast enough to trick the human eye (i.e.: multitasking). Another useful use-case is <a target="_blank" rel="noopener noreferrer" href="https://en.wikipedia.org/wiki/Input/output">IO</a> operations. When your program is waiting for a network response, your CPU is sitting idle. This is an ideal time to switch to another task.</p><p>So how do we write Async code?</p><p>First, let&#x27;s start with some synchronous code.</p><h3 id="synchronous-code"><a href="#synchronous-code" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Synchronous code</h3><p>Let&#x27;s make a simple program that reads two files: <code>file1.txt</code> and <code>file2.txt</code>. We start with <code>file1.txt</code> and then move to <code>file2.txt</code>, in that order.</p><p>We split the program into two files: <code>main.rs</code> and <code>file.rs</code>. <code>file.rs</code> has a single function: <code>read_file</code>, and in <code>main.rs</code> we call this function with the path of each file. You can find the code below.</p><p><code>file.rs</code></p><div class="relative"><pre><code class="language-rust code-highlight"><span class="code-line"><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>fs<span class="token punctuation">::</span></span><span class="token class-name">File</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>io<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token keyword">self</span><span class="token punctuation">,</span> <span class="token class-name">Read</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function function-definition">read_file</span><span class="token punctuation">(</span>path<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">str</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token namespace">io<span class="token punctuation">::</span></span><span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">let</span> <span class="token keyword">mut</span> file <span class="token operator">=</span> <span class="token class-name">File</span><span class="token punctuation">::</span><span class="token function">open</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token keyword">let</span> <span class="token keyword">mut</span> buffer <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    file<span class="token punctuation">.</span><span class="token function">read_to_string</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> buffer<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token class-name">Ok</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p><code>main.rs</code></p><div class="relative"><pre><code class="language-rust code-highlight"><span class="code-line"><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span></span>io<span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">mod</span> <span class="token namespace module-declaration">file</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">fn</span> <span class="token function function-definition">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token namespace">io<span class="token punctuation">::</span></span><span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;program started&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token keyword">let</span> file1 <span class="token operator">=</span> <span class="token namespace">file<span class="token punctuation">::</span></span><span class="token function">read_file</span><span class="token punctuation">(</span><span class="token string">&quot;src/file1.txt&quot;</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;processed file 1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token keyword">let</span> file2 <span class="token operator">=</span> <span class="token namespace">file<span class="token punctuation">::</span></span><span class="token function">read_file</span><span class="token punctuation">(</span><span class="token string">&quot;src/file2.txt&quot;</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;processed file 2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token macro property">dbg!</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>file1<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token macro property">dbg!</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>file2<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p>Use <code>cargo run</code> to compile and run the program. The program should run with no surprises but make sure you have placed two files (<code>file1.txt</code> and <code>file2.txt</code>) in your <code>src</code> folder.</p><div class="relative"><pre><code class="code-highlight language-shell"><span class="code-line">program started
</span><span class="code-line">processed <span class="token function">file</span> <span class="token number">1</span>
</span><span class="code-line">processed <span class="token function">file</span> <span class="token number">2</span>
</span><span class="code-line"><span class="token punctuation">[</span>src/main.rs:14<span class="token punctuation">]</span> <span class="token operator">&amp;</span>file1 <span class="token operator">=</span> <span class="token string">&quot;file 1<span class="token entity" title="\n">\n</span>&quot;</span>
</span><span class="code-line"><span class="token punctuation">[</span>src/main.rs:15<span class="token punctuation">]</span> <span class="token operator">&amp;</span>file2 <span class="token operator">=</span> <span class="token string">&quot;file 2<span class="token entity" title="\n">\n</span>&quot;</span>
</span></code></pre></div><p>So far, all is good. If you need <code>file1.txt</code> processed before <code>file2.txt</code>, then this is the only way to go. But there are other times when you don&#x27;t care of the order each file is processed. Ideally, you would be looking to have the files processed as fast as possible.</p><p>In that case, we can make use of multi-threading.</p><h3 id="the-multi-threading-approach"><a href="#the-multi-threading-approach" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>The multi-threading approach</h3><p>For this, we run a separate thread for each function call. Since we are using multi-threaded code, and if we want to access the file contents outside the threads, we have to use one of the <a target="_blank" rel="noopener noreferrer" href="https://doc.rust-lang.org/std/sync/">sync primitives</a> that Rust provides.</p><p>Here is how it will affect the code: <code>file.rs</code> will stay the same, so that&#x27;s one thing already taken care of. In <code>main.rs</code>, we need to initialize two <a target="_blank" rel="noopener noreferrer" href="https://doc.rust-lang.org/std/sync/struct.RwLock.html">RwLock</a>s; these will be used later in the threads to store the file contents.</p><p>Then, we run an infinite loop where we try to read the content of these two variables. If these variables are not empty, then we know that the file processing (or reading) completed. (This means that the files shouldn&#x27;t be empty; otherwise our program will just keep, mistakenly, waiting. An alternative is to use <code>Option&lt;String&gt;</code> and check if the <code>Option</code> in <code>None</code>).</p><p>If you need more overview about RwLock and multi-threading, you can check my previous article: <a target="_blank" rel="noopener noreferrer" href="https://omarabid.com/rust-intro">A brief introduction to Rust</a>.</p><p><em>This code requires the <a target="_blank" rel="noopener noreferrer" href="https://crates.io/crates/lazy_static">lazy_static</a> crate.</em></p><p><code>main.rs</code></p><div class="relative"><pre><code class="language-rust code-highlight"><span class="code-line"><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span></span>io<span class="token punctuation">;</span>
</span><span class="code-line"><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>sync<span class="token punctuation">::</span></span><span class="token class-name">RwLock</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span></span>thread<span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">use</span> <span class="token namespace">lazy_static<span class="token punctuation">::</span></span>lazy_static<span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">mod</span> <span class="token namespace module-declaration">file</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token comment">// A sync primitive that allows to read/write from variables between threads.</span>
</span><span class="code-line"><span class="token comment">// we declare the variables here, this requires the lazy_static crate</span>
</span><span class="code-line"><span class="token macro property">lazy_static!</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">static</span> <span class="token keyword">ref</span> <span class="token constant">FILE1</span><span class="token punctuation">:</span> <span class="token class-name">RwLock</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token class-name">RwLock</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token keyword">static</span> <span class="token keyword">ref</span> <span class="token constant">FILE2</span><span class="token punctuation">:</span> <span class="token class-name">RwLock</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token class-name">RwLock</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">fn</span> <span class="token function function-definition">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token namespace">io<span class="token punctuation">::</span></span><span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;program started&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token keyword">let</span> thread_1 <span class="token operator">=</span> <span class="token namespace">thread<span class="token punctuation">::</span></span><span class="token function">spawn</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token punctuation closure-punctuation">|</span><span class="token punctuation closure-punctuation">|</span></span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token keyword">let</span> <span class="token keyword">mut</span> w1 <span class="token operator">=</span> <span class="token constant">FILE1</span><span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token operator">*</span>w1 <span class="token operator">=</span> <span class="token namespace">file<span class="token punctuation">::</span></span><span class="token function">read_file</span><span class="token punctuation">(</span><span class="token string">&quot;src/file1.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;read file 1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;Launched Thread 1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token keyword">let</span> thread_2 <span class="token operator">=</span> <span class="token namespace">thread<span class="token punctuation">::</span></span><span class="token function">spawn</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token punctuation closure-punctuation">|</span><span class="token punctuation closure-punctuation">|</span></span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token keyword">let</span> <span class="token keyword">mut</span> w2 <span class="token operator">=</span> <span class="token constant">FILE2</span><span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token operator">*</span>w2 <span class="token operator">=</span> <span class="token namespace">file<span class="token punctuation">::</span></span><span class="token function">read_file</span><span class="token punctuation">(</span><span class="token string">&quot;src/file2.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;read file 2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;Launched Thread 2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token keyword">let</span> <span class="token keyword">mut</span> rf1<span class="token punctuation">:</span> <span class="token keyword">bool</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token keyword">let</span> <span class="token keyword">mut</span> rf2<span class="token punctuation">:</span> <span class="token keyword">bool</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token keyword">loop</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token keyword">let</span> r1 <span class="token operator">=</span> <span class="token constant">FILE1</span><span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token keyword">let</span> r2 <span class="token operator">=</span> <span class="token constant">FILE2</span><span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">        <span class="token keyword">if</span> <span class="token operator">*</span>r1 <span class="token operator">!=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> rf1 <span class="token operator">==</span> <span class="token boolean">false</span> <span class="token punctuation">{</span>
</span><span class="code-line">            <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;completed file 1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">            rf1 <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">        <span class="token keyword">if</span> <span class="token operator">*</span>r2 <span class="token operator">!=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> rf2 <span class="token operator">==</span> <span class="token boolean">false</span> <span class="token punctuation">{</span>
</span><span class="code-line">            <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;completed file 2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">            rf2 <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token punctuation">}</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p>Interestingly, if we have a very large <code>file1.txt</code>, we get a strange output. The second file is processed first (<em>read file 2</em>); but inside our loop, the program seems to block and wait for the first file.</p><div class="relative"><pre><code class="code-highlight language-shell"><span class="code-line">program started
</span><span class="code-line">Launched Thread <span class="token number">1</span>
</span><span class="code-line">Launched Thread <span class="token number">2</span>
</span><span class="code-line"><span class="token class-name builtin">read</span> <span class="token function">file</span> <span class="token number">2</span>
</span><span class="code-line"><span class="token class-name builtin">read</span> <span class="token function">file</span> <span class="token number">1</span>
</span><span class="code-line">completed <span class="token function">file</span> <span class="token number">1</span>
</span><span class="code-line">completed <span class="token function">file</span> <span class="token number">2</span>
</span></code></pre></div><p>Multi-threading can be a bit tricky because we have to account for the <a target="_blank" rel="noopener noreferrer" href="https://stackoverflow.com/questions/52196678/what-are-atomic-operations-for-newbies">atomic operations</a> which can be <em>blocking</em>. We used the <code>read</code> function to unlock our variable, and the <a target="_blank" rel="noopener noreferrer" href="https://doc.rust-lang.org/std/sync/struct.RwLock.html">documentation</a> warns about this behavior.</p><blockquote><p>Locks this rwlock with shared read access, blocking the current thread until it can be acquired.</p></blockquote><p>Luckily, there is a <code>try_read</code> function which returns an <code>Err</code> if the lock can&#x27;t be acquired.</p><blockquote><p>Attempts to acquire this rwlock with shared read access.</p><p>If the access could not be granted at this time, then <code>Err</code> is returned. Otherwise, an RAII guard is returned which will release the shared access when it is dropped.</p></blockquote><p>In this second attempt, we use <code>try_read</code> and ignore the <code>Err</code>s returned since they should mean our lock is busy. This helps moving our program to the next variable, and handles the one which gets ready first.</p><p><code>main.rs</code></p><div class="relative"><pre><code class="language-rust code-highlight"><span class="code-line"><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span></span>io<span class="token punctuation">;</span>
</span><span class="code-line"><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>sync<span class="token punctuation">::</span></span><span class="token class-name">RwLock</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span></span>thread<span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">use</span> <span class="token namespace">lazy_static<span class="token punctuation">::</span></span>lazy_static<span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">mod</span> <span class="token namespace module-declaration">file</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token macro property">lazy_static!</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">static</span> <span class="token keyword">ref</span> <span class="token constant">FILE1</span><span class="token punctuation">:</span> <span class="token class-name">RwLock</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token class-name">RwLock</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token keyword">static</span> <span class="token keyword">ref</span> <span class="token constant">FILE2</span><span class="token punctuation">:</span> <span class="token class-name">RwLock</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token class-name">RwLock</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">fn</span> <span class="token function function-definition">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token namespace">io<span class="token punctuation">::</span></span><span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;program started&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token keyword">let</span> thread_1 <span class="token operator">=</span> <span class="token namespace">thread<span class="token punctuation">::</span></span><span class="token function">spawn</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token punctuation closure-punctuation">|</span><span class="token punctuation closure-punctuation">|</span></span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token keyword">let</span> <span class="token keyword">mut</span> w1 <span class="token operator">=</span> <span class="token constant">FILE1</span><span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token operator">*</span>w1 <span class="token operator">=</span> <span class="token namespace">file<span class="token punctuation">::</span></span><span class="token function">read_file</span><span class="token punctuation">(</span><span class="token string">&quot;src/file1.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;read file 1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;Launched Thread 1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token keyword">let</span> thread_2 <span class="token operator">=</span> <span class="token namespace">thread<span class="token punctuation">::</span></span><span class="token function">spawn</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token punctuation closure-punctuation">|</span><span class="token punctuation closure-punctuation">|</span></span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token keyword">let</span> <span class="token keyword">mut</span> w2 <span class="token operator">=</span> <span class="token constant">FILE2</span><span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token operator">*</span>w2 <span class="token operator">=</span> <span class="token namespace">file<span class="token punctuation">::</span></span><span class="token function">read_file</span><span class="token punctuation">(</span><span class="token string">&quot;src/file2.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;read file 2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;Launched Thread 2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token keyword">let</span> <span class="token keyword">mut</span> rf1<span class="token punctuation">:</span> <span class="token keyword">bool</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token keyword">let</span> <span class="token keyword">mut</span> rf2<span class="token punctuation">:</span> <span class="token keyword">bool</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token keyword">loop</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token keyword">let</span> r1 <span class="token operator">=</span> <span class="token constant">FILE1</span><span class="token punctuation">.</span><span class="token function">try_read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token keyword">let</span> r2 <span class="token operator">=</span> <span class="token constant">FILE2</span><span class="token punctuation">.</span><span class="token function">try_read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">        <span class="token keyword">match</span> r1 <span class="token punctuation">{</span>
</span><span class="code-line">            <span class="token class-name">Ok</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">                <span class="token keyword">if</span> <span class="token operator">*</span>v <span class="token operator">!=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> rf1 <span class="token operator">==</span> <span class="token boolean">false</span> <span class="token punctuation">{</span>
</span><span class="code-line">                    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;completed file 1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">                    rf1 <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
</span><span class="code-line">                <span class="token punctuation">}</span>
</span><span class="code-line">            <span class="token punctuation">}</span>
</span><span class="code-line">            <span class="token comment">// If rwlock can&#x27;t be acquired, ignore the error</span>
</span><span class="code-line">            <span class="token class-name">Err</span><span class="token punctuation">(</span>_<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</span><span class="code-line">        <span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">        <span class="token keyword">match</span> r2 <span class="token punctuation">{</span>
</span><span class="code-line">            <span class="token class-name">Ok</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">                <span class="token keyword">if</span> <span class="token operator">*</span>v <span class="token operator">!=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> rf2 <span class="token operator">==</span> <span class="token boolean">false</span> <span class="token punctuation">{</span>
</span><span class="code-line">                    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;completed file 2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">                    rf2 <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
</span><span class="code-line">                <span class="token punctuation">}</span>
</span><span class="code-line">            <span class="token punctuation">}</span>
</span><span class="code-line">            <span class="token comment">// If rwlock can&#x27;t be acquired, ignore the error</span>
</span><span class="code-line">            <span class="token class-name">Err</span><span class="token punctuation">(</span>_<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</span><span class="code-line">        <span class="token punctuation">}</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p>Now the execution is different. If <code>file1.txt</code> is much bigger than <code>file2.txt</code>, then the second file should be processed first.</p><div class="relative"><pre><code class="code-highlight language-shell"><span class="code-line">program started
</span><span class="code-line">Launched Thread <span class="token number">1</span>
</span><span class="code-line">Launched Thread <span class="token number">2</span>
</span><span class="code-line"><span class="token class-name builtin">read</span> <span class="token function">file</span> <span class="token number">2</span>
</span><span class="code-line">completed <span class="token function">file</span> <span class="token number">2</span>
</span><span class="code-line"><span class="token class-name builtin">read</span> <span class="token function">file</span> <span class="token number">1</span>
</span><span class="code-line">completed <span class="token function">file</span> <span class="token number">1</span>
</span></code></pre></div><h3 id="the-limits-of-multi-threading"><a href="#the-limits-of-multi-threading" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>The limits of multi-threading</h3><p>Why do we need Async if we already have multi-threading? There are two main advantages: performance and simplicity. Spawning threads is expensive; and as you can conclude from the above, writing multi-threaded code can get quite complicated.</p><p>This answer on <a target="_blank" rel="noopener noreferrer" href="https://stackoverflow.com/a/42861328/12637">stackoverflow</a> touches up on these points.</p><blockquote><p><strong>Why is async considered better performing than multi-threading?</strong></p></blockquote><blockquote><p>When your code CPU-bound, there will be a little difference between between Tasks + async/await and pure multi-threaded code. In IO bound code, multi threading is the worst throughput you can have. Tasks + async/await will blow away any IO-bound-threadpool you can write your own. threads don&#x27;t scale. usually (especially on Server side) you have both. you read some data from a connection (IO), then continue processing it on the CPU (json parsing, calculations etc.) and write the result back to the connection (IO again). Tasks + async/await are faster in this case than a pure multi threaded code.</p><p>It&#x27;s the simplicity which makes async/await so appealing. writing a synchronous code which is actually asynchronous. if this is not &quot;high level programing&quot;, what is?</p></blockquote><p>And that&#x27;s where Rust Async comes in. Here is a quote for Aaron Turon from <a target="_blank" rel="noopener noreferrer" href="https://aturon.github.io/blog/2016/08/11/futures/">Zero-cost futures in Rust</a> .</p><blockquote><p>We’ve wanted something higher level, with better ergonomics, but also better composability, supporting an ecosystem of asynchronous abstractions that all work together. This story might sound familiar: it’s the same goal that’s led to the introduction of futures (aka promises) in many languages, with some supporting async/await sugar on top.</p></blockquote><h3 id="async-the-keywords"><a href="#async-the-keywords" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Async, the keywords</h3><p>Rust focus is to make writing Async code as simple as it can get. You only need to add the <code>async/await</code> keywords to make your code Async: <code>async</code> before the function declaration and <code>await</code> to resolve your <code>async</code> functions.</p><p>That sounds great. Let&#x27;s give it a try.</p><p><code>file.rs</code></p><div class="relative"><pre><code class="language-rust code-highlight"><span class="code-line"><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>fs<span class="token punctuation">::</span></span><span class="token class-name">File</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>io<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token keyword">self</span><span class="token punctuation">,</span> <span class="token class-name">Read</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">pub</span> <span class="token keyword">async</span> <span class="token keyword">fn</span> <span class="token function function-definition">read_file</span><span class="token punctuation">(</span>path<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">str</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token namespace">io<span class="token punctuation">::</span></span><span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">let</span> <span class="token keyword">mut</span> file <span class="token operator">=</span> <span class="token class-name">File</span><span class="token punctuation">::</span><span class="token function">open</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token keyword">let</span> <span class="token keyword">mut</span> buffer <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    file<span class="token punctuation">.</span><span class="token function">read_to_string</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> buffer<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token class-name">Ok</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p><code>main.rs</code></p><div class="relative"><pre><code class="language-rust code-highlight"><span class="code-line"><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span></span>io<span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">mod</span> <span class="token namespace module-declaration">file</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">fn</span> <span class="token function function-definition">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token namespace">io<span class="token punctuation">::</span></span><span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">let</span> r1 <span class="token operator">=</span> <span class="token namespace">file<span class="token punctuation">::</span></span><span class="token function">read_file</span><span class="token punctuation">(</span><span class="token string">&quot;src/file1.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token keyword">let</span> r2 <span class="token operator">=</span> <span class="token namespace">file<span class="token punctuation">::</span></span><span class="token function">read_file</span><span class="token punctuation">(</span><span class="token string">&quot;src/file2.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token keyword">let</span> f1 <span class="token operator">=</span> r1<span class="token punctuation">.</span><span class="token keyword">await</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token keyword">let</span> f2 <span class="token operator">=</span> r2<span class="token punctuation">.</span><span class="token keyword">await</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>f1<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>f2<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p>This doesn&#x27;t work, however. <code>await</code> is available only inside an <code>async</code> block or function. If we try to run this code, the compiler will throw this error.</p><div class="relative"><pre><code class="code-highlight language-shell"><span class="code-line">error<span class="token punctuation">[</span>E0728<span class="token punctuation">]</span>: <span class="token variable"><span class="token variable">`</span>await<span class="token variable">`</span></span> is only allowed inside <span class="token variable"><span class="token variable">`</span>async<span class="token variable">`</span></span> functions and blocks
</span><span class="code-line"> --<span class="token operator">&gt;</span> src/main.rs:9:14
</span><span class="code-line">  <span class="token operator">|</span>
</span><span class="code-line"><span class="token number">5</span> <span class="token operator">|</span> fn main<span class="token punctuation">(</span><span class="token punctuation">)</span> -<span class="token operator">&gt;</span> io::Result<span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token operator">|</span>    ---- this is not <span class="token variable"><span class="token variable">`</span>async<span class="token variable">`</span></span>
</span><span class="code-line"><span class="token punctuation">..</span>.
</span><span class="code-line"><span class="token number">9</span> <span class="token operator">|</span>     <span class="token class-name builtin">let</span> f1 <span class="token operator">=</span> r1.await<span class="token punctuation">;</span>
</span><span class="code-line">  <span class="token operator">|</span>              ^^^^^^^^ only allowed inside <span class="token variable"><span class="token variable">`</span>async<span class="token variable">`</span></span> functions and blocks
</span></code></pre></div><p>Can we make the <code>main</code> function async? Unfortunately, it&#x27;s not that simple; we get another error.</p><div class="relative"><pre><code class="code-highlight language-shell"><span class="code-line">error<span class="token punctuation">[</span>E0277<span class="token punctuation">]</span>: <span class="token variable"><span class="token variable">`</span>main<span class="token variable">`</span></span> has invalid <span class="token class-name builtin">return</span> <span class="token class-name builtin">type</span> <span class="token variable"><span class="token variable">`</span>impl std::future::Future<span class="token variable">`</span></span>
</span><span class="code-line"> --<span class="token operator">&gt;</span> src/main.rs:5:20
</span><span class="code-line">  <span class="token operator">|</span>
</span><span class="code-line"><span class="token number">5</span> <span class="token operator">|</span> async fn main<span class="token punctuation">(</span><span class="token punctuation">)</span> -<span class="token operator">&gt;</span> io::Result<span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token operator">|</span>                    ^^^^^^^^^^^^^^ <span class="token variable"><span class="token variable">`</span>main<span class="token variable">`</span></span> can only <span class="token class-name builtin">return</span> types that implement <span class="token variable"><span class="token variable">`</span>std::process::Termination<span class="token variable">`</span></span>
</span><span class="code-line">  <span class="token operator">|</span>
</span><span class="code-line">  <span class="token operator">=</span> help: consider using <span class="token variable"><span class="token variable">`</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token variable">`</span></span>, or a <span class="token variable"><span class="token variable">`</span>Result<span class="token variable">`</span></span>
</span></code></pre></div><p>The error message is a bit intriguing, though. It seems that the <code>async</code> keyword makes our function return a <code>Future</code> instead of the declared type.</p><p>Here is some excerpt from the <a target="_blank" rel="noopener noreferrer" href="https://github.com/rust-lang/rfcs/blob/master/text/2394-async_await.md">async-await RFC</a>.</p><blockquote><p>The return type of an async function is a unique anonymous type generated by the compiler, similar to the type of a closure. You can think of this type as being like an enum, with one variant for every &quot;yield point&quot; of the function - the beginning of it, the await expressions, and every return. Each variant stores the state that is needed to be stored to resume control from that yield point.</p></blockquote><p>The return type of an async function is a <a target="_blank" rel="noopener noreferrer" href="https://doc.rust-lang.org/std/future/trait.Future.html">Future</a> (precisely, a closure that implements the Future trait).</p><blockquote><p>The anonymous return type implements Future, with the return type as its Item.</p></blockquote><p>What about <code>await</code>? From the same RFC.</p><blockquote><p>The await! builtin expands roughly to this:</p></blockquote><div class="relative"><pre><code class="language-rust code-highlight"><span class="code-line"><span class="token keyword">let</span> <span class="token keyword">mut</span> future <span class="token operator">=</span> <span class="token class-name">IntoFuture</span><span class="token punctuation">::</span><span class="token function">into_future</span><span class="token punctuation">(</span><span class="token variable">$expression</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token keyword">let</span> <span class="token keyword">mut</span> pin <span class="token operator">=</span> <span class="token keyword">unsafe</span> <span class="token punctuation">{</span> <span class="token class-name">Pin</span><span class="token punctuation">::</span><span class="token function">new_unchecked</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> future<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token keyword">loop</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">match</span> <span class="token class-name">Future</span><span class="token punctuation">::</span><span class="token function">poll</span><span class="token punctuation">(</span><span class="token class-name">Pin</span><span class="token punctuation">::</span><span class="token function">borrow</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> pin<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> ctx<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">          <span class="token class-name">Poll</span><span class="token punctuation">::</span><span class="token class-name">Ready</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">break</span> item<span class="token punctuation">,</span>
</span><span class="code-line">          <span class="token class-name">Poll</span><span class="token punctuation">::</span><span class="token class-name">Pending</span>     <span class="token operator">=&gt;</span> <span class="token keyword">yield</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><blockquote><p>This is not a literal expansion, because the yield concept cannot be expressed in the surface syntax within async functions. This is why await! is a compiler builtin instead of an actual macro.</p></blockquote><p>So roughly speaking: <code>async</code> makes our function a <code>Future</code>. <code>await</code> loops through that future until completion. However, there is another missing piece of the puzzle: Rust doesn&#x27;t resolve the future on its own. We need an executor that is going to run this Async code.</p><h3 id="what-is-an-executor"><a href="#what-is-an-executor" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>What is an executor?</h3><p>If you rewind to our multi-threading example, you&#x27;ll notice that we used a <code>loop</code> in order to detect when our files were processed. It was simple: Loop infinitely until there is some content in the variable and then do something. We could have improved on that by breaking out of the loop if both files are read.</p><p>An Async executor is the loop. Rust, by default, doesn&#x27;t have any built-in executors. There is a number of Async run-times; <a target="_blank" rel="noopener noreferrer" href="https://async.rs/">async-std</a> and <a target="_blank" rel="noopener noreferrer" href="https://tokio.rs/">Tokio</a> being the most popular ones. The job of a run-time is to poll your async functions (<code>Future</code>s) until they finally return a value.</p><p>This <a target="_blank" rel="noopener noreferrer" href="https://www.reddit.com/r/rust/comments/d1obg6/with_asyncawait_i_dont_get_what_runs_the_await/ezoxzjn/">discussion</a> on Reddit has more details, but you can ignore the specifics for now.</p><blockquote><p>Creating/Composing a future object (for example, by calling an async function which calls another async function) does not involve any progress. Only when you pass it to something that actively polls it, the future object starts its work and makes progress (poll by poll). At that point, we refer to the whole future thingy as a task. A suspension point simply makes a call to the future&#x27;s poll method return immediately with a Poll::Pending value if the value is not ready yet.</p></blockquote><h3 id="a-simple-executor"><a href="#a-simple-executor" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>A simple executor</h3><p>The <a target="_blank" rel="noopener noreferrer" href="https://crates.io/crates/futures">futures</a> crate has a very basic executor, and a function to join two <code>Future</code>s. Let&#x27;s give it a shot.</p><p><em>The following code uses the <a target="_blank" rel="noopener noreferrer" href="https://crates.io/crates/futures">futures</a> crate version 0.3.4</em></p><p><code>main.rs</code></p><div class="relative"><pre><code class="language-rust code-highlight"><span class="code-line"><span class="token keyword">use</span> <span class="token namespace">futures<span class="token punctuation">::</span>executor<span class="token punctuation">::</span></span>block_on<span class="token punctuation">;</span>
</span><span class="code-line"><span class="token keyword">use</span> <span class="token namespace">futures<span class="token punctuation">::</span></span>join<span class="token punctuation">;</span>
</span><span class="code-line"><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span></span>io<span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">mod</span> <span class="token namespace module-declaration">file</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">fn</span> <span class="token function function-definition">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token namespace">io<span class="token punctuation">::</span></span><span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;Program started&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token comment">// Block on the final future</span>
</span><span class="code-line">    <span class="token function">block_on</span><span class="token punctuation">(</span><span class="token function">load_files</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">async</span> <span class="token keyword">fn</span> <span class="token function function-definition">load_files</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token comment">// Join the two futures together</span>
</span><span class="code-line">    <span class="token macro property">join!</span><span class="token punctuation">(</span><span class="token function">load_file_1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">load_file_2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">async</span> <span class="token keyword">fn</span> <span class="token function function-definition">load_file_1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">let</span> r1 <span class="token operator">=</span> <span class="token namespace">file<span class="token punctuation">::</span></span><span class="token function">read_file</span><span class="token punctuation">(</span><span class="token string">&quot;src/file1.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">await</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;file 1 size: {}&quot;</span><span class="token punctuation">,</span> r1<span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">async</span> <span class="token keyword">fn</span> <span class="token function function-definition">load_file_2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">let</span> r2 <span class="token operator">=</span> <span class="token namespace">file<span class="token punctuation">::</span></span><span class="token function">read_file</span><span class="token punctuation">(</span><span class="token string">&quot;src/file2.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">await</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;file 2 size: {}&quot;</span><span class="token punctuation">,</span> r2<span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p>To verify the asynchronicity, I dumped a bunch of data in <code>file1.txt</code>. Rust is pretty fast; at the time of testing this, <code>file1.txt</code> had over 5Gb of text.</p><div class="relative"><pre><code class="code-highlight language-shell"><span class="code-line">Program started
</span><span class="code-line"><span class="token function">file</span> <span class="token number">1</span> size: <span class="token number">5430447414</span>
</span><span class="code-line"><span class="token function">file</span> <span class="token number">2</span> size: <span class="token number">7</span>
</span></code></pre></div><p>Unfortunately, this looks like (and it is) blocking on the first file function, again.</p><h3 id="so-what-is-async-anyway"><a href="#so-what-is-async-anyway" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>So what is Async anyway?</h3><p>Similar to multi-threading, there are some gotchas and things to worry about in Async programming. The truth is, the <code>async</code> keyword doesn&#x27;t magically make your code async; it just makes your function return a <code>Future</code>. You still have to do the heavy lifting of <em>scheduling</em> your code execution.</p><p>This means that your function has to return quickly that it&#x27;s not ready instead of being stuck doing calculations. In our case, the clogging is happening specifically at <code>File::Open</code> and <code>file.read_to_string</code>. These two functions are not <code>async</code> and therefore block execution.</p><p>We need to create an Async version of these two functions. Luckily, some handsome people over <a target="_blank" rel="noopener noreferrer" href="https://async.rs/">async-std</a> did the hard work of rewriting the std library in Rust to an async version.</p><blockquote><p>This crate provides an async version of std. It provides all the interfaces you are used to, but in an async version and ready for Rust&#x27;s async/await syntax.</p></blockquote><h3 id="file-io-with-async-std"><a href="#file-io-with-async-std" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>File IO with async-std</h3><p>The only change we have to make is to replace our <code>std</code> imports with <code>async_std</code>.</p><p><em>For the following example, we are using the <a target="_blank" rel="noopener noreferrer" href="https://crates.io/crates/async-std/1.5.0">async-std</a> crate version 1.5.0</em></p><p><code>file.rs</code></p><div class="relative"><pre><code class="language-rust code-highlight"><span class="code-line"><span class="token comment">// We use async_std instead of std, it&#x27;s that simple.</span>
</span><span class="code-line"><span class="token keyword">use</span> <span class="token namespace">async_std<span class="token punctuation">::</span></span>io<span class="token punctuation">;</span>
</span><span class="code-line"><span class="token keyword">use</span> <span class="token namespace">async_std<span class="token punctuation">::</span>fs<span class="token punctuation">::</span></span><span class="token class-name">File</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token keyword">use</span> <span class="token namespace">async_std<span class="token punctuation">::</span>prelude<span class="token punctuation">::</span></span><span class="token operator">*</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">pub</span> <span class="token keyword">async</span> <span class="token keyword">fn</span> <span class="token function function-definition">read_file</span><span class="token punctuation">(</span>path<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">str</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token namespace">io<span class="token punctuation">::</span></span><span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">let</span> <span class="token keyword">mut</span> file <span class="token operator">=</span> <span class="token class-name">File</span><span class="token punctuation">::</span><span class="token function">open</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">await</span><span class="token operator">?</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token keyword">let</span> <span class="token keyword">mut</span> buffer <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    file<span class="token punctuation">.</span><span class="token function">read_to_string</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> buffer<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">await</span><span class="token operator">?</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token class-name">Ok</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p>The code in <code>main.rs</code> remains the same; the program is still using the <code>block_on</code> executor from the <code>futures</code> crates.</p><p>Compile and run the program. (make sure to have a fat <code>file1.txt</code>)</p><div class="relative"><pre><code class="code-highlight language-shell"><span class="code-line">Program started
</span><span class="code-line"><span class="token function">file</span> <span class="token number">2</span> size: <span class="token number">7</span>
</span><span class="code-line"><span class="token function">file</span> <span class="token number">1</span> size: <span class="token number">5430447414</span>
</span></code></pre></div><p>Finally! <code>file2.txt</code> gets processed first and fast here, then the program moves to <code>file1.txt</code>.</p><h3 id="manually-implementing-async-with-futures"><a href="#manually-implementing-async-with-futures" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Manually implementing Async with Futures</h3><p>Let&#x27;s recap what we learned so far:</p><ul><li><code>async</code> makes our function return a <code>Future</code>.</li><li>Running our <code>Future</code> requires a run-time.</li><li>The run-time checks if our <code>Future</code> is ready; and when ready returns its value.</li></ul><p>One more thing to add: Rust futures are <em>lazy</em>. The executor doesn&#x27;t constantly <em>poll</em> the <code>Future</code> but instead waits for the <code>Future</code> to signal that it is due for a poll.</p><p>The future we will design is rather useless but could demonstrate how progress is made during execution. The future object holds some state (an <code>i32</code> field named <code>counter</code>). At each <code>poll</code>, we increment our <code>counter</code> by one, and then schedule another <code>poll</code>.</p><p>To demonstrate task switching, we&#x27;ll create two different Future types. Their functionality is identical, though.</p><p><code>main.rs</code></p><div class="relative"><pre><code class="language-rust code-highlight"><span class="code-line"><span class="token keyword">use</span> <span class="token namespace">futures<span class="token punctuation">::</span>executor<span class="token punctuation">::</span></span>block_on<span class="token punctuation">;</span>
</span><span class="code-line"><span class="token keyword">use</span> <span class="token namespace">futures<span class="token punctuation">::</span></span>join<span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">mod</span> <span class="token namespace module-declaration">asyncop</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">use</span> <span class="token namespace">asyncop<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token class-name">Task1</span><span class="token punctuation">,</span> <span class="token class-name">Task2</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">fn</span> <span class="token function function-definition">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token comment">// Wait for the joined future completion</span>
</span><span class="code-line">    <span class="token function">block_on</span><span class="token punctuation">(</span><span class="token function">asyncop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">async</span> <span class="token keyword">fn</span> <span class="token function function-definition">asyncop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token comment">// Join the two futures</span>
</span><span class="code-line">    <span class="token macro property">join!</span><span class="token punctuation">(</span><span class="token function">fut1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">fut2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token comment">// Future 1</span>
</span><span class="code-line"><span class="token keyword">fn</span> <span class="token function function-definition">fut1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Task1</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token class-name">Task1</span> <span class="token punctuation">{</span> count<span class="token punctuation">:</span> <span class="token number">0</span> <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token comment">// Future 2</span>
</span><span class="code-line"><span class="token keyword">fn</span> <span class="token function function-definition">fut2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Task2</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token class-name">Task2</span> <span class="token punctuation">{</span> count<span class="token punctuation">:</span> <span class="token number">0</span> <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p><code>asyncop.rs</code></p><div class="relative"><pre><code class="language-rust code-highlight"><span class="code-line"><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>future<span class="token punctuation">::</span></span><span class="token class-name">Future</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>pin<span class="token punctuation">::</span></span><span class="token class-name">Pin</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>task<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token class-name">Context</span><span class="token punctuation">,</span> <span class="token class-name">Poll</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token attr-name attribute">#[derive(Debug)]</span>
</span><span class="code-line"><span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token class-name type-definition">Task1</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">pub</span> count<span class="token punctuation">:</span> <span class="token keyword">i32</span><span class="token punctuation">,</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">impl</span> <span class="token class-name">Future</span> <span class="token keyword">for</span> <span class="token class-name">Task1</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">type</span> <span class="token class-name type-definition">Output</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token keyword">fn</span> <span class="token function function-definition">poll</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">:</span> <span class="token class-name">Pin</span><span class="token operator">&lt;</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">Self</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> cx<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token class-name">Context</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">&#x27;_</span><span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Poll</span><span class="token operator">&lt;</span><span class="token keyword">Self</span><span class="token punctuation">::</span><span class="token class-name">Output</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token comment">// If counter reaches 99, our future is ready</span>
</span><span class="code-line">        <span class="token keyword">if</span> <span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">.</span>count <span class="token operator">&gt;</span> <span class="token operator">&amp;</span><span class="token number">100</span> <span class="token punctuation">{</span>
</span><span class="code-line">            <span class="token class-name">Poll</span><span class="token punctuation">::</span><span class="token class-name">Ready</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line">        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
</span><span class="code-line">            <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;Task 1 Progress - {}&quot;</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">.</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">            <span class="token comment">// Increment counter</span>
</span><span class="code-line">            <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">get_mut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>count <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>
</span><span class="code-line">            <span class="token comment">// Schedule future for another poll()</span>
</span><span class="code-line">            cx<span class="token punctuation">.</span><span class="token function">waker</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">wake</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">            <span class="token class-name">Poll</span><span class="token punctuation">::</span><span class="token class-name">Pending</span>
</span><span class="code-line">        <span class="token punctuation">}</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token attr-name attribute">#[derive(Debug)]</span>
</span><span class="code-line"><span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token class-name type-definition">Task2</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">pub</span> count<span class="token punctuation">:</span> <span class="token keyword">i32</span><span class="token punctuation">,</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">impl</span> <span class="token class-name">Future</span> <span class="token keyword">for</span> <span class="token class-name">Task2</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">type</span> <span class="token class-name type-definition">Output</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token keyword">fn</span> <span class="token function function-definition">poll</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">:</span> <span class="token class-name">Pin</span><span class="token operator">&lt;</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">Self</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> cx<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token class-name">Context</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">&#x27;_</span><span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Poll</span><span class="token operator">&lt;</span><span class="token keyword">Self</span><span class="token punctuation">::</span><span class="token class-name">Output</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token comment">// If counter reaches 99, our future is ready</span>
</span><span class="code-line">        <span class="token keyword">if</span> <span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">.</span>count <span class="token operator">&gt;</span> <span class="token operator">&amp;</span><span class="token number">100</span> <span class="token punctuation">{</span>
</span><span class="code-line">            <span class="token class-name">Poll</span><span class="token punctuation">::</span><span class="token class-name">Ready</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line">        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
</span><span class="code-line">            <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;Task 2 Progress - {}&quot;</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">.</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">            <span class="token comment">// Increment counter</span>
</span><span class="code-line">            <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">get_mut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>count <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>
</span><span class="code-line">            <span class="token comment">// Schedule future for another poll()</span>
</span><span class="code-line">            cx<span class="token punctuation">.</span><span class="token function">waker</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">wake</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">            <span class="token class-name">Poll</span><span class="token punctuation">::</span><span class="token class-name">Pending</span>
</span><span class="code-line">        <span class="token punctuation">}</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p>The output on execution demonstrates how the executor is switching between <em>Future 1</em> and <em>Future 2</em>.</p><div class="relative"><pre><code class="code-highlight language-shell"><span class="code-line"><span class="token punctuation">..</span>.
</span><span class="code-line">Task <span class="token number">1</span> Progress - <span class="token number">95</span>
</span><span class="code-line">Task <span class="token number">2</span> Progress - <span class="token number">95</span>
</span><span class="code-line">Task <span class="token number">1</span> Progress - <span class="token number">96</span>
</span><span class="code-line">Task <span class="token number">2</span> Progress - <span class="token number">96</span>
</span><span class="code-line">Task <span class="token number">1</span> Progress - <span class="token number">97</span>
</span><span class="code-line">Task <span class="token number">2</span> Progress - <span class="token number">97</span>
</span><span class="code-line">Task <span class="token number">1</span> Progress - <span class="token number">98</span>
</span><span class="code-line">Task <span class="token number">2</span> Progress - <span class="token number">98</span>
</span><span class="code-line">Task <span class="token number">1</span> Progress - <span class="token number">99</span>
</span><span class="code-line">Task <span class="token number">2</span> Progress - <span class="token number">99</span>
</span><span class="code-line">Task <span class="token number">1</span> Progress - <span class="token number">100</span>
</span><span class="code-line">Task <span class="token number">2</span> Progress - <span class="token number">100</span>
</span></code></pre></div><h3 id="wrap-up"><a href="#wrap-up" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Wrap-up</h3><p>In this post we covered synchronous code, multi-threaded code, some Async terminology in Rust, the async-std library and a simple <code>Future</code> implementation. This is, really, a lightweight introduction and many of the specifics were omitted for brevity.</p><p>I&#x27;ve compiled a list of resources below if you want to explore more.</p><h4 id="further-resources-on-async-rust"><a href="#further-resources-on-async-rust" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Further resources on Async Rust</h4><ul><li><a target="_blank" rel="noopener noreferrer" href="https://rust-lang.github.io/async-book/">Asynchronous Programming in Rust</a></li><li><a target="_blank" rel="noopener noreferrer" href="https://cfsamson.github.io/book-exploring-async-basics/introduction.html">The Node Experiment - Exploring Async Basics with Rust</a></li><li><a target="_blank" rel="noopener noreferrer" href="https://cfsamson.gitbook.io/green-threads-explained-in-200-lines-of-rust/">Green threads explained in 200 lines of Rust</a></li><li><a target="_blank" rel="noopener noreferrer" href="https://www.viget.com/articles/understanding-futures-in-rust-part-1/">Understanding Futures In Rust -- Part 1</a></li><li><a target="_blank" rel="noopener noreferrer" href="https://www.viget.com/articles/understanding-futures-is-rust-part-2/">Understanding Futures In Rust -- Part 2</a></li><li><a target="_blank" rel="noopener noreferrer" href="https://dev.to/iam_aprogrammer/pinning-asynchronous-programming-in-rust-why-what-and-how-3eal">Pinning - Asynchronous Programming in Rust: Why, What, and How</a></li><li><a target="_blank" rel="noopener noreferrer" href="https://tmandry.gitlab.io/blog/posts/optimizing-await-1/">How Rust optimizes async/await I</a></li><li><a target="_blank" rel="noopener noreferrer" href="https://tmandry.gitlab.io/blog/posts/optimizing-await-2/">How Rust optimizes async/await II: Program analysis</a></li></ul><div class="my-8 w-full rounded-lg bg-gray-50 px-4 py-8 dark:bg-gray-800"><div class="mx-auto max-w-2xl"><h3 class="mb-2 text-xl font-bold text-gray-900 dark:text-white">Subscribe to the Newsletter</h3><p class="mb-4 text-gray-600 dark:text-gray-300">Get the latest posts from this blog delivered to your inbox. No spam.</p><form class="space-y-4"><div class="flex gap-2"><input type="email" placeholder="Enter your email" required="" class="flex-1 border border-gray-300 bg-white px-4 py-2 text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-500 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-100" value=""/><button type="submit" class="bg-blue-600 px-6 py-2 text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50">Subscribe</button></div></form></div></div></div></article></div></section></main><footer class="mt-3 flex p-6 pb-6 pt-3 text-center font-mono text-xs text-gray-500 dark:text-gray-400"><div class="grow text-left">Omar Abid (<a class="border-b border-gray-300 text-gray-600 transition-[border-color] hover:border-gray-600 dark:border-gray-500 dark:text-white dark:hover:border-white " target="_blank" href="https://github.com/omarabid">@omarabid</a>)</div><div></div></footer><script src="/_next/static/chunks/webpack-ecd884431e5f35c6.js" crossorigin="" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0]);self.__next_f.push([2,null])</script><script>self.__next_f.push([1,"1:HL[\"/_next/static/media/7cba1811e3c25a15-s.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n2:HL[\"/_next/static/css/cd219d613ad8989f.css\",\"style\",{\"crossOrigin\":\"\"}]\n3:HL[\"/_next/static/css/959e61cd6bf7e234.css\",\"style\",{\"crossOrigin\":\"\"}]\n0:\"$L4\"\n"])</script><script>self.__next_f.push([1,"5:HL[\"/_next/static/css/c1c99bc127b9f571.css\",\"style\",{\"crossOrigin\":\"\"}]\n"])</script><script>self.__next_f.push([1,"6:I[3728,[],\"\"]\n8:I[9928,[],\"\"]\n9:I[4893,[\"326\",\"static/chunks/326-f0b929b9e51900a5.js\",\"185\",\"static/chunks/app/layout-3c45d3b9abe07049.js\"],\"CSPostHogProvider\"]\na:I[7821,[\"326\",\"static/chunks/326-f0b929b9e51900a5.js\",\"185\",\"static/chunks/app/layout-3c45d3b9abe07049.js\"],\"ThemeProviders\"]\nb:I[8326,[\"326\",\"static/chunks/326-f0b929b9e51900a5.js\",\"202\",\"static/chunks/app/(blog)/%5B...slug%5D/page-47a78e5a6d2fc851.js\"],\"\"]\nc:I[5235,[\"326\",\"static/chunks/326-f0b929b9e51900a5.js\",\"185\",\"static/chunks/app/layout-"])</script><script>self.__next_f.push([1,"3c45d3b9abe07049.js\"],\"\"]\nd:I[6954,[],\"\"]\ne:I[7264,[],\"\"]\n"])</script><script>self.__next_f.push([1,"4:[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/cd219d613ad8989f.css\",\"precedence\":\"next\",\"crossOrigin\":\"\"}],[\"$\",\"link\",\"1\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/959e61cd6bf7e234.css\",\"precedence\":\"next\",\"crossOrigin\":\"\"}]],[\"$\",\"$L6\",null,{\"buildId\":\"Py0GnHVEtbE6txuAghHxJ\",\"assetPrefix\":\"\",\"initialCanonicalUrl\":\"/async-rust\",\"initialTree\":[\"\",{\"children\":[\"(blog)\",{\"children\":[[\"slug\",\"async-rust\",\"c\"],{\"children\":[\"__PAGE__?{\\\"slug\\\":[\\\"async-rust\\\"]}\",{}]}]}]},\"$undefined\",\"$undefined\",true],\"initialHead\":[false,\"$L7\"],\"globalErrorComponent\":\"$8\",\"children\":[null,[\"$\",\"html\",null,{\"lang\":\"en-us\",\"className\":\"__variable_bc0dcf scroll-smooth\",\"suppressHydrationWarning\":true,\"children\":[[\"$\",\"link\",null,{\"rel\":\"apple-touch-icon\",\"sizes\":\"76x76\",\"href\":\"/favicon.svg\"}],[\"$\",\"link\",null,{\"rel\":\"icon\",\"type\":\"image/png\",\"sizes\":\"32x32\",\"href\":\"/favicon.svg\"}],[\"$\",\"link\",null,{\"rel\":\"icon\",\"type\":\"image/png\",\"sizes\":\"16x16\",\"href\":\"/favicon.svg\"}],[\"$\",\"link\",null,{\"rel\":\"manifest\",\"href\":\"/static/favicons/site.webmanifest\"}],[\"$\",\"link\",null,{\"rel\":\"mask-icon\",\"href\":\"/favicon.svg\",\"color\":\"#5bbad5\"}],[\"$\",\"meta\",null,{\"name\":\"msapplication-TileColor\",\"content\":\"#000000\"}],[\"$\",\"meta\",null,{\"name\":\"theme-color\",\"media\":\"(prefers-color-scheme: light)\",\"content\":\"#fff\"}],[\"$\",\"meta\",null,{\"name\":\"theme-color\",\"media\":\"(prefers-color-scheme: dark)\",\"content\":\"#000\"}],[\"$\",\"link\",null,{\"rel\":\"alternate\",\"type\":\"application/rss+xml\",\"href\":\"/feed.xml\"}],[\"$\",\"$L9\",null,{\"children\":[\"$\",\"body\",null,{\"className\":\"m-auto max-w-2xl dark:text-gray-100\",\"children\":[\"$\",\"$La\",null,{\"children\":[[\"$\",\"main\",null,{\"className\":\"min-h-screen p-6 pt-3 md:pt-6\",\"children\":[[\"$\",\"header\",null,{\"className\":\"mb-5 flex items-center md:mb-10\",\"children\":[[\"$\",\"span\",null,{\"className\":\"text-md whitespace-nowrap font-bold md:text-lg\",\"children\":[\"$\",\"$Lb\",null,{\"href\":\"/\",\"className\":\"-ml-2 rounded-sm p-2 transition-[background-color] hover:bg-gray-200 active:bg-gray-300 dark:hover:bg-[#313131] dark:active:bg-[#242424]\",\"children\":\"Omar Abid\"}]}],[\"$\",\"nav\",null,{\"className\":\"flex grow items-center justify-end gap-1 font-mono text-xs md:gap-3\",\"children\":[[\"$\",\"$Lc\",null,{}],[\"$\",\"a\",null,{\"className\":\"inline-flex rounded-sm p-2 transition-[background-color] hover:bg-gray-200 active:bg-gray-300 dark:hover:bg-[#313131] dark:active:bg-[#242424]\",\"href\":\"/about\",\"children\":\"About\"}]]}]]}],[\"$\",\"$Ld\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"loadingScripts\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$Le\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[\"$\",\"div\",null,{\"className\":\"flex flex-col items-start justify-start md:mt-24 md:flex-row md:items-center md:justify-center md:space-x-6\",\"children\":[[\"$\",\"div\",null,{\"className\":\"space-x-2 pb-8 pt-6 md:space-y-5\",\"children\":[\"$\",\"h1\",null,{\"className\":\"text-6xl font-extrabold leading-9 tracking-tight text-gray-900 dark:text-gray-100 md:border-r-2 md:px-6 md:text-8xl md:leading-14\",\"children\":\"404\"}]}],[\"$\",\"div\",null,{\"className\":\"max-w-md\",\"children\":[[\"$\",\"p\",null,{\"className\":\"mb-4 text-xl font-bold leading-normal md:text-2xl\",\"children\":\"Sorry we couldn't find this page.\"}],[\"$\",\"p\",null,{\"className\":\"mb-8\",\"children\":\"But dont worry, you can find plenty of other things on our homepage.\"}],[\"$\",\"$Lb\",null,{\"href\":\"/\",\"className\":\"focus:shadow-outline-blue inline rounded-lg border border-transparent bg-blue-600 px-4 py-2 text-sm font-medium leading-5 text-white shadow transition-colors duration-150 hover:bg-blue-700 focus:outline-none dark:hover:bg-blue-500\",\"children\":\"Back to homepage\"}]]}]]}],\"notFoundStyles\":[],\"initialChildNode\":[\"$\",\"$Ld\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"(blog)\",\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"loadingScripts\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$Le\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"initialChildNode\":[\"$\",\"$Ld\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"(blog)\",\"children\",[\"slug\",\"async-rust\",\"c\"],\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"loadingScripts\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$Le\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"initialChildNode\":[\"$Lf\",\"$L10\",null],\"childPropSegment\":\"__PAGE__?{\\\"slug\\\":[\\\"async-rust\\\"]}\",\"styles\":[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/c1c99bc127b9f571.css\",\"precedence\":\"next\",\"crossOrigin\":\"\"}]]}],\"childPropSegment\":[\"slug\",\"async-rust\",\"c\"],\"styles\":null}],\"childPropSegment\":\"(blog)\",\"styles\":null}]]}],[\"$\",\"footer\",null,{\"className\":\"mt-3 flex p-6 pb-6 pt-3 text-center font-mono text-xs text-gray-500 dark:text-gray-400\",\"children\":[[\"$\",\"div\",null,{\"className\":\"grow text-left\",\"children\":[\"Omar Abid (\",[\"$\",\"a\",null,{\"className\":\"border-b border-gray-300 text-gray-600 transition-[border-color] hover:border-gray-600 dark:border-gray-500 dark:text-white dark:hover:border-white \",\"target\":\"_blank\",\"href\":\"https://github.com/omarabid\",\"children\":\"@omarabid\"}],\")\"]}],[\"$\",\"div\",null,{}]]}]]}]}]}]]}],null]}]]\n"])</script><script>self.__next_f.push([1,"11:I[1514,[\"326\",\"static/chunks/326-f0b929b9e51900a5.js\",\"202\",\"static/chunks/app/(blog)/%5B...slug%5D/page-47a78e5a6d2fc851.js\"],\"\"]\n12:I[2529,[\"326\",\"static/chunks/326-f0b929b9e51900a5.js\",\"202\",\"static/chunks/app/(blog)/%5B...slug%5D/page-47a78e5a6d2fc851.js\"],\"\"]\n13:I[6598,[\"326\",\"static/chunks/326-f0b929b9e51900a5.js\",\"202\",\"static/chunks/app/(blog)/%5B...slug%5D/page-47a78e5a6d2fc851.js\"],\"\"]\n"])</script><script>self.__next_f.push([1,"10:[[\"$\",\"script\",null,{\"type\":\"application/ld+json\",\"dangerouslySetInnerHTML\":{\"__html\":\"{\\\"@context\\\":\\\"https://schema.org\\\",\\\"@type\\\":\\\"BlogPosting\\\",\\\"headline\\\":\\\"A primer to Rust Async\\\",\\\"datePublished\\\":\\\"2020-02-10T00:00:00.000Z\\\",\\\"dateModified\\\":\\\"2020-02-10T00:00:00.000Z\\\",\\\"description\\\":\\\"An introduction to Rust Async programming\\\",\\\"url\\\":\\\"https://omarabid.com/async-rust\\\",\\\"author\\\":[{\\\"@type\\\":\\\"Person\\\"}]}\"}}],[\"$\",\"section\",null,{\"className\":\"mx-auto max-w-3xl px-4 sm:px-6 xl:max-w-5xl xl:px-0\",\"children\":[[\"$\",\"$L11\",null,{}],[\"$\",\"div\",null,{\"className\":\"xl:divide-y xl:divide-gray-200 xl:dark:divide-gray-700\",\"children\":[[\"$\",\"header\",null,{\"className\":\"pt-6 xl:pb-6\",\"children\":[[\"$\",\"h1\",null,{\"className\":\"text-2xl font-bold mb-1 dark:text-gray-100\",\"children\":\"A primer to Rust Async\"}],[\"$\",\"p\",null,{\"className\":\"font-mono flex text-xs text-gray-500 dark:text-gray-500\",\"children\":[[\"$\",\"span\",null,{\"className\":\"flex-grow\",\"children\":[[\"$\",\"span\",null,{\"className\":\"hidden md:inline\",\"children\":[[\"$\",\"span\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"https://github.com/omarabid\",\"className\":\"hover:text-gray-800 dark:hover:text-gray-400\",\"target\":\"_blank\",\"children\":\"@omarabid\"}]}],[\"$\",\"span\",null,{\"className\":\"mx-2\",\"children\":\"|\"}]]}],[\"$\",\"span\",null,{\"children\":[\"$\",\"time\",null,{\"dateTime\":\"2020-02-10T00:00:00.000Z\",\"children\":\"Monday, February 10, 2020\"}]}]]}],[\"$\",\"span\",null,{\"className\":\"pr-1.5\"}]]}]]}],[\"$\",\"article\",null,{\"className\":\"text-gray-800 dark:text-gray-300 mb-10\",\"children\":[\"$\",\"div\",null,{\"className\":\"prose max-w-none pb-8 pt-10 dark:prose-invert\",\"children\":[[[\"$\",\"p\",null,{\"children\":[\"This article is not comprehensive on the Rust Async topic but could be an easy overview if you have no idea about \",[\"$\",\"a\",null,{\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://en.wikipedia.org/wiki/Asynchrony_(computer_programming)\",\"children\":\"Async Programming\"}],\" in Rust or in general. If you are wondering about the new \",[\"$\",\"code\",null,{\"children\":\"async/await\"}],\" keywords, Futures, and intrigued what \",[\"$\",\"a\",null,{\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://tokio.rs\",\"children\":\"Tokio\"}],\" is useful for, then you should feel less clueless by the end.\"]}],[\"$\",\"p\",null,{\"children\":[\"Rust Async is the \",[\"$\",\"a\",null,{\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://blog.rust-lang.org/2019/11/07/Async-await-stable.html\",\"children\":\"new hot thing\"}],\" in Rust's land. It has been hailed as a big milestone for Rust; especially for people developing highly performant networking applications. The long time for development, the different incompatible versions, and the various libraries; however, might made it \",[\"$\",\"em\",null,{\"children\":\"not\"}],\" very straightforward to grasp. There is a lot going and it's not obvious from where to start.\"]}],[\"$\",\"p\",null,{\"children\":\"Let's start from the beginning.\"}],[\"$\",\"h3\",null,{\"id\":\"what-is-async\",\"children\":[[\"$\",\"a\",null,{\"href\":\"#what-is-async\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"icon icon-link\"}]}],\"What is Async?\"]}],[\"$\",\"p\",null,{\"children\":\"There are several articles, books and videos that goes in depth on Async; but I'll give you the short version: If you have a single processor and want to execute two tasks simultaneously (kind of), how would you do it? The solution is to run a little bit of the first task, then switch and run a little bit of the second task, then switch back, etc... until both tasks are complete.\"}],[\"$\",\"p\",null,{\"children\":[\"This is useful if you want to give the impression that the computer is running both tasks simultaneously and the computer is fast enough to trick the human eye (i.e.: multitasking). Another useful use-case is \",[\"$\",\"a\",null,{\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://en.wikipedia.org/wiki/Input/output\",\"children\":\"IO\"}],\" operations. When your program is waiting for a network response, your CPU is sitting idle. This is an ideal time to switch to another task.\"]}],[\"$\",\"p\",null,{\"children\":\"So how do we write Async code?\"}],[\"$\",\"p\",null,{\"children\":\"First, let's start with some synchronous code.\"}],[\"$\",\"h3\",null,{\"id\":\"synchronous-code\",\"children\":[[\"$\",\"a\",null,{\"href\":\"#synchronous-code\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"icon icon-link\"}]}],\"Synchronous code\"]}],[\"$\",\"p\",null,{\"children\":[\"Let's make a simple program that reads two files: \",[\"$\",\"code\",null,{\"children\":\"file1.txt\"}],\" and \",[\"$\",\"code\",null,{\"children\":\"file2.txt\"}],\". We start with \",[\"$\",\"code\",null,{\"children\":\"file1.txt\"}],\" and then move to \",[\"$\",\"code\",null,{\"children\":\"file2.txt\"}],\", in that order.\"]}],[\"$\",\"p\",null,{\"children\":[\"We split the program into two files: \",[\"$\",\"code\",null,{\"children\":\"main.rs\"}],\" and \",[\"$\",\"code\",null,{\"children\":\"file.rs\"}],\". \",[\"$\",\"code\",null,{\"children\":\"file.rs\"}],\" has a single function: \",[\"$\",\"code\",null,{\"children\":\"read_file\"}],\", and in \",[\"$\",\"code\",null,{\"children\":\"main.rs\"}],\" we call this function with the path of each file. You can find the code below.\"]}],[\"$\",\"p\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"file.rs\"}]}],[\"$\",\"$L12\",null,{\"className\":\"language-rust\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-rust code-highlight\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"use\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token namespace\",\"children\":[\"std\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}],\"fs\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}]]}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"File\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"use\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token namespace\",\"children\":[\"std\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}],\"io\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}]]}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"self\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Read\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"pub\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"fn\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function function-definition\",\"children\":\"read_file\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"path\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"str\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\u003e\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token namespace\",\"children\":[\"io\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}]]}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Result\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"String\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"let\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"mut\"}],\" file \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"File\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"open\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"path\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"?\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"let\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"mut\"}],\" buffer \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"String\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"new\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    file\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"read_to_string\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"mut\"}],\" buffer\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"?\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Ok\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"buffer\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}]]}]}],[\"$\",\"p\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"main.rs\"}]}],[\"$\",\"$L12\",null,{\"className\":\"language-rust\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-rust code-highlight\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"use\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token namespace\",\"children\":[\"std\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}]]}],\"io\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"mod\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token namespace module-declaration\",\"children\":\"file\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"fn\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function function-definition\",\"children\":\"main\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\u003e\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token namespace\",\"children\":[\"io\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}]]}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Result\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token macro property\",\"children\":\"println!\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"program started\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"let\"}],\" file1 \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token namespace\",\"children\":[\"file\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}]]}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"read_file\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"src/file1.txt\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"?\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token macro property\",\"children\":\"println!\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"processed file 1\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"let\"}],\" file2 \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token namespace\",\"children\":[\"file\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}]]}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"read_file\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"src/file2.txt\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"?\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token macro property\",\"children\":\"println!\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"processed file 2\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token macro property\",\"children\":\"dbg!\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\"}],\"file1\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token macro property\",\"children\":\"dbg!\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\"}],\"file2\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Ok\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}]]}]}],[\"$\",\"p\",null,{\"children\":[\"Use \",[\"$\",\"code\",null,{\"children\":\"cargo run\"}],\" to compile and run the program. The program should run with no surprises but make sure you have placed two files (\",[\"$\",\"code\",null,{\"children\":\"file1.txt\"}],\" and \",[\"$\",\"code\",null,{\"children\":\"file2.txt\"}],\") in your \",[\"$\",\"code\",null,{\"children\":\"src\"}],\" folder.\"]}],[\"$\",\"$L12\",null,{\"className\":\"language-shell\",\"children\":[\"$\",\"code\",null,{\"className\":\"code-highlight language-shell\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"program started\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"processed \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"file\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"1\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"processed \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"file\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"2\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"[\"}],\"src/main.rs:14\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"]\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\"}],\"file1 \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":[\"\\\"file 1\",[\"$\",\"span\",null,{\"className\":\"token entity\",\"title\":\"\\\\n\",\"children\":\"\\\\n\"}],\"\\\"\"]}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"[\"}],\"src/main.rs:15\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"]\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\"}],\"file2 \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":[\"\\\"file 2\",[\"$\",\"span\",null,{\"className\":\"token entity\",\"title\":\"\\\\n\",\"children\":\"\\\\n\"}],\"\\\"\"]}],\"\\n\"]}]]}]}],[\"$\",\"p\",null,{\"children\":[\"So far, all is good. If you need \",[\"$\",\"code\",null,{\"children\":\"file1.txt\"}],\" processed before \",[\"$\",\"code\",null,{\"children\":\"file2.txt\"}],\", then this is the only way to go. But there are other times when you don't care of the order each file is processed. Ideally, you would be looking to have the files processed as fast as possible.\"]}],[\"$\",\"p\",null,{\"children\":\"In that case, we can make use of multi-threading.\"}],[\"$\",\"h3\",null,{\"id\":\"the-multi-threading-approach\",\"children\":[[\"$\",\"a\",null,{\"href\":\"#the-multi-threading-approach\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"icon icon-link\"}]}],\"The multi-threading approach\"]}],[\"$\",\"p\",null,{\"children\":[\"For this, we run a separate thread for each function call. Since we are using multi-threaded code, and if we want to access the file contents outside the threads, we have to use one of the \",[\"$\",\"a\",null,{\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://doc.rust-lang.org/std/sync/\",\"children\":\"sync primitives\"}],\" that Rust provides.\"]}],[\"$\",\"p\",null,{\"children\":[\"Here is how it will affect the code: \",[\"$\",\"code\",null,{\"children\":\"file.rs\"}],\" will stay the same, so that's one thing already taken care of. In \",[\"$\",\"code\",null,{\"children\":\"main.rs\"}],\", we need to initialize two \",[\"$\",\"a\",null,{\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://doc.rust-lang.org/std/sync/struct.RwLock.html\",\"children\":\"RwLock\"}],\"s; these will be used later in the threads to store the file contents.\"]}],[\"$\",\"p\",null,{\"children\":[\"Then, we run an infinite loop where we try to read the content of these two variables. If these variables are not empty, then we know that the file processing (or reading) completed. (This means that the files shouldn't be empty; otherwise our program will just keep, mistakenly, waiting. An alternative is to use \",[\"$\",\"code\",null,{\"children\":\"Option\u003cString\u003e\"}],\" and check if the \",[\"$\",\"code\",null,{\"children\":\"Option\"}],\" in \",[\"$\",\"code\",null,{\"children\":\"None\"}],\").\"]}],[\"$\",\"p\",null,{\"children\":[\"If you need more overview about RwLock and multi-threading, you can check my previous article: \",[\"$\",\"a\",null,{\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://omarabid.com/rust-intro\",\"children\":\"A brief introduction to Rust\"}],\".\"]}],[\"$\",\"p\",null,{\"children\":[\"$\",\"em\",null,{\"children\":[\"This code requires the \",[\"$\",\"a\",null,{\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://crates.io/crates/lazy_static\",\"children\":\"lazy_static\"}],\" crate.\"]}]}],[\"$\",\"p\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"main.rs\"}]}],[\"$\",\"$L12\",null,{\"className\":\"language-rust\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-rust code-highlight\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"use\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token namespace\",\"children\":[\"std\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}]]}],\"io\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"use\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token namespace\",\"children\":[\"std\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}],\"sync\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}]]}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"RwLock\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"use\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token namespace\",\"children\":[\"std\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}]]}],\"thread\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"use\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token namespace\",\"children\":[\"lazy_static\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}]]}],\"lazy_static\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"mod\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token namespace module-declaration\",\"children\":\"file\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// A sync primitive that allows to read/write from variables between threads.\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// we declare the variables here, this requires the lazy_static crate\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token macro property\",\"children\":\"lazy_static!\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"static\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"ref\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token constant\",\"children\":\"FILE1\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"RwLock\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"String\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"RwLock\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"new\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"String\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"from\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"static\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"ref\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token constant\",\"children\":\"FILE2\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"RwLock\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"String\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"RwLock\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"new\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"String\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"from\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"fn\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function function-definition\",\"children\":\"main\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\u003e\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token namespace\",\"children\":[\"io\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}]]}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Result\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token macro property\",\"children\":\"println!\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"program started\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"let\"}],\" thread_1 \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token namespace\",\"children\":[\"thread\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}]]}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"spawn\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token closure-params\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation closure-punctuation\",\"children\":\"|\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation closure-punctuation\",\"children\":\"|\"}]]}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"let\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"mut\"}],\" w1 \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token constant\",\"children\":\"FILE1\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"write\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"unwrap\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],\"w1 \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token namespace\",\"children\":[\"file\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}]]}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"read_file\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"src/file1.txt\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"unwrap\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token macro property\",\"children\":\"println!\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"read file 1\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token macro property\",\"children\":\"println!\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"Launched Thread 1\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"let\"}],\" thread_2 \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token namespace\",\"children\":[\"thread\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}]]}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"spawn\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token closure-params\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation closure-punctuation\",\"children\":\"|\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation closure-punctuation\",\"children\":\"|\"}]]}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"let\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"mut\"}],\" w2 \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token constant\",\"children\":\"FILE2\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"write\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"unwrap\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],\"w2 \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token namespace\",\"children\":[\"file\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}]]}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"read_file\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"src/file2.txt\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"unwrap\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token macro property\",\"children\":\"println!\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"read file 2\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token macro property\",\"children\":\"println!\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"Launched Thread 2\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"let\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"mut\"}],\" rf1\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"bool\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token boolean\",\"children\":\"false\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"let\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"mut\"}],\" rf2\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"bool\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token boolean\",\"children\":\"false\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"loop\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"let\"}],\" r1 \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token constant\",\"children\":\"FILE1\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"read\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"unwrap\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"let\"}],\" r2 \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token constant\",\"children\":\"FILE2\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"read\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"unwrap\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"if\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],\"r1 \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"!=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"String\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"from\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\u0026\"}],\" rf1 \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"==\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token boolean\",\"children\":\"false\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"            \",[\"$\",\"span\",null,{\"className\":\"token macro property\",\"children\":\"println!\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"completed file 1\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"            rf1 \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token boolean\",\"children\":\"true\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"if\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],\"r2 \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"!=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"String\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"from\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\u0026\"}],\" rf2 \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"==\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token boolean\",\"children\":\"false\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"            \",[\"$\",\"span\",null,{\"className\":\"token macro property\",\"children\":\"println!\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"completed file 2\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"            rf2 \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token boolean\",\"children\":\"true\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Ok\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}]]}]}],[\"$\",\"p\",null,{\"children\":[\"Interestingly, if we have a very large \",[\"$\",\"code\",null,{\"children\":\"file1.txt\"}],\", we get a strange output. The second file is processed first (\",[\"$\",\"em\",null,{\"children\":\"read file 2\"}],\"); but inside our loop, the program seems to block and wait for the first file.\"]}],[\"$\",\"$L12\",null,{\"className\":\"language-shell\",\"children\":[\"$\",\"code\",null,{\"className\":\"code-highlight language-shell\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"program started\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"Launched Thread \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"1\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"Launched Thread \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"2\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token class-name builtin\",\"children\":\"read\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"file\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"2\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token class-name builtin\",\"children\":\"read\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"file\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"1\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"completed \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"file\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"1\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"completed \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"file\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"2\"}],\"\\n\"]}]]}]}],[\"$\",\"p\",null,{\"children\":[\"Multi-threading can be a bit tricky because we have to account for the \",[\"$\",\"a\",null,{\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://stackoverflow.com/questions/52196678/what-are-atomic-operations-for-newbies\",\"children\":\"atomic operations\"}],\" which can be \",[\"$\",\"em\",null,{\"children\":\"blocking\"}],\". We used the \",[\"$\",\"code\",null,{\"children\":\"read\"}],\" function to unlock our variable, and the \",[\"$\",\"a\",null,{\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://doc.rust-lang.org/std/sync/struct.RwLock.html\",\"children\":\"documentation\"}],\" warns about this behavior.\"]}],[\"$\",\"blockquote\",null,{\"children\":[\"$\",\"p\",null,{\"children\":\"Locks this rwlock with shared read access, blocking the current thread until it can be acquired.\"}]}],[\"$\",\"p\",null,{\"children\":[\"Luckily, there is a \",[\"$\",\"code\",null,{\"children\":\"try_read\"}],\" function which returns an \",[\"$\",\"code\",null,{\"children\":\"Err\"}],\" if the lock can't be acquired.\"]}],[\"$\",\"blockquote\",null,{\"children\":[[\"$\",\"p\",null,{\"children\":\"Attempts to acquire this rwlock with shared read access.\"}],[\"$\",\"p\",null,{\"children\":[\"If the access could not be granted at this time, then \",[\"$\",\"code\",null,{\"children\":\"Err\"}],\" is returned. Otherwise, an RAII guard is returned which will release the shared access when it is dropped.\"]}]]}],[\"$\",\"p\",null,{\"children\":[\"In this second attempt, we use \",[\"$\",\"code\",null,{\"children\":\"try_read\"}],\" and ignore the \",[\"$\",\"code\",null,{\"children\":\"Err\"}],\"s returned since they should mean our lock is busy. This helps moving our program to the next variable, and handles the one which gets ready first.\"]}],[\"$\",\"p\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"main.rs\"}]}],[\"$\",\"$L12\",null,{\"className\":\"language-rust\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-rust code-highlight\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"use\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token namespace\",\"children\":[\"std\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}]]}],\"io\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"use\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token namespace\",\"children\":[\"std\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}],\"sync\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}]]}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"RwLock\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"use\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token namespace\",\"children\":[\"std\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}]]}],\"thread\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"use\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token namespace\",\"children\":[\"lazy_static\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}]]}],\"lazy_static\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"mod\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token namespace module-declaration\",\"children\":\"file\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token macro property\",\"children\":\"lazy_static!\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"static\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"ref\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token constant\",\"children\":\"FILE1\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"RwLock\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"String\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"RwLock\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"new\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"String\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"from\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"static\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"ref\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token constant\",\"children\":\"FILE2\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"RwLock\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"String\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"RwLock\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"new\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"String\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"from\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"fn\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function function-definition\",\"children\":\"main\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\u003e\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token namespace\",\"children\":[\"io\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}]]}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Result\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token macro property\",\"children\":\"println!\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"program started\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"let\"}],\" thread_1 \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token namespace\",\"children\":[\"thread\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}]]}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"spawn\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token closure-params\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation closure-punctuation\",\"children\":\"|\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation closure-punctuation\",\"children\":\"|\"}]]}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"let\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"mut\"}],\" w1 \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token constant\",\"children\":\"FILE1\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"write\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"unwrap\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],\"w1 \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token namespace\",\"children\":[\"file\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}]]}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"read_file\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"src/file1.txt\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"unwrap\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token macro property\",\"children\":\"println!\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"read file 1\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token macro property\",\"children\":\"println!\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"Launched Thread 1\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"let\"}],\" thread_2 \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token namespace\",\"children\":[\"thread\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}]]}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"spawn\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token closure-params\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation closure-punctuation\",\"children\":\"|\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation closure-punctuation\",\"children\":\"|\"}]]}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"let\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"mut\"}],\" w2 \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token constant\",\"children\":\"FILE2\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"write\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"unwrap\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],\"w2 \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token namespace\",\"children\":[\"file\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}]]}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"read_file\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"src/file2.txt\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"unwrap\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token macro property\",\"children\":\"println!\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"read file 2\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token macro property\",\"children\":\"println!\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"Launched Thread 2\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"let\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"mut\"}],\" rf1\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"bool\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token boolean\",\"children\":\"false\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"let\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"mut\"}],\" rf2\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"bool\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token boolean\",\"children\":\"false\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"loop\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"let\"}],\" r1 \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token constant\",\"children\":\"FILE1\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"try_read\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"let\"}],\" r2 \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token constant\",\"children\":\"FILE2\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"try_read\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"match\"}],\" r1 \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"            \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Ok\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"v\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\u003e\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"                \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"if\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],\"v \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"!=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"String\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"from\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\u0026\"}],\" rf1 \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"==\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token boolean\",\"children\":\"false\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"                    \",[\"$\",\"span\",null,{\"className\":\"token macro property\",\"children\":\"println!\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"completed file 1\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"                    rf1 \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token boolean\",\"children\":\"true\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"                \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"            \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"            \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// If rwlock can't be acquired, ignore the error\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"            \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Err\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"_\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\u003e\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"match\"}],\" r2 \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"            \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Ok\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"v\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\u003e\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"                \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"if\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],\"v \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"!=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"String\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"from\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\u0026\"}],\" rf2 \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"==\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token boolean\",\"children\":\"false\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"                    \",[\"$\",\"span\",null,{\"className\":\"token macro property\",\"children\":\"println!\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"completed file 2\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"                    rf2 \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token boolean\",\"children\":\"true\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"                \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"            \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"            \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// If rwlock can't be acquired, ignore the error\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"            \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Err\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"_\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\u003e\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Ok\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}]]}]}],[\"$\",\"p\",null,{\"children\":[\"Now the execution is different. If \",[\"$\",\"code\",null,{\"children\":\"file1.txt\"}],\" is much bigger than \",[\"$\",\"code\",null,{\"children\":\"file2.txt\"}],\", then the second file should be processed first.\"]}],[\"$\",\"$L12\",null,{\"className\":\"language-shell\",\"children\":[\"$\",\"code\",null,{\"className\":\"code-highlight language-shell\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"program started\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"Launched Thread \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"1\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"Launched Thread \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"2\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token class-name builtin\",\"children\":\"read\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"file\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"2\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"completed \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"file\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"2\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token class-name builtin\",\"children\":\"read\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"file\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"1\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"completed \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"file\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"1\"}],\"\\n\"]}]]}]}],[\"$\",\"h3\",null,{\"id\":\"the-limits-of-multi-threading\",\"children\":[[\"$\",\"a\",null,{\"href\":\"#the-limits-of-multi-threading\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"icon icon-link\"}]}],\"The limits of multi-threading\"]}],[\"$\",\"p\",null,{\"children\":\"Why do we need Async if we already have multi-threading? There are two main advantages: performance and simplicity. Spawning threads is expensive; and as you can conclude from the above, writing multi-threaded code can get quite complicated.\"}],[\"$\",\"p\",null,{\"children\":[\"This answer on \",[\"$\",\"a\",null,{\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://stackoverflow.com/a/42861328/12637\",\"children\":\"stackoverflow\"}],\" touches up on these points.\"]}],[\"$\",\"blockquote\",null,{\"children\":[\"$\",\"p\",null,{\"children\":[\"$\",\"strong\",null,{\"children\":\"Why is async considered better performing than multi-threading?\"}]}]}],[\"$\",\"blockquote\",null,{\"children\":[[\"$\",\"p\",null,{\"children\":\"When your code CPU-bound, there will be a little difference between between Tasks + async/await and pure multi-threaded code. In IO bound code, multi threading is the worst throughput you can have. Tasks + async/await will blow away any IO-bound-threadpool you can write your own. threads don't scale. usually (especially on Server side) you have both. you read some data from a connection (IO), then continue processing it on the CPU (json parsing, calculations etc.) and write the result back to the connection (IO again). Tasks + async/await are faster in this case than a pure multi threaded code.\"}],[\"$\",\"p\",null,{\"children\":\"It's the simplicity which makes async/await so appealing. writing a synchronous code which is actually asynchronous. if this is not \\\"high level programing\\\", what is?\"}]]}],[\"$\",\"p\",null,{\"children\":[\"And that's where Rust Async comes in. Here is a quote for Aaron Turon from \",[\"$\",\"a\",null,{\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://aturon.github.io/blog/2016/08/11/futures/\",\"children\":\"Zero-cost futures in Rust\"}],\" .\"]}],[\"$\",\"blockquote\",null,{\"children\":[\"$\",\"p\",null,{\"children\":\"We’ve wanted something higher level, with better ergonomics, but also better composability, supporting an ecosystem of asynchronous abstractions that all work together. This story might sound familiar: it’s the same goal that’s led to the introduction of futures (aka promises) in many languages, with some supporting async/await sugar on top.\"}]}],[\"$\",\"h3\",null,{\"id\":\"async-the-keywords\",\"children\":[[\"$\",\"a\",null,{\"href\":\"#async-the-keywords\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"icon icon-link\"}]}],\"Async, the keywords\"]}],[\"$\",\"p\",null,{\"children\":[\"Rust focus is to make writing Async code as simple as it can get. You only need to add the \",[\"$\",\"code\",null,{\"children\":\"async/await\"}],\" keywords to make your code Async: \",[\"$\",\"code\",null,{\"children\":\"async\"}],\" before the function declaration and \",[\"$\",\"code\",null,{\"children\":\"await\"}],\" to resolve your \",[\"$\",\"code\",null,{\"children\":\"async\"}],\" functions.\"]}],[\"$\",\"p\",null,{\"children\":\"That sounds great. Let's give it a try.\"}],[\"$\",\"p\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"file.rs\"}]}],[\"$\",\"$L12\",null,{\"className\":\"language-rust\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-rust code-highlight\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"use\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token namespace\",\"children\":[\"std\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}],\"fs\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}]]}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"File\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"use\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token namespace\",\"children\":[\"std\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}],\"io\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}]]}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"self\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Read\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"pub\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"async\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"fn\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function function-definition\",\"children\":\"read_file\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"path\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"str\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\u003e\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token namespace\",\"children\":[\"io\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}]]}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Result\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"String\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"let\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"mut\"}],\" file \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"File\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"open\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"path\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"?\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"let\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"mut\"}],\" buffer \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"String\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"new\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    file\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"read_to_string\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"mut\"}],\" buffer\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"?\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Ok\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"buffer\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}]]}]}],[\"$\",\"p\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"main.rs\"}]}],[\"$\",\"$L12\",null,{\"className\":\"language-rust\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-rust code-highlight\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"use\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token namespace\",\"children\":[\"std\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}]]}],\"io\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"mod\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token namespace module-declaration\",\"children\":\"file\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"fn\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function function-definition\",\"children\":\"main\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\u003e\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token namespace\",\"children\":[\"io\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}]]}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Result\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"let\"}],\" r1 \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token namespace\",\"children\":[\"file\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}]]}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"read_file\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"src/file1.txt\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"let\"}],\" r2 \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token namespace\",\"children\":[\"file\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}]]}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"read_file\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"src/file2.txt\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"let\"}],\" f1 \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" r1\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"await\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"let\"}],\" f2 \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" r2\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"await\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token macro property\",\"children\":\"dbg!\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"f1\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token macro property\",\"children\":\"dbg!\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"f2\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Ok\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}]]}]}],[\"$\",\"p\",null,{\"children\":[\"This doesn't work, however. \",[\"$\",\"code\",null,{\"children\":\"await\"}],\" is available only inside an \",[\"$\",\"code\",null,{\"children\":\"async\"}],\" block or function. If we try to run this code, the compiler will throw this error.\"]}],[\"$\",\"$L12\",null,{\"className\":\"language-shell\",\"children\":[\"$\",\"code\",null,{\"className\":\"code-highlight language-shell\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"error\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"[\"}],\"E0728\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"]\"}],\": \",[\"$\",\"span\",null,{\"className\":\"token variable\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token variable\",\"children\":\"`\"}],\"await\",[\"$\",\"span\",null,{\"className\":\"token variable\",\"children\":\"`\"}]]}],\" is only allowed inside \",[\"$\",\"span\",null,{\"className\":\"token variable\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token variable\",\"children\":\"`\"}],\"async\",[\"$\",\"span\",null,{\"className\":\"token variable\",\"children\":\"`\"}]]}],\" functions and blocks\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\" --\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\"}],\" src/main.rs:9:14\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"|\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"5\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"|\"}],\" fn main\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" -\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\"}],\" io::Result\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"|\"}],\"    ---- this is not \",[\"$\",\"span\",null,{\"className\":\"token variable\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token variable\",\"children\":\"`\"}],\"async\",[\"$\",\"span\",null,{\"className\":\"token variable\",\"children\":\"`\"}]]}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"..\"}],\".\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"9\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"|\"}],\"     \",[\"$\",\"span\",null,{\"className\":\"token class-name builtin\",\"children\":\"let\"}],\" f1 \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" r1.await\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"|\"}],\"              ^^^^^^^^ only allowed inside \",[\"$\",\"span\",null,{\"className\":\"token variable\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token variable\",\"children\":\"`\"}],\"async\",[\"$\",\"span\",null,{\"className\":\"token variable\",\"children\":\"`\"}]]}],\" functions and blocks\\n\"]}]]}]}],[\"$\",\"p\",null,{\"children\":[\"Can we make the \",[\"$\",\"code\",null,{\"children\":\"main\"}],\" function async? Unfortunately, it's not that simple; we get another error.\"]}],[\"$\",\"$L12\",null,{\"className\":\"language-shell\",\"children\":[\"$\",\"code\",null,{\"className\":\"code-highlight language-shell\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"error\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"[\"}],\"E0277\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"]\"}],\": \",[\"$\",\"span\",null,{\"className\":\"token variable\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token variable\",\"children\":\"`\"}],\"main\",[\"$\",\"span\",null,{\"className\":\"token variable\",\"children\":\"`\"}]]}],\" has invalid \",[\"$\",\"span\",null,{\"className\":\"token class-name builtin\",\"children\":\"return\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name builtin\",\"children\":\"type\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token variable\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token variable\",\"children\":\"`\"}],\"impl std::future::Future\",[\"$\",\"span\",null,{\"className\":\"token variable\",\"children\":\"`\"}]]}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\" --\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\"}],\" src/main.rs:5:20\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"|\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"5\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"|\"}],\" async fn main\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" -\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\"}],\" io::Result\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"|\"}],\"                    ^^^^^^^^^^^^^^ \",[\"$\",\"span\",null,{\"className\":\"token variable\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token variable\",\"children\":\"`\"}],\"main\",[\"$\",\"span\",null,{\"className\":\"token variable\",\"children\":\"`\"}]]}],\" can only \",[\"$\",\"span\",null,{\"className\":\"token class-name builtin\",\"children\":\"return\"}],\" types that implement \",[\"$\",\"span\",null,{\"className\":\"token variable\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token variable\",\"children\":\"`\"}],\"std::process::Termination\",[\"$\",\"span\",null,{\"className\":\"token variable\",\"children\":\"`\"}]]}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"|\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" help: consider using \",[\"$\",\"span\",null,{\"className\":\"token variable\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token variable\",\"children\":\"`\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token variable\",\"children\":\"`\"}]]}],\", or a \",[\"$\",\"span\",null,{\"className\":\"token variable\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token variable\",\"children\":\"`\"}],\"Result\",[\"$\",\"span\",null,{\"className\":\"token variable\",\"children\":\"`\"}]]}],\"\\n\"]}]]}]}],[\"$\",\"p\",null,{\"children\":[\"The error message is a bit intriguing, though. It seems that the \",[\"$\",\"code\",null,{\"children\":\"async\"}],\" keyword makes our function return a \",[\"$\",\"code\",null,{\"children\":\"Future\"}],\" instead of the declared type.\"]}],[\"$\",\"p\",null,{\"children\":[\"Here is some excerpt from the \",[\"$\",\"a\",null,{\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://github.com/rust-lang/rfcs/blob/master/text/2394-async_await.md\",\"children\":\"async-await RFC\"}],\".\"]}],[\"$\",\"blockquote\",null,{\"children\":[\"$\",\"p\",null,{\"children\":\"The return type of an async function is a unique anonymous type generated by the compiler, similar to the type of a closure. You can think of this type as being like an enum, with one variant for every \\\"yield point\\\" of the function - the beginning of it, the await expressions, and every return. Each variant stores the state that is needed to be stored to resume control from that yield point.\"}]}],[\"$\",\"p\",null,{\"children\":[\"The return type of an async function is a \",[\"$\",\"a\",null,{\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://doc.rust-lang.org/std/future/trait.Future.html\",\"children\":\"Future\"}],\" (precisely, a closure that implements the Future trait).\"]}],[\"$\",\"blockquote\",null,{\"children\":[\"$\",\"p\",null,{\"children\":\"The anonymous return type implements Future, with the return type as its Item.\"}]}],[\"$\",\"p\",null,{\"children\":[\"What about \",[\"$\",\"code\",null,{\"children\":\"await\"}],\"? From the same RFC.\"]}],[\"$\",\"blockquote\",null,{\"children\":[\"$\",\"p\",null,{\"children\":\"The await! builtin expands roughly to this:\"}]}],[\"$\",\"$L12\",null,{\"className\":\"language-rust\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-rust code-highlight\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"let\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"mut\"}],\" future \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"IntoFuture\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"into_future\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token variable\",\"children\":\"$$expression\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"let\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"mut\"}],\" pin \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"unsafe\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Pin\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"new_unchecked\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"mut\"}],\" future\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"loop\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"match\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Future\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"poll\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Pin\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"borrow\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"mut\"}],\" pin\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"mut\"}],\" ctx\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"          \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Poll\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Ready\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"item\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\u003e\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"break\"}],\" item\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"          \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Poll\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Pending\"}],\"     \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\u003e\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"yield\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}]]}]}],[\"$\",\"blockquote\",null,{\"children\":[\"$\",\"p\",null,{\"children\":\"This is not a literal expansion, because the yield concept cannot be expressed in the surface syntax within async functions. This is why await! is a compiler builtin instead of an actual macro.\"}]}],[\"$\",\"p\",null,{\"children\":[\"So roughly speaking: \",[\"$\",\"code\",null,{\"children\":\"async\"}],\" makes our function a \",[\"$\",\"code\",null,{\"children\":\"Future\"}],\". \",[\"$\",\"code\",null,{\"children\":\"await\"}],\" loops through that future until completion. However, there is another missing piece of the puzzle: Rust doesn't resolve the future on its own. We need an executor that is going to run this Async code.\"]}],[\"$\",\"h3\",null,{\"id\":\"what-is-an-executor\",\"children\":[[\"$\",\"a\",null,{\"href\":\"#what-is-an-executor\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"icon icon-link\"}]}],\"What is an executor?\"]}],[\"$\",\"p\",null,{\"children\":[\"If you rewind to our multi-threading example, you'll notice that we used a \",[\"$\",\"code\",null,{\"children\":\"loop\"}],\" in order to detect when our files were processed. It was simple: Loop infinitely until there is some content in the variable and then do something. We could have improved on that by breaking out of the loop if both files are read.\"]}],[\"$\",\"p\",null,{\"children\":[\"An Async executor is the loop. Rust, by default, doesn't have any built-in executors. There is a number of Async run-times; \",[\"$\",\"a\",null,{\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://async.rs/\",\"children\":\"async-std\"}],\" and \",[\"$\",\"a\",null,{\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://tokio.rs/\",\"children\":\"Tokio\"}],\" being the most popular ones. The job of a run-time is to poll your async functions (\",[\"$\",\"code\",null,{\"children\":\"Future\"}],\"s) until they finally return a value.\"]}],[\"$\",\"p\",null,{\"children\":[\"This \",[\"$\",\"a\",null,{\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://www.reddit.com/r/rust/comments/d1obg6/with_asyncawait_i_dont_get_what_runs_the_await/ezoxzjn/\",\"children\":\"discussion\"}],\" on Reddit has more details, but you can ignore the specifics for now.\"]}],[\"$\",\"blockquote\",null,{\"children\":[\"$\",\"p\",null,{\"children\":\"Creating/Composing a future object (for example, by calling an async function which calls another async function) does not involve any progress. Only when you pass it to something that actively polls it, the future object starts its work and makes progress (poll by poll). At that point, we refer to the whole future thingy as a task. A suspension point simply makes a call to the future's poll method return immediately with a Poll::Pending value if the value is not ready yet.\"}]}],[\"$\",\"h3\",null,{\"id\":\"a-simple-executor\",\"children\":[[\"$\",\"a\",null,{\"href\":\"#a-simple-executor\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"icon icon-link\"}]}],\"A simple executor\"]}],[\"$\",\"p\",null,{\"children\":[\"The \",[\"$\",\"a\",null,{\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://crates.io/crates/futures\",\"children\":\"futures\"}],\" crate has a very basic executor, and a function to join two \",[\"$\",\"code\",null,{\"children\":\"Future\"}],\"s. Let's give it a shot.\"]}],[\"$\",\"p\",null,{\"children\":[\"$\",\"em\",null,{\"children\":[\"The following code uses the \",[\"$\",\"a\",null,{\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://crates.io/crates/futures\",\"children\":\"futures\"}],\" crate version 0.3.4\"]}]}],[\"$\",\"p\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"main.rs\"}]}],[\"$\",\"$L12\",null,{\"className\":\"language-rust\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-rust code-highlight\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"use\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token namespace\",\"children\":[\"futures\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}],\"executor\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}]]}],\"block_on\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"use\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token namespace\",\"children\":[\"futures\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}]]}],\"join\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"use\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token namespace\",\"children\":[\"std\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}]]}],\"io\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"mod\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token namespace module-declaration\",\"children\":\"file\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"fn\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function function-definition\",\"children\":\"main\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\u003e\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token namespace\",\"children\":[\"io\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}]]}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Result\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token macro property\",\"children\":\"println!\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"Program started\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// Block on the final future\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"block_on\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"load_files\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Ok\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"async\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"fn\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function function-definition\",\"children\":\"load_files\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// Join the two futures together\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token macro property\",\"children\":\"join!\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"load_file_1\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"load_file_2\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"async\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"fn\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function function-definition\",\"children\":\"load_file_1\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"let\"}],\" r1 \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token namespace\",\"children\":[\"file\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}]]}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"read_file\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"src/file1.txt\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"await\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token macro property\",\"children\":\"println!\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"file 1 size: {}\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" r1\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"unwrap\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"len\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"async\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"fn\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function function-definition\",\"children\":\"load_file_2\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"let\"}],\" r2 \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token namespace\",\"children\":[\"file\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}]]}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"read_file\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"src/file2.txt\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"await\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token macro property\",\"children\":\"println!\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"file 2 size: {}\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" r2\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"unwrap\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"len\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}]]}]}],[\"$\",\"p\",null,{\"children\":[\"To verify the asynchronicity, I dumped a bunch of data in \",[\"$\",\"code\",null,{\"children\":\"file1.txt\"}],\". Rust is pretty fast; at the time of testing this, \",[\"$\",\"code\",null,{\"children\":\"file1.txt\"}],\" had over 5Gb of text.\"]}],[\"$\",\"$L12\",null,{\"className\":\"language-shell\",\"children\":[\"$\",\"code\",null,{\"className\":\"code-highlight language-shell\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"Program started\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"file\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"1\"}],\" size: \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"5430447414\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"file\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"2\"}],\" size: \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"7\"}],\"\\n\"]}]]}]}],[\"$\",\"p\",null,{\"children\":\"Unfortunately, this looks like (and it is) blocking on the first file function, again.\"}],[\"$\",\"h3\",null,{\"id\":\"so-what-is-async-anyway\",\"children\":[[\"$\",\"a\",null,{\"href\":\"#so-what-is-async-anyway\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"icon icon-link\"}]}],\"So what is Async anyway?\"]}],[\"$\",\"p\",null,{\"children\":[\"Similar to multi-threading, there are some gotchas and things to worry about in Async programming. The truth is, the \",[\"$\",\"code\",null,{\"children\":\"async\"}],\" keyword doesn't magically make your code async; it just makes your function return a \",[\"$\",\"code\",null,{\"children\":\"Future\"}],\". You still have to do the heavy lifting of \",[\"$\",\"em\",null,{\"children\":\"scheduling\"}],\" your code execution.\"]}],[\"$\",\"p\",null,{\"children\":[\"This means that your function has to return quickly that it's not ready instead of being stuck doing calculations. In our case, the clogging is happening specifically at \",[\"$\",\"code\",null,{\"children\":\"File::Open\"}],\" and \",[\"$\",\"code\",null,{\"children\":\"file.read_to_string\"}],\". These two functions are not \",[\"$\",\"code\",null,{\"children\":\"async\"}],\" and therefore block execution.\"]}],[\"$\",\"p\",null,{\"children\":[\"We need to create an Async version of these two functions. Luckily, some handsome people over \",[\"$\",\"a\",null,{\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://async.rs/\",\"children\":\"async-std\"}],\" did the hard work of rewriting the std library in Rust to an async version.\"]}],[\"$\",\"blockquote\",null,{\"children\":[\"$\",\"p\",null,{\"children\":\"This crate provides an async version of std. It provides all the interfaces you are used to, but in an async version and ready for Rust's async/await syntax.\"}]}],[\"$\",\"h3\",null,{\"id\":\"file-io-with-async-std\",\"children\":[[\"$\",\"a\",null,{\"href\":\"#file-io-with-async-std\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"icon icon-link\"}]}],\"File IO with async-std\"]}],[\"$\",\"p\",null,{\"children\":[\"The only change we have to make is to replace our \",[\"$\",\"code\",null,{\"children\":\"std\"}],\" imports with \",[\"$\",\"code\",null,{\"children\":\"async_std\"}],\".\"]}],[\"$\",\"p\",null,{\"children\":[\"$\",\"em\",null,{\"children\":[\"For the following example, we are using the \",[\"$\",\"a\",null,{\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://crates.io/crates/async-std/1.5.0\",\"children\":\"async-std\"}],\" crate version 1.5.0\"]}]}],[\"$\",\"p\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"file.rs\"}]}],[\"$\",\"$L12\",null,{\"className\":\"language-rust\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-rust code-highlight\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// We use async_std instead of std, it's that simple.\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"use\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token namespace\",\"children\":[\"async_std\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}]]}],\"io\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"use\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token namespace\",\"children\":[\"async_std\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}],\"fs\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}]]}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"File\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"use\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token namespace\",\"children\":[\"async_std\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}],\"prelude\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}]]}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"pub\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"async\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"fn\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function function-definition\",\"children\":\"read_file\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"path\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"str\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\u003e\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token namespace\",\"children\":[\"io\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}]]}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Result\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"String\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"let\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"mut\"}],\" file \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"File\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"open\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"path\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"await\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"?\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"let\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"mut\"}],\" buffer \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"String\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"new\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    file\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"read_to_string\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"mut\"}],\" buffer\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"await\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"?\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Ok\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"buffer\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}]]}]}],[\"$\",\"p\",null,{\"children\":[\"The code in \",[\"$\",\"code\",null,{\"children\":\"main.rs\"}],\" remains the same; the program is still using the \",[\"$\",\"code\",null,{\"children\":\"block_on\"}],\" executor from the \",[\"$\",\"code\",null,{\"children\":\"futures\"}],\" crates.\"]}],[\"$\",\"p\",null,{\"children\":[\"Compile and run the program. (make sure to have a fat \",[\"$\",\"code\",null,{\"children\":\"file1.txt\"}],\")\"]}],[\"$\",\"$L12\",null,{\"className\":\"language-shell\",\"children\":[\"$\",\"code\",null,{\"className\":\"code-highlight language-shell\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"Program started\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"file\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"2\"}],\" size: \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"7\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"file\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"1\"}],\" size: \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"5430447414\"}],\"\\n\"]}]]}]}],[\"$\",\"p\",null,{\"children\":[\"Finally! \",[\"$\",\"code\",null,{\"children\":\"file2.txt\"}],\" gets processed first and fast here, then the program moves to \",[\"$\",\"code\",null,{\"children\":\"file1.txt\"}],\".\"]}],[\"$\",\"h3\",null,{\"id\":\"manually-implementing-async-with-futures\",\"children\":[[\"$\",\"a\",null,{\"href\":\"#manually-implementing-async-with-futures\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"icon icon-link\"}]}],\"Manually implementing Async with Futures\"]}],[\"$\",\"p\",null,{\"children\":\"Let's recap what we learned so far:\"}],[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"async\"}],\" makes our function return a \",[\"$\",\"code\",null,{\"children\":\"Future\"}],\".\"]}],[\"$\",\"li\",null,{\"children\":[\"Running our \",[\"$\",\"code\",null,{\"children\":\"Future\"}],\" requires a run-time.\"]}],[\"$\",\"li\",null,{\"children\":[\"The run-time checks if our \",[\"$\",\"code\",null,{\"children\":\"Future\"}],\" is ready; and when ready returns its value.\"]}]]}],[\"$\",\"p\",null,{\"children\":[\"One more thing to add: Rust futures are \",[\"$\",\"em\",null,{\"children\":\"lazy\"}],\". The executor doesn't constantly \",[\"$\",\"em\",null,{\"children\":\"poll\"}],\" the \",[\"$\",\"code\",null,{\"children\":\"Future\"}],\" but instead waits for the \",[\"$\",\"code\",null,{\"children\":\"Future\"}],\" to signal that it is due for a poll.\"]}],[\"$\",\"p\",null,{\"children\":[\"The future we will design is rather useless but could demonstrate how progress is made during execution. The future object holds some state (an \",[\"$\",\"code\",null,{\"children\":\"i32\"}],\" field named \",[\"$\",\"code\",null,{\"children\":\"counter\"}],\"). At each \",[\"$\",\"code\",null,{\"children\":\"poll\"}],\", we increment our \",[\"$\",\"code\",null,{\"children\":\"counter\"}],\" by one, and then schedule another \",[\"$\",\"code\",null,{\"children\":\"poll\"}],\".\"]}],[\"$\",\"p\",null,{\"children\":\"To demonstrate task switching, we'll create two different Future types. Their functionality is identical, though.\"}],[\"$\",\"p\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"main.rs\"}]}],[\"$\",\"$L12\",null,{\"className\":\"language-rust\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-rust code-highlight\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"use\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token namespace\",\"children\":[\"futures\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}],\"executor\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}]]}],\"block_on\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"use\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token namespace\",\"children\":[\"futures\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}]]}],\"join\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"mod\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token namespace module-declaration\",\"children\":\"asyncop\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"use\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token namespace\",\"children\":[\"asyncop\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}]]}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Task1\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Task2\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"fn\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function function-definition\",\"children\":\"main\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// Wait for the joined future completion\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"block_on\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"asyncop\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"async\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"fn\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function function-definition\",\"children\":\"asyncop\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// Join the two futures\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token macro property\",\"children\":\"join!\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"fut1\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"fut2\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// Future 1\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"fn\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function function-definition\",\"children\":\"fut1\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\u003e\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Task1\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Task1\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\" count\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"0\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// Future 2\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"fn\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function function-definition\",\"children\":\"fut2\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\u003e\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Task2\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Task2\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\" count\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"0\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}]]}]}],[\"$\",\"p\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"asyncop.rs\"}]}],[\"$\",\"$L12\",null,{\"className\":\"language-rust\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-rust code-highlight\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"use\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token namespace\",\"children\":[\"std\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}],\"future\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}]]}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Future\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"use\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token namespace\",\"children\":[\"std\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}],\"pin\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}]]}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Pin\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"use\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token namespace\",\"children\":[\"std\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}],\"task\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}]]}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Context\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Poll\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token attr-name attribute\",\"children\":\"#[derive(Debug)]\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"pub\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"struct\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name type-definition\",\"children\":\"Task1\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"pub\"}],\" count\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"i32\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"impl\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Future\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"for\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Task1\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"type\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name type-definition\",\"children\":\"Output\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"fn\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function function-definition\",\"children\":\"poll\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"self\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Pin\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"mut\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"Self\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" cx\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"mut\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Context\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token lifetime-annotation symbol\",\"children\":\"'_\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\u003e\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Poll\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"Self\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Output\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// If counter reaches 99, our future is ready\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"if\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"self\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"count \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"100\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"            \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Poll\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Ready\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"else\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"            \",[\"$\",\"span\",null,{\"className\":\"token macro property\",\"children\":\"println!\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"Task 1 Progress - {}\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"self\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"count\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"            \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// Increment counter\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"            \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"self\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"get_mut\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"count \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"+=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"1\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"            \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// Schedule future for another poll()\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"            cx\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"waker\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"clone\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"wake\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"            \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Poll\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Pending\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token attr-name attribute\",\"children\":\"#[derive(Debug)]\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"pub\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"struct\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name type-definition\",\"children\":\"Task2\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"pub\"}],\" count\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"i32\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"impl\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Future\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"for\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Task2\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"type\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name type-definition\",\"children\":\"Output\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"fn\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function function-definition\",\"children\":\"poll\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"self\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Pin\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"mut\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"Self\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" cx\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"mut\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Context\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token lifetime-annotation symbol\",\"children\":\"'_\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\u003e\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Poll\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"Self\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Output\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// If counter reaches 99, our future is ready\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"if\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"self\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"count \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"100\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"            \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Poll\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Ready\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"else\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"            \",[\"$\",\"span\",null,{\"className\":\"token macro property\",\"children\":\"println!\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"Task 2 Progress - {}\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"self\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"count\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"            \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// Increment counter\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"            \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"self\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"get_mut\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"count \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"+=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"1\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"            \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// Schedule future for another poll()\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"            cx\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"waker\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"clone\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"wake\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"            \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Poll\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Pending\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}]]}]}],[\"$\",\"p\",null,{\"children\":[\"The output on execution demonstrates how the executor is switching between \",[\"$\",\"em\",null,{\"children\":\"Future 1\"}],\" and \",[\"$\",\"em\",null,{\"children\":\"Future 2\"}],\".\"]}],[\"$\",\"$L12\",null,{\"className\":\"language-shell\",\"children\":[\"$\",\"code\",null,{\"className\":\"code-highlight language-shell\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"..\"}],\".\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"Task \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"1\"}],\" Progress - \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"95\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"Task \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"2\"}],\" Progress - \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"95\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"Task \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"1\"}],\" Progress - \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"96\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"Task \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"2\"}],\" Progress - \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"96\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"Task \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"1\"}],\" Progress - \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"97\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"Task \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"2\"}],\" Progress - \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"97\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"Task \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"1\"}],\" Progress - \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"98\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"Task \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"2\"}],\" Progress - \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"98\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"Task \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"1\"}],\" Progress - \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"99\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"Task \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"2\"}],\" Progress - \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"99\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"Task \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"1\"}],\" Progress - \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"100\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"Task \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"2\"}],\" Progress - \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"100\"}],\"\\n\"]}]]}]}],[\"$\",\"h3\",null,{\"id\":\"wrap-up\",\"children\":[[\"$\",\"a\",null,{\"href\":\"#wrap-up\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"icon icon-link\"}]}],\"Wrap-up\"]}],[\"$\",\"p\",null,{\"children\":[\"In this post we covered synchronous code, multi-threaded code, some Async terminology in Rust, the async-std library and a simple \",[\"$\",\"code\",null,{\"children\":\"Future\"}],\" implementation. This is, really, a lightweight introduction and many of the specifics were omitted for brevity.\"]}],[\"$\",\"p\",null,{\"children\":\"I've compiled a list of resources below if you want to explore more.\"}],[\"$\",\"h4\",null,{\"id\":\"further-resources-on-async-rust\",\"children\":[[\"$\",\"a\",null,{\"href\":\"#further-resources-on-async-rust\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"icon icon-link\"}]}],\"Further resources on Async Rust\"]}],[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://rust-lang.github.io/async-book/\",\"children\":\"Asynchronous Programming in Rust\"}]}],[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://cfsamson.github.io/book-exploring-async-basics/introduction.html\",\"children\":\"The Node Experiment - Exploring Async Basics with Rust\"}]}],[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://cfsamson.gitbook.io/green-threads-explained-in-200-lines-of-rust/\",\"children\":\"Green threads explained in 200 lines of Rust\"}]}],[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://www.viget.com/articles/understanding-futures-in-rust-part-1/\",\"children\":\"Understanding Futures In Rust -- Part 1\"}]}],[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://www.viget.com/articles/understanding-futures-is-rust-part-2/\",\"children\":\"Understanding Futures In Rust -- Part 2\"}]}],[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://dev.to/iam_aprogrammer/pinning-asynchronous-programming-in-rust-why-what-and-how-3eal\",\"children\":\"Pinning - Asynchronous Programming in Rust: Why, What, and How\"}]}],[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://tmandry.gitlab.io/blog/posts/optimizing-await-1/\",\"children\":\"How Rust optimizes async/await I\"}]}],[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://tmandry.gitlab.io/blog/posts/optimizing-await-2/\",\"children\":\"How Rust optimizes async/await II: Program analysis\"}]}]]}]],[\"$\",\"$L13\",null,{}]]}]}]]}]]}]]\n"])</script><script>self.__next_f.push([1,"7:[[\"$\",\"meta\",\"0\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}],[\"$\",\"meta\",\"1\",{\"charSet\":\"utf-8\"}],[\"$\",\"title\",\"2\",{\"children\":\"A primer to Rust Async | Omar Abid - Personal Blog\"}],[\"$\",\"meta\",\"3\",{\"name\":\"description\",\"content\":\"An introduction to Rust Async programming\"}],[\"$\",\"meta\",\"4\",{\"name\":\"robots\",\"content\":\"index, follow\"}],[\"$\",\"meta\",\"5\",{\"name\":\"googlebot\",\"content\":\"index, follow, max-video-preview:-1, max-image-preview:large, max-snippet:-1\"}],[\"$\",\"link\",\"6\",{\"rel\":\"canonical\",\"href\":\"https://omarabid.com/async-rust\"}],[\"$\",\"link\",\"7\",{\"rel\":\"alternate\",\"type\":\"application/rss+xml\",\"href\":\"https://omarabid.com/feed.xml\"}],[\"$\",\"meta\",\"8\",{\"property\":\"og:title\",\"content\":\"A primer to Rust Async\"}],[\"$\",\"meta\",\"9\",{\"property\":\"og:description\",\"content\":\"An introduction to Rust Async programming\"}],[\"$\",\"meta\",\"10\",{\"property\":\"og:url\",\"content\":\"https://omarabid.com/async-rust\"}],[\"$\",\"meta\",\"11\",{\"property\":\"og:site_name\",\"content\":\"Omar Abid - Personal Blog\"}],[\"$\",\"meta\",\"12\",{\"property\":\"og:locale\",\"content\":\"en_US\"}],[\"$\",\"meta\",\"13\",{\"property\":\"og:type\",\"content\":\"article\"}],[\"$\",\"meta\",\"14\",{\"property\":\"article:published_time\",\"content\":\"2020-02-10T00:00:00.000Z\"}],[\"$\",\"meta\",\"15\",{\"property\":\"article:modified_time\",\"content\":\"2020-02-10T00:00:00.000Z\"}],[\"$\",\"meta\",\"16\",{\"name\":\"twitter:card\",\"content\":\"summary_large_image\"}],[\"$\",\"meta\",\"17\",{\"name\":\"twitter:title\",\"content\":\"A primer to Rust Async\"}],[\"$\",\"meta\",\"18\",{\"name\":\"twitter:description\",\"content\":\"An introduction to Rust Async programming\"}],[\"$\",\"meta\",\"19\",{\"name\":\"next-size-adjust\"}]]\n"])</script><script>self.__next_f.push([1,"f:null\n"])</script><script>self.__next_f.push([1,""])</script></body></html>