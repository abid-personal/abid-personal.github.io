<!DOCTYPE html><html lang="en-us" class="__variable_bc0dcf scroll-smooth"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" href="/_next/static/media/7cba1811e3c25a15-s.p.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="stylesheet" href="/_next/static/css/cd219d613ad8989f.css" crossorigin="" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/959e61cd6bf7e234.css" crossorigin="" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/c1c99bc127b9f571.css" crossorigin="" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-ecd884431e5f35c6.js" crossorigin=""/><script src="/_next/static/chunks/fd9d1056-8aef1845bba99dc3.js" async="" crossorigin=""></script><script src="/_next/static/chunks/472-d0e0ddc81fc62ec9.js" async="" crossorigin=""></script><script src="/_next/static/chunks/main-app-e720945cf7a6a687.js" async="" crossorigin=""></script><script src="/_next/static/chunks/9da6db1e-fe005e7e52eb3467.js" async=""></script><script src="/_next/static/chunks/326-f0b929b9e51900a5.js" async=""></script><script src="/_next/static/chunks/app/layout-2ffae3625ca75b72.js" async=""></script><script src="/_next/static/chunks/app/(blog)/%5B...slug%5D/page-47a78e5a6d2fc851.js" async=""></script><title>GPT-3.5 and the latest models | Omar Abid - Personal Blog</title><meta name="description" content="Comparing GPT-3.5 to the latest models."/><meta name="robots" content="index, follow"/><meta name="googlebot" content="index, follow, max-video-preview:-1, max-image-preview:large, max-snippet:-1"/><link rel="canonical" href="https://omarabid.com/gpt3-now"/><link rel="alternate" type="application/rss+xml" href="https://omarabid.com/feed.xml"/><meta property="og:title" content="GPT-3.5 and the latest models"/><meta property="og:description" content="Comparing GPT-3.5 to the latest models."/><meta property="og:url" content="https://omarabid.com/gpt3-now"/><meta property="og:site_name" content="Omar Abid - Personal Blog"/><meta property="og:locale" content="en_US"/><meta property="og:type" content="article"/><meta property="article:published_time" content="2025-03-12T00:00:00.000Z"/><meta property="article:modified_time" content="2025-03-12T00:00:00.000Z"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:title" content="GPT-3.5 and the latest models"/><meta name="twitter:description" content="Comparing GPT-3.5 to the latest models."/><meta name="next-size-adjust"/><link rel="apple-touch-icon" sizes="76x76" href="/favicon.svg"/><link rel="icon" type="image/png" sizes="32x32" href="/favicon.svg"/><link rel="icon" type="image/png" sizes="16x16" href="/favicon.svg"/><link rel="manifest" href="/static/favicons/site.webmanifest"/><link rel="mask-icon" href="/favicon.svg" color="#5bbad5"/><meta name="msapplication-TileColor" content="#000000"/><meta name="theme-color" media="(prefers-color-scheme: light)" content="#fff"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#000"/><link rel="alternate" type="application/rss+xml" href="/feed.xml"/><script src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js" crossorigin="" noModule=""></script></head><body class="m-auto max-w-2xl dark:text-gray-100"><script>!function(){try{var d=document.documentElement,c=d.classList;c.remove('light','dark');var e=localStorage.getItem('theme');if('system'===e||(!e&&true)){var t='(prefers-color-scheme: dark)',m=window.matchMedia(t);if(m.media!==t||m.matches){d.style.colorScheme = 'dark';c.add('dark')}else{d.style.colorScheme = 'light';c.add('light')}}else if(e){c.add(e|| '')}if(e==='light'||e==='dark')d.style.colorScheme=e}catch(e){}}()</script><main class="min-h-screen p-6 pt-3 md:pt-6"><header class="mb-5 flex items-center md:mb-10"><span class="text-md whitespace-nowrap font-bold md:text-lg"><a class="-ml-2 rounded-sm p-2 transition-[background-color] hover:bg-gray-200 active:bg-gray-300 dark:hover:bg-[#313131] dark:active:bg-[#242424]" href="/">Omar Abid</a></span><nav class="flex grow items-center justify-end gap-1 font-mono text-xs md:gap-3"><a class="inline-flex rounded-sm p-2 transition-[background-color] hover:bg-gray-200 active:bg-gray-300 dark:hover:bg-[#313131] dark:active:bg-[#242424]" href="/about">About</a></nav></header><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","headline":"GPT-3.5 and the latest models","datePublished":"2025-03-12T00:00:00.000Z","dateModified":"2025-03-12T00:00:00.000Z","description":"Comparing GPT-3.5 to the latest models.","url":"https://omarabid.com/gpt3-now","author":[{"@type":"Person"}]}</script><section class="mx-auto max-w-3xl px-4 sm:px-6 xl:max-w-5xl xl:px-0"><div class="fixed bottom-8 right-8 hidden flex-col gap-3 md:hidden"><button aria-label="Scroll To Top" class="rounded-full bg-gray-200 p-2 text-gray-500 transition-all hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-400 dark:hover:bg-gray-600"><svg height="24" viewBox="0 0 48 48" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M14.83 30.83l9.17-9.17 9.17 9.17 2.83-2.83-12-12-12 12z"></path><path d="M0 0h48v48h-48z" fill="none"></path></svg></button></div><div class="xl:divide-y xl:divide-gray-200 xl:dark:divide-gray-700"><header class="pt-6 xl:pb-6"><h1 class="text-2xl font-bold mb-1 dark:text-gray-100">GPT-3.5 and the latest models</h1><p class="font-mono flex text-xs text-gray-500 dark:text-gray-500"><span class="flex-grow"><span class="hidden md:inline"><span><a href="https://github.com/omarabid" class="hover:text-gray-800 dark:hover:text-gray-400" target="_blank">@omarabid</a></span><span class="mx-2">|</span></span><span><time dateTime="2025-03-12T00:00:00.000Z">Wednesday, March 12, 2025</time></span></span><span class="pr-1.5"></span></p></header><article class="text-gray-800 dark:text-gray-300 mb-10"><div class="prose max-w-none pb-8 pt-10 dark:prose-invert"><p>There is a lot of discussion about LLM benchmarks. The issue is that if models are getting better at benchmarks, why are they not getting smarter for use cases?</p><p>A simple run that I had lately, had me curious to see what GPT-3.5-turbo would answer. It is the oldest model that is still available on the Open AI API and was released in early 23. That&#x27;s two years ago.</p><p>First, the code. Nothing out of the ordinary but kinda random. I am creating a custom <a target="_blank" rel="noopener noreferrer" href="https://en.wikipedia.org/wiki/Publish%E2%80%93subscribe_pattern">Event Bus</a> in Rust for a Wasm worker. The goal is to be able to tag a function with proc-macros and have it executed when a certain event is emitted.</p><p>However, the code at this stage is still a very early prototype. The EventBus struct holds two HashMaps, one for events and one for handlers. Can you spot the issue with the handlers HashMap?</p><div class="relative"><pre><code class="language-rust code-highlight"><span class="code-line"><span class="token keyword">mod</span> <span class="token namespace module-declaration">hooks</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token keyword">mod</span> <span class="token namespace module-declaration">macros</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span></span><span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token namespace">any<span class="token punctuation">::</span></span><span class="token class-name">Any</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token namespace">cell<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token class-name">OnceCell</span><span class="token punctuation">,</span> <span class="token class-name">RefCell</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token namespace">collections<span class="token punctuation">::</span></span><span class="token class-name">HashMap</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token namespace">sync<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token class-name">LazyLock</span><span class="token punctuation">,</span> <span class="token class-name">Mutex</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line"><span class="token punctuation">}</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">pub</span> <span class="token keyword">static</span> <span class="token constant">EVENT_BUS</span><span class="token punctuation">:</span> <span class="token class-name">LazyLock</span><span class="token operator">&lt;</span><span class="token class-name">EventBus</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token class-name">LazyLock</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token punctuation closure-punctuation">|</span><span class="token punctuation closure-punctuation">|</span></span> <span class="token class-name">EventBus</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token class-name type-definition">EventBus</span> <span class="token punctuation">{</span>
</span><span class="code-line">    events<span class="token punctuation">:</span> <span class="token class-name">RefCell</span><span class="token operator">&lt;</span><span class="token class-name">HashMap</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token class-name">Box</span><span class="token operator">&lt;</span><span class="token keyword">dyn</span> <span class="token class-name">Any</span><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;&gt;</span><span class="token punctuation">,</span>
</span><span class="code-line">    handlers<span class="token punctuation">:</span> <span class="token class-name">RefCell</span><span class="token operator">&lt;</span><span class="token class-name">HashMap</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Box</span><span class="token operator">&lt;</span><span class="token keyword">dyn</span> <span class="token class-name">Fn</span><span class="token punctuation">(</span><span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token class-name">Box</span><span class="token operator">&lt;</span><span class="token keyword">dyn</span> <span class="token class-name">Any</span><span class="token operator">&gt;&gt;</span><span class="token punctuation">)</span><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">unsafe</span> <span class="token keyword">impl</span> <span class="token class-name">Sync</span> <span class="token keyword">for</span> <span class="token class-name">EventBus</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</span><span class="code-line"><span class="token keyword">unsafe</span> <span class="token keyword">impl</span> <span class="token class-name">Send</span> <span class="token keyword">for</span> <span class="token class-name">EventBus</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">impl</span> <span class="token class-name">EventBus</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">fn</span> <span class="token function function-definition">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token keyword">Self</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token keyword">Self</span> <span class="token punctuation">{</span>
</span><span class="code-line">            events<span class="token punctuation">:</span> <span class="token class-name">RefCell</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token class-name">HashMap</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">            handlers<span class="token punctuation">:</span> <span class="token class-name">RefCell</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token class-name">HashMap</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">        <span class="token punctuation">}</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function function-definition">emit</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">,</span> event_name<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">str</span><span class="token punctuation">,</span> args<span class="token punctuation">:</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token class-name">Box</span><span class="token operator">&lt;</span><span class="token keyword">dyn</span> <span class="token class-name">Any</span><span class="token operator">&gt;&gt;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token keyword">self</span><span class="token punctuation">.</span>events
</span><span class="code-line">            <span class="token punctuation">.</span><span class="token function">borrow_mut</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">            <span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>event_name<span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function function-definition">register</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">,</span> event_name<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">str</span><span class="token punctuation">,</span> func<span class="token punctuation">:</span> <span class="token class-name">Box</span><span class="token operator">&lt;</span><span class="token keyword">dyn</span> <span class="token class-name">Fn</span><span class="token punctuation">(</span><span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token class-name">Box</span><span class="token operator">&lt;</span><span class="token keyword">dyn</span> <span class="token class-name">Any</span><span class="token operator">&gt;&gt;</span><span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token keyword">self</span><span class="token punctuation">.</span>handlers
</span><span class="code-line">            <span class="token punctuation">.</span><span class="token function">borrow_mut</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">            <span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>event_name<span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> func<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function function-definition">collect</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token comment">// register whatever functions we have in the app</span>
</span><span class="code-line">        <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token string">&quot;WORKER_START&quot;</span><span class="token punctuation">,</span> <span class="token class-name">Box</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token namespace">hooks<span class="token punctuation">::</span></span>print_something<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">        <span class="token comment">// run through the emited events</span>
</span><span class="code-line">        <span class="token keyword">let</span> events <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">.</span>events<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token class-name">HashMap</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">        events<span class="token punctuation">.</span><span class="token function">into_iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">for_each</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token punctuation closure-punctuation">|</span><span class="token punctuation">(</span>event_name<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation closure-punctuation">|</span></span> <span class="token punctuation">{</span>
</span><span class="code-line">            <span class="token keyword">if</span> <span class="token keyword">let</span> <span class="token class-name">Some</span><span class="token punctuation">(</span>handler<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">.</span>handlers<span class="token punctuation">.</span><span class="token function">borrow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>event_name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">                <span class="token function">handler</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">            <span class="token punctuation">}</span>
</span><span class="code-line">        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p>As a single event can have multiple handlers, the current design has a flaw in it. It only allows one handler per event. If you register more handlers for the same event, the previous one will be overwritten.</p><p>Can the AI spot this issue? To avoid steering the model in a direction, I will provide a rather minimal prompt:</p><blockquote><p>do you think the type of handlers is correct?</p></blockquote><h3 id="claude-35"><a href="#claude-35" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>claude 3.5</h3><blockquote><p>Looking at the code, there might be an issue with the type of <code>handlers</code> in the <code>EventBus</code> struct. Currently, it&#x27;s defined as:</p><div class="relative"><pre><code class="language-rust code-highlight"><span class="code-line">handlers<span class="token punctuation">:</span> <span class="token class-name">RefCell</span><span class="token operator">&lt;</span><span class="token class-name">HashMap</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Box</span><span class="token operator">&lt;</span><span class="token keyword">dyn</span> <span class="token class-name">Fn</span><span class="token punctuation">(</span><span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token class-name">Box</span><span class="token operator">&lt;</span><span class="token keyword">dyn</span> <span class="token class-name">Any</span><span class="token operator">&gt;&gt;</span><span class="token punctuation">)</span><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span>
</span></code></pre></div><p>The issue is that this type forces all handlers to accept exactly a <code>Vec&lt;Box&lt;dyn Any&gt;&gt;</code>, which is quite restrictive and not type-safe. When you emit an event with specific types, you lose type information when storing them as <code>Box&lt;dyn Any&gt;</code>, and there&#x27;s no guarantee that the handler will receive the correct types.</p><p>A more flexible and type-safe approach would be to use generics. Here&#x27;s a suggestion:</p><p><a target="_blank" rel="noopener noreferrer" href="src/pubsub/mod.rs">file:src/pubsub/mod.rs</a> line:13-16</p><div class="relative"><pre><code class="language-rust code-highlight"><span class="code-line"><span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token class-name type-definition">EventBus</span> <span class="token punctuation">{</span>
</span><span class="code-line">    events<span class="token punctuation">:</span> <span class="token class-name">RefCell</span><span class="token operator">&lt;</span><span class="token class-name">HashMap</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token class-name">Box</span><span class="token operator">&lt;</span><span class="token keyword">dyn</span> <span class="token class-name">Any</span><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;&gt;</span><span class="token punctuation">,</span>
</span><span class="code-line">    handlers<span class="token punctuation">:</span> <span class="token class-name">RefCell</span><span class="token operator">&lt;</span><span class="token class-name">HashMap</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Box</span><span class="token operator">&lt;</span><span class="token keyword">dyn</span> <span class="token class-name">Any</span><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p>And then modify the register method to accept generic types:</p><p><a target="_blank" rel="noopener noreferrer" href="src/pubsub/mod.rs">file:src/pubsub/mod.rs</a> line:35-39</p><div class="relative"><pre><code class="language-rust code-highlight"><span class="code-line"><span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function function-definition">register</span><span class="token operator">&lt;</span><span class="token class-name">F</span><span class="token punctuation">,</span> <span class="token class-name">Args</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">,</span> event_name<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">str</span><span class="token punctuation">,</span> func<span class="token punctuation">:</span> <span class="token class-name">F</span><span class="token punctuation">)</span>
</span><span class="code-line"><span class="token keyword">where</span>
</span><span class="code-line">    <span class="token class-name">F</span><span class="token punctuation">:</span> <span class="token class-name">Fn</span><span class="token punctuation">(</span><span class="token class-name">Args</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token lifetime-annotation symbol">&#x27;static</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token class-name">Args</span><span class="token punctuation">:</span> <span class="token lifetime-annotation symbol">&#x27;static</span><span class="token punctuation">,</span>
</span><span class="code-line"><span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">self</span><span class="token punctuation">.</span>handlers
</span><span class="code-line">        <span class="token punctuation">.</span><span class="token function">borrow_mut</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">        <span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>event_name<span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Box</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p>However, this would require additional changes to the <code>collect</code> method to properly handle type casting and matching. Would you like me to suggest a complete type-safe implementation?</p></blockquote><p>I am not really sure what the model is trying to do here. So I ask it to &quot;carry on&quot;.</p><blockquote><p>I&#x27;ll propose a more type-safe implementation that handles proper type matching between events and their handlers. Here&#x27;s the complete revision:</p><p><a target="_blank" rel="noopener noreferrer" href="src/pubsub/mod.rs">file:src/pubsub/mod.rs</a> line:13-52</p><div class="relative"><pre><code class="language-rust code-highlight"><span class="code-line"><span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token class-name type-definition">EventBus</span> <span class="token punctuation">{</span>
</span><span class="code-line">    events<span class="token punctuation">:</span> <span class="token class-name">RefCell</span><span class="token operator">&lt;</span><span class="token class-name">HashMap</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Box</span><span class="token operator">&lt;</span><span class="token keyword">dyn</span> <span class="token class-name">Any</span><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
</span><span class="code-line">    handlers<span class="token punctuation">:</span> <span class="token class-name">RefCell</span><span class="token operator">&lt;</span><span class="token class-name">HashMap</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Box</span><span class="token operator">&lt;</span><span class="token keyword">dyn</span> <span class="token class-name">Any</span><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">impl</span> <span class="token class-name">EventBus</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">fn</span> <span class="token function function-definition">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token keyword">Self</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token keyword">Self</span> <span class="token punctuation">{</span>
</span><span class="code-line">            events<span class="token punctuation">:</span> <span class="token class-name">RefCell</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token class-name">HashMap</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">            handlers<span class="token punctuation">:</span> <span class="token class-name">RefCell</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token class-name">HashMap</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">        <span class="token punctuation">}</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function function-definition">emit</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token punctuation">:</span> <span class="token lifetime-annotation symbol">&#x27;static</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">,</span> event_name<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">str</span><span class="token punctuation">,</span> args<span class="token punctuation">:</span> <span class="token class-name">T</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token keyword">self</span><span class="token punctuation">.</span>events
</span><span class="code-line">            <span class="token punctuation">.</span><span class="token function">borrow_mut</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">            <span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>event_name<span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Box</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function function-definition">register</span><span class="token operator">&lt;</span><span class="token class-name">F</span><span class="token punctuation">,</span> <span class="token class-name">T</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">,</span> event_name<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">str</span><span class="token punctuation">,</span> handler<span class="token punctuation">:</span> <span class="token class-name">F</span><span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token keyword">where</span>
</span><span class="code-line">        <span class="token class-name">F</span><span class="token punctuation">:</span> <span class="token class-name">Fn</span><span class="token punctuation">(</span><span class="token class-name">T</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token lifetime-annotation symbol">&#x27;static</span><span class="token punctuation">,</span>
</span><span class="code-line">        <span class="token class-name">T</span><span class="token punctuation">:</span> <span class="token lifetime-annotation symbol">&#x27;static</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token keyword">self</span><span class="token punctuation">.</span>handlers
</span><span class="code-line">            <span class="token punctuation">.</span><span class="token function">borrow_mut</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">            <span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>event_name<span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Box</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span>handler<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function function-definition">collect</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token comment">// register whatever functions we have in the app</span>
</span><span class="code-line">        <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token string">&quot;WORKER_START&quot;</span><span class="token punctuation">,</span> <span class="token namespace">hooks<span class="token punctuation">::</span></span>print_something<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">        <span class="token comment">// run through the emitted events</span>
</span><span class="code-line">        <span class="token keyword">let</span> events <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">.</span>events<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token class-name">HashMap</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">        
</span><span class="code-line">        <span class="token keyword">for</span> <span class="token punctuation">(</span>event_name<span class="token punctuation">,</span> args<span class="token punctuation">)</span> <span class="token keyword">in</span> events <span class="token punctuation">{</span>
</span><span class="code-line">            <span class="token keyword">if</span> <span class="token keyword">let</span> <span class="token class-name">Some</span><span class="token punctuation">(</span>handler<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">.</span>handlers<span class="token punctuation">.</span><span class="token function">borrow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>event_name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">                <span class="token keyword">if</span> <span class="token keyword">let</span> <span class="token punctuation">(</span><span class="token class-name">Some</span><span class="token punctuation">(</span>handler<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Some</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span>
</span><span class="code-line">                    handler<span class="token punctuation">.</span><span class="token function">downcast_ref</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token class-name">Box</span><span class="token operator">&lt;</span><span class="token keyword">dyn</span> <span class="token class-name">Fn</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token class-name">T</span><span class="token punctuation">)</span><span class="token operator">&gt;&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">                    args<span class="token punctuation">.</span><span class="token function">downcast_ref</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">                <span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">                    <span class="token function">handler</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">                <span class="token punctuation">}</span>
</span><span class="code-line">            <span class="token punctuation">}</span>
</span><span class="code-line">        <span class="token punctuation">}</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p>Key changes:</p><ol><li>Changed <code>events</code> to store single values instead of vectors</li><li>Modified <code>emit</code> to accept a generic type <code>T</code> instead of <code>Vec&lt;Box&lt;dyn Any&gt;&gt;</code></li><li>Modified <code>register</code> to accept a generic handler <code>F</code> that takes a specific type <code>T</code></li><li>Updated <code>collect</code> to properly downcast both the handler and arguments to their correct types</li></ol><p>However, there&#x27;s still a challenge with type erasure and matching. We might need to add type information to ensure proper matching between events and handlers. Would you like me to show how to handle this with type IDs or a more sophisticated type matching system?</p></blockquote><p>It is clearly going nowhere. Let&#x27;s move to Claude 3.7</p><h3 id="claude-37"><a href="#claude-37" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>claude 3.7</h3><blockquote><p>Looking at your EventBus implementation, I see a potential issue with the <code>handlers</code> type. The current implementation only allows for a single handler per event name, which might not be what you want in a typical pub/sub system. Usually, multiple subscribers should be able to listen to the same event.</p><p>The current type:</p><div class="relative"><pre><code class="language-rust code-highlight"><span class="code-line">handlers<span class="token punctuation">:</span> <span class="token class-name">RefCell</span><span class="token operator">&lt;</span><span class="token class-name">HashMap</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Box</span><span class="token operator">&lt;</span><span class="token keyword">dyn</span> <span class="token class-name">Fn</span><span class="token punctuation">(</span><span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token class-name">Box</span><span class="token operator">&lt;</span><span class="token keyword">dyn</span> <span class="token class-name">Any</span><span class="token operator">&gt;&gt;</span><span class="token punctuation">)</span><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span>
</span></code></pre></div><p>would be better as:</p><div class="relative"><pre><code class="language-rust code-highlight"><span class="code-line">handlers<span class="token punctuation">:</span> <span class="token class-name">RefCell</span><span class="token operator">&lt;</span><span class="token class-name">HashMap</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token class-name">Box</span><span class="token operator">&lt;</span><span class="token keyword">dyn</span> <span class="token class-name">Fn</span><span class="token punctuation">(</span><span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token class-name">Box</span><span class="token operator">&lt;</span><span class="token keyword">dyn</span> <span class="token class-name">Any</span><span class="token operator">&gt;&gt;</span><span class="token punctuation">)</span><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;&gt;</span>
</span></code></pre></div><p>This would allow multiple handlers to be registered for the same event name. If that&#x27;s what you&#x27;re aiming for, you&#x27;d need to update your <code>register</code> and <code>collect</code> methods accordingly to handle multiple handlers per event.</p><p>Would you like me to show you how to modify the implementation for multiple handlers per event?</p></blockquote><p>Thank you. Claude 3.7 was more succinct and even if it can&#x27;t provide a working solution, it did steer us in the right direction.</p><p>What about Deep Seek? The thinking model.</p><h3 id="deekseek-r1-copilot"><a href="#deekseek-r1-copilot" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>DeekSeek R1 (copilot)</h3><blockquote><p>The handler type <code>Box&lt;dyn Fn(Vec&lt;Box&lt;dyn Any&gt;&gt;)&gt;</code> has two potential issues:</p><ol><li><strong>Thread Safety</strong>: For a static <code>EventBus</code> that might be used across threads, handlers should be <code>Send + Sync</code></li><li><strong>Argument Type</strong>: <code>Vec&lt;Box&lt;dyn Any&gt;&gt;</code> requires manual downcasting - consider <code>Box&lt;dyn Any&gt;</code> instead if single argument is intended</li></ol><p>Recommended fix for thread safety:</p><p><a target="_blank" rel="noopener noreferrer" href="src/pubsub/mod.rs">file:src/pubsub/mod.rs</a> line:14-16</p><div class="relative"><pre><code class="language-rust code-highlight"><span class="code-line">    events<span class="token punctuation">:</span> <span class="token class-name">Mutex</span><span class="token operator">&lt;</span><span class="token class-name">HashMap</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token class-name">Box</span><span class="token operator">&lt;</span><span class="token keyword">dyn</span> <span class="token class-name">Any</span> <span class="token operator">+</span> <span class="token class-name">Send</span><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;&gt;</span><span class="token punctuation">,</span>
</span><span class="code-line">    handlers<span class="token punctuation">:</span> <span class="token class-name">Mutex</span><span class="token operator">&lt;</span><span class="token class-name">HashMap</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Box</span><span class="token operator">&lt;</span><span class="token keyword">dyn</span> <span class="token class-name">Fn</span><span class="token punctuation">(</span><span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token class-name">Box</span><span class="token operator">&lt;</span><span class="token keyword">dyn</span> <span class="token class-name">Any</span> <span class="token operator">+</span> <span class="token class-name">Send</span><span class="token operator">&gt;&gt;</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token class-name">Send</span> <span class="token operator">+</span> <span class="token class-name">Sync</span><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
</span></code></pre></div><p>This change:</p><ul><li>Replaces <code>RefCell</code> with <code>Mutex</code> for thread safety</li><li>Adds <code>Send</code> bound to trait objects for cross-thread use</li><li>Adds <code>Send + Sync</code> to handler functions</li></ul><p>Would you like me to provide the full thread-safety refactor for the implementation?</p></blockquote><p>No dice. Its thinking tokens were not better either. It essentially start making all kinda non-sense scenarios though I usually ignore these as most of the time it converges back to sanity.</p><p>Still, its suggestions have no value and will steer to nowhere.</p><p>What about Google?</p><h3 id="gemini-20-pro-google-studio"><a href="#gemini-20-pro-google-studio" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Gemini 2.0 Pro (Google Studio)</h3><p>Gemini answer is too long to put here. You can see it in this <a target="_blank" rel="noopener noreferrer" href="https://gist.github.com/omarabid/546782044881b7c6ed5f2bc09781c10a">Gist</a>.</p><p>Gemini answer is what I would describe as a Rust developer who went mentally <em>insane</em>. Gemini 2.0 is great if you want to bring absolute chaos to your code base. The model is completely unhinged. What about OpenAI models?</p><h3 id="o1-copilot"><a href="#o1-copilot" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>O1 (copilot)</h3><blockquote><p>GitHub Copilot:<br/>If you only need single-threaded closures that take <code>Vec&lt;Box&lt;dyn Any&gt;&gt;</code> and return nothing, it’s fine. However, since you mark EventBus as Sync, you might want Fn + Send + Sync for true thread safety, and replace RefCell with a thread-safe type like Mutex.</p></blockquote><p>Okay... Let&#x27;s try on the API platform</p><h3 id="o1-apimedium-thinking"><a href="#o1-apimedium-thinking" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>O1 (API/Medium Thinking)</h3><blockquote><p>Request too large for o1 in organization org-6g94fxw3wiuDxcFSOYvukNgE on tokens per min (TPM): Limit 30000, Requested 100431. The input or output tokens must be reduced in order to run successfully. Visit <a target="_blank" rel="noopener noreferrer" href="https://platform.openai.com/account/rate-limits">https://platform.openai.com/account/rate-limits</a> to learn more.</p></blockquote><p>Okay... Pretty sure we are below the 30K token limit, unless it can predict how many tokens it will output?</p><h3 id="gpt-4o"><a href="#gpt-4o" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>GPT-4o</h3><blockquote><div class="relative"><pre><code class="code-highlight"><span class="code-line"><span class="token maybe-class-name">The</span> type <span class="token keyword">of</span> handlers <span class="token keyword">in</span> your <span class="token maybe-class-name">EventBus</span> struct is defined <span class="token keyword module">as</span> <span class="token maybe-class-name">RefCell</span><span class="token operator">&lt;</span><span class="token maybe-class-name">HashMap</span><span class="token operator">&lt;</span><span class="token class-name known-class-name">String</span><span class="token punctuation">,</span> <span class="token maybe-class-name">Box</span><span class="token operator">&lt;</span>dyn <span class="token function"><span class="token maybe-class-name">Fn</span></span><span class="token punctuation">(</span><span class="token maybe-class-name">Vec</span><span class="token operator">&lt;</span><span class="token maybe-class-name">Box</span><span class="token operator">&lt;</span>dyn <span class="token maybe-class-name">Any</span><span class="token operator">&gt;&gt;</span><span class="token punctuation">)</span><span class="token operator">&gt;&gt;&gt;</span><span class="token punctuation">.</span> <span class="token property-access"><span class="token maybe-class-name">This</span></span> means that you expect each event handler to be a <span class="token keyword">function</span> or closure that takes a <span class="token maybe-class-name">Vec</span><span class="token operator">&lt;</span><span class="token maybe-class-name">Box</span><span class="token operator">&lt;</span>dyn <span class="token maybe-class-name">Any</span><span class="token operator">&gt;&gt;</span> <span class="token keyword module">as</span> its argument<span class="token punctuation">.</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token property-access"><span class="token maybe-class-name">In</span></span> many event<span class="token operator">-</span>driven architectures<span class="token punctuation">,</span> event handlers often take a more specific type or a reference to an event object to allow the handler to extract and use the information more effectively<span class="token punctuation">.</span> <span class="token property-access"><span class="token maybe-class-name">By</span></span> using <span class="token maybe-class-name">Vec</span><span class="token operator">&lt;</span><span class="token maybe-class-name">Box</span><span class="token operator">&lt;</span>dyn <span class="token maybe-class-name">Any</span><span class="token operator">&gt;&gt;</span><span class="token punctuation">,</span> <span class="token keyword control-flow">while</span> flexible<span class="token punctuation">,</span> you are forcing handlers to perform potentially unsafe type casts to retrieve the actual values they need<span class="token punctuation">.</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token constant">A</span> potentially more type<span class="token operator">-</span>safe approach could involve defining a trait or a struct <span class="token keyword control-flow">for</span> event arguments<span class="token punctuation">.</span> <span class="token property-access"><span class="token maybe-class-name">However</span></span><span class="token punctuation">,</span> <span class="token keyword control-flow">if</span> you prefer to keep the system <span class="token keyword">this</span> flexible<span class="token punctuation">,</span> then the current handler type is technically correct<span class="token punctuation">,</span> albeit less type<span class="token operator">-</span>safe<span class="token punctuation">.</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token property-access"><span class="token maybe-class-name">If</span></span> you <span class="token keyword control-flow">do</span> want to enhance type safety<span class="token punctuation">,</span> consider using strongly<span class="token operator">-</span>typed event arguments<span class="token punctuation">,</span> such <span class="token keyword module">as</span><span class="token operator">:</span>
</span><span class="code-line">
</span><span class="code-line">pub trait <span class="token maybe-class-name">Event</span><span class="token operator">:</span> <span class="token maybe-class-name">Any</span> <span class="token operator">+</span> <span class="token maybe-class-name">Send</span> <span class="token operator">+</span> <span class="token maybe-class-name">Sync</span> <span class="token punctuation">{</span>
</span><span class="code-line">    fn <span class="token function">as_any</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token operator">&amp;</span>dyn <span class="token maybe-class-name">Any</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">pub struct <span class="token maybe-class-name">MyEvent</span> <span class="token punctuation">{</span>
</span><span class="code-line">    pub data<span class="token operator">:</span> <span class="token class-name known-class-name">String</span><span class="token punctuation">,</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">impl <span class="token maybe-class-name">Event</span> <span class="token keyword control-flow">for</span> <span class="token maybe-class-name">MyEvent</span> <span class="token punctuation">{</span>
</span><span class="code-line">    fn <span class="token function">as_any</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token operator">&amp;</span>dyn <span class="token maybe-class-name">Any</span> <span class="token punctuation">{</span>
</span><span class="code-line">        self
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">type <span class="token maybe-class-name">Handler</span> <span class="token operator">=</span> <span class="token maybe-class-name">Box</span><span class="token operator">&lt;</span>dyn <span class="token function"><span class="token maybe-class-name">Fn</span></span><span class="token punctuation">(</span><span class="token operator">&amp;</span>dyn <span class="token maybe-class-name">Event</span><span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token maybe-class-name">This</span> approach requires more design upfront but results <span class="token keyword">in</span> greater type safety<span class="token punctuation">.</span>
</span></code></pre></div></blockquote><p>Just some non-sense.</p><h3 id="gpt-45-preview"><a href="#gpt-45-preview" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>GPT-4.5-preview</h3><blockquote><p>No, the type signature you&#x27;ve used in your <code>handlers</code> field is problematic. Let&#x27;s closely examine why it&#x27;s problematic and how you can correct it:</p><h2 id="original-problematic-definition"><a href="#original-problematic-definition" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Original problematic definition:</h2><div class="relative"><pre><code class="language-rust code-highlight"><span class="code-line">handlers<span class="token punctuation">:</span> <span class="token class-name">RefCell</span><span class="token operator">&lt;</span><span class="token class-name">HashMap</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Box</span><span class="token operator">&lt;</span><span class="token keyword">dyn</span> <span class="token class-name">Fn</span><span class="token punctuation">(</span><span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token class-name">Box</span><span class="token operator">&lt;</span><span class="token keyword">dyn</span> <span class="token class-name">Any</span><span class="token operator">&gt;&gt;</span><span class="token punctuation">)</span><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
</span></code></pre></div><p>The current signature represents a handler function that takes ownership of the vector of boxed arguments (<code>Vec&lt;Box&lt;dyn Any&gt;&gt;</code>). While owning arguments is possible, this design may have these issues:</p><ol><li><p><strong>Ownership and usability</strong>:<br/>Once you pass arguments to handlers, they take ownership from the event dispatcher permanently. This means your handlers may consume the arguments, and after that point, those arguments cannot be reused or accessed anymore in any manner.</p></li><li><p><strong>Single-handler restriction</strong>:<br/>Your current signature implies that each event key (<code>&quot;WORKER_START&quot;</code>) maps to a <strong>single function handler</strong>. Typically, an event system should be able to register <strong>multiple</strong> handlers per event.</p></li></ol><h2 id="recommended-approach"><a href="#recommended-approach" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Recommended approach:</h2><h3 id="1-multiple-handlers-per-event"><a href="#1-multiple-handlers-per-event" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>1) Multiple Handlers per Event</h3><p>Usually, you&#x27;d expect multiple listeners or subscribers for any given event:</p><div class="relative"><pre><code class="language-rust code-highlight"><span class="code-line">handlers<span class="token punctuation">:</span> <span class="token class-name">RefCell</span><span class="token operator">&lt;</span><span class="token class-name">HashMap</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token class-name">Box</span><span class="token operator">&lt;</span><span class="token keyword">dyn</span> <span class="token class-name">Fn</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token class-name">Box</span><span class="token operator">&lt;</span><span class="token keyword">dyn</span> <span class="token class-name">Any</span><span class="token operator">&gt;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;&gt;</span><span class="token punctuation">,</span>
</span></code></pre></div><p>This new definition allows multiple handlers for the same event by using a vector (<code>Vec</code>) of callbacks.</p><h3 id="2-arguments-passed-by-reference"><a href="#2-arguments-passed-by-reference" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>2) Arguments Passed by Reference</h3><p>Passing a reference (<code>&amp;[Box&lt;dyn Any&gt;]</code>) rather than ownership improves usability and efficiency, and allows multiple handlers to inspect the arguments:</p><h3 id="improved-definition"><a href="#improved-definition" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Improved definition:</h3><div class="relative"><pre><code class="language-rust code-highlight"><span class="code-line">handlers<span class="token punctuation">:</span> <span class="token class-name">RefCell</span><span class="token operator">&lt;</span><span class="token class-name">HashMap</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token class-name">Box</span><span class="token operator">&lt;</span><span class="token keyword">dyn</span> <span class="token class-name">Fn</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token class-name">Box</span><span class="token operator">&lt;</span><span class="token keyword">dyn</span> <span class="token class-name">Any</span><span class="token operator">&gt;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;&gt;</span><span class="token punctuation">,</span>
</span></code></pre></div><h3 id="the-corrected-eventbus-structure-will-become"><a href="#the-corrected-eventbus-structure-will-become" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>The corrected <code>EventBus</code> structure will become:</h3><div class="relative"><pre><code class="language-rust code-highlight"><span class="code-line"><span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token class-name type-definition">EventBus</span> <span class="token punctuation">{</span>
</span><span class="code-line">    events<span class="token punctuation">:</span> <span class="token class-name">RefCell</span><span class="token operator">&lt;</span><span class="token class-name">HashMap</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token class-name">Box</span><span class="token operator">&lt;</span><span class="token keyword">dyn</span> <span class="token class-name">Any</span><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;&gt;</span><span class="token punctuation">,</span>
</span><span class="code-line">    handlers<span class="token punctuation">:</span> <span class="token class-name">RefCell</span><span class="token operator">&lt;</span><span class="token class-name">HashMap</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token class-name">Box</span><span class="token operator">&lt;</span><span class="token keyword">dyn</span> <span class="token class-name">Fn</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token class-name">Box</span><span class="token operator">&lt;</span><span class="token keyword">dyn</span> <span class="token class-name">Any</span><span class="token operator">&gt;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;&gt;</span><span class="token punctuation">,</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><h3 id="corresponding-corrected-methods"><a href="#corresponding-corrected-methods" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Corresponding corrected methods:</h3><h4 id="emission-method"><a href="#emission-method" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Emission method:</h4><div class="relative"><pre><code class="language-rust code-highlight"><span class="code-line"><span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function function-definition">emit</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">,</span> event_name<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">str</span><span class="token punctuation">,</span> args<span class="token punctuation">:</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token class-name">Box</span><span class="token operator">&lt;</span><span class="token keyword">dyn</span> <span class="token class-name">Any</span><span class="token operator">&gt;&gt;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">self</span><span class="token punctuation">.</span>events
</span><span class="code-line">        <span class="token punctuation">.</span><span class="token function">borrow_mut</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">        <span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>event_name<span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p>You emit the event with arguments once.<br/>When collecting, you iterate through stored events and for each corresponding handler, call the handlers with references.</p><h4 id="registration-method"><a href="#registration-method" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Registration method:</h4><div class="relative"><pre><code class="language-rust code-highlight"><span class="code-line"><span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function function-definition">register</span><span class="token operator">&lt;</span><span class="token class-name">F</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">,</span> event_name<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">str</span><span class="token punctuation">,</span> func<span class="token punctuation">:</span> <span class="token class-name">F</span><span class="token punctuation">)</span>
</span><span class="code-line"><span class="token keyword">where</span>
</span><span class="code-line">    <span class="token class-name">F</span><span class="token punctuation">:</span> <span class="token class-name">Fn</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token class-name">Box</span><span class="token operator">&lt;</span><span class="token keyword">dyn</span> <span class="token class-name">Any</span><span class="token operator">&gt;</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token lifetime-annotation symbol">&#x27;static</span><span class="token punctuation">,</span>
</span><span class="code-line"><span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">self</span><span class="token punctuation">.</span>handlers
</span><span class="code-line">        <span class="token punctuation">.</span><span class="token function">borrow_mut</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">        <span class="token punctuation">.</span><span class="token function">entry</span><span class="token punctuation">(</span>event_name<span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line">        <span class="token punctuation">.</span><span class="token function">or_default</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">        <span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token class-name">Box</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p>This provides a safer, more idiomatic Rust API allowing multiple handler registration.</p><h4 id="collecting-method-updated-accordingly"><a href="#collecting-method-updated-accordingly" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Collecting method updated accordingly:</h4><div class="relative"><pre><code class="language-rust code-highlight"><span class="code-line"><span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function function-definition">collect</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token comment">// Register functions</span>
</span><span class="code-line">    <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token string">&quot;WORKER_START&quot;</span><span class="token punctuation">,</span> <span class="token namespace">hooks<span class="token punctuation">::</span></span>print_something<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token comment">// Handle emitted events</span>
</span><span class="code-line">    <span class="token keyword">let</span> emitted_events <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">.</span>events<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token class-name">HashMap</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    emitted_events<span class="token punctuation">.</span><span class="token function">into_iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">for_each</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token punctuation closure-punctuation">|</span><span class="token punctuation">(</span>event_name<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation closure-punctuation">|</span></span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token keyword">if</span> <span class="token keyword">let</span> <span class="token class-name">Some</span><span class="token punctuation">(</span>handlers<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">.</span>handlers<span class="token punctuation">.</span><span class="token function">borrow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>event_name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">            <span class="token keyword">for</span> handler <span class="token keyword">in</span> handlers <span class="token punctuation">{</span>
</span><span class="code-line">                <span class="token function">handler</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">            <span class="token punctuation">}</span>
</span><span class="code-line">        <span class="token punctuation">}</span>
</span><span class="code-line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><h3 id="conclusion"><a href="#conclusion" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Conclusion:</h3><p>Your current <code>handlers</code> type signature is not ideal:</p><ul><li>You&#x27;d usually want multiple handlers for each event</li><li>You normally want handlers to borrow arguments via reference rather than taking ownership</li></ul><p>So, updating <code>handlers</code> to:</p><div class="relative"><pre><code class="language-rust code-highlight"><span class="code-line">handlers<span class="token punctuation">:</span> <span class="token class-name">RefCell</span><span class="token operator">&lt;</span><span class="token class-name">HashMap</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token class-name">Box</span><span class="token operator">&lt;</span><span class="token keyword">dyn</span> <span class="token class-name">Fn</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token class-name">Box</span><span class="token operator">&lt;</span><span class="token keyword">dyn</span> <span class="token class-name">Any</span><span class="token operator">&gt;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;&gt;</span><span class="token punctuation">,</span>
</span></code></pre></div><p>will give you cleaner, idiomatic, and reusable code.</p></blockquote><p>Actually, this is pretty good. It caught two issues, the original and another one that has to do with ownership. It was a bit too pricey though consuming $0.12 for this single run.</p><p>Now how do these compare to the original GPT-3.5.</p><h3 id="gpt-35"><a href="#gpt-35" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>GPT-3.5</h3><p>Now how do these compare to the original GPT-3.5?</p><blockquote><p>The handler is functionally correct for accepting a single vector of trait objects. Depending on your desired use case, the handler could be altered to also include the event name needed to parse the types of args or changed to handle the arguments as timely as they arrive. However, with the correct trait bounds added to the argument and implementation of handler, it should work fine.</p></blockquote><p>Pretty useless though it is tuned-down on the insanity logic department. Can it be steered to a correct answer?</p><blockquote><p>we are registering multiple functions for an event</p></blockquote><blockquote><p>If you want to register multiple functions for an event, you can modify the type of the handlers HashMap to allow storing multiple functions for a single event. One way to achieve this is to change the value type of the handlers HashMap to a vector of <code>Box&lt;dyn Fn(Vec&lt;Box&lt;dyn Any&gt;&gt;)&gt;</code>. Here&#x27;s how you can modify the EventBus struct to support registering multiple functions for an event:</p><div class="relative"><pre><code class="language-rust code-highlight"><span class="code-line"><span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token class-name type-definition">EventBus</span> <span class="token punctuation">{</span>
</span><span class="code-line">    events<span class="token punctuation">:</span> <span class="token class-name">RefCell</span><span class="token operator">&lt;</span><span class="token class-name">HashMap</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token class-name">Box</span><span class="token operator">&lt;</span><span class="token keyword">dyn</span> <span class="token class-name">Any</span><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;&gt;</span><span class="token punctuation">,</span>
</span><span class="code-line">    handlers<span class="token punctuation">:</span> <span class="token class-name">RefCell</span><span class="token operator">&lt;</span><span class="token class-name">HashMap</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token class-name">Box</span><span class="token operator">&lt;</span><span class="token keyword">dyn</span> <span class="token class-name">Fn</span><span class="token punctuation">(</span><span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token class-name">Box</span><span class="token operator">&lt;</span><span class="token keyword">dyn</span> <span class="token class-name">Any</span><span class="token operator">&gt;&gt;</span><span class="token punctuation">)</span><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">impl</span> <span class="token class-name">EventBus</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token comment">// Other methods remain the same</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function function-definition">register</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">,</span> event_name<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">str</span><span class="token punctuation">,</span> func<span class="token punctuation">:</span> <span class="token class-name">Box</span><span class="token operator">&lt;</span><span class="token keyword">dyn</span> <span class="token class-name">Fn</span><span class="token punctuation">(</span><span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token class-name">Box</span><span class="token operator">&lt;</span><span class="token keyword">dyn</span> <span class="token class-name">Any</span><span class="token operator">&gt;&gt;</span><span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token comment">// Check if the event_name already exists in the handlers HashMap</span>
</span><span class="code-line">        <span class="token keyword">if</span> <span class="token keyword">let</span> <span class="token class-name">Some</span><span class="token punctuation">(</span>event_handlers<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">.</span>handlers<span class="token punctuation">.</span><span class="token function">borrow_mut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get_mut</span><span class="token punctuation">(</span>event_name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">            <span class="token comment">// If the event_name exists, add the new function to the existing vector</span>
</span><span class="code-line">            event_handlers<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
</span><span class="code-line">            <span class="token comment">// If the event_name does not exist, create a new vector with the function</span>
</span><span class="code-line">            <span class="token keyword">self</span><span class="token punctuation">.</span>handlers<span class="token punctuation">.</span><span class="token function">borrow_mut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>event_name<span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token macro property">vec!</span><span class="token punctuation">[</span>func<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token punctuation">}</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token comment">// Additional method to unregister a function from an event</span>
</span><span class="code-line">    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function function-definition">unregister</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">,</span> event_name<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">str</span><span class="token punctuation">,</span> func<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">dyn</span> <span class="token class-name">Fn</span><span class="token punctuation">(</span><span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token class-name">Box</span><span class="token operator">&lt;</span><span class="token keyword">dyn</span> <span class="token class-name">Any</span><span class="token operator">&gt;&gt;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token keyword">if</span> <span class="token keyword">let</span> <span class="token class-name">Some</span><span class="token punctuation">(</span>event_handlers<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">.</span>handlers<span class="token punctuation">.</span><span class="token function">borrow_mut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get_mut</span><span class="token punctuation">(</span>event_name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">            event_handlers<span class="token punctuation">.</span><span class="token function">retain</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token punctuation closure-punctuation">|</span>handler<span class="token punctuation closure-punctuation">|</span></span> <span class="token operator">!</span><span class="token namespace">std<span class="token punctuation">::</span>ptr<span class="token punctuation">::</span></span><span class="token function">eq</span><span class="token punctuation">(</span>handler<span class="token punctuation">.</span><span class="token function">as_ref</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> func<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token punctuation">}</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span></code></pre></div><p>With this modification, you can now register multiple functions for the same event using the <code>register</code> method. The <code>unregister</code> method allows you to remove a specific function from the list of handlers for an event.</p></blockquote><p>Yes, though it does add an additional <code>unregister</code> method that we didn&#x27;t ask for.</p><h2 id="conclusion-1"><a href="#conclusion-1" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Conclusion</h2><ol><li>Claude 3.7 and GPT-4.5-preview were both successful. GPT-4.5 gets two bonus points for its ownership finding while remaining on topic. Two because the ownership issue requires <em>thinking forward</em> into the future.</li><li>GPT-3.5 ranks second for not going insane. O1 can rank just below it for <em>not saying</em> much.</li><li>Claude 3.5, DeepSeek R1 and GPT-4o were not successful but also steered us in a wrong direction.</li><li>Gemini 2.0 Pro should not be used.</li></ol><div class="my-8 w-full rounded-lg bg-gray-50 px-4 py-8 dark:bg-gray-800"><div class="mx-auto max-w-2xl"><h3 class="mb-2 text-xl font-bold text-gray-900 dark:text-white">Subscribe to the Newsletter</h3><p class="mb-4 text-gray-600 dark:text-gray-300">Get the latest posts from this blog delivered to your inbox. No spam.</p><form class="space-y-4"><div class="flex gap-2"><input type="email" placeholder="Enter your email" required="" class="flex-1 border border-gray-300 bg-white px-4 py-2 text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-500 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-100" value=""/><button type="submit" class="bg-blue-600 px-6 py-2 text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50">Subscribe</button></div></form></div></div></div></article></div></section></main><footer class="mt-3 flex p-6 pb-6 pt-3 text-center font-mono text-xs text-gray-500 dark:text-gray-400"><div class="grow text-left">Omar Abid (<a class="border-b border-gray-300 text-gray-600 transition-[border-color] hover:border-gray-600 dark:border-gray-500 dark:text-white dark:hover:border-white " target="_blank" href="https://github.com/omarabid">@omarabid</a>)</div><div></div></footer><script src="/_next/static/chunks/webpack-ecd884431e5f35c6.js" crossorigin="" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0]);self.__next_f.push([2,null])</script><script>self.__next_f.push([1,"1:HL[\"/_next/static/media/7cba1811e3c25a15-s.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n2:HL[\"/_next/static/css/cd219d613ad8989f.css\",\"style\",{\"crossOrigin\":\"\"}]\n3:HL[\"/_next/static/css/959e61cd6bf7e234.css\",\"style\",{\"crossOrigin\":\"\"}]\n0:\"$L4\"\n"])</script><script>self.__next_f.push([1,"5:HL[\"/_next/static/css/c1c99bc127b9f571.css\",\"style\",{\"crossOrigin\":\"\"}]\n"])</script><script>self.__next_f.push([1,"6:I[3728,[],\"\"]\n8:I[9928,[],\"\"]\n9:I[1087,[\"878\",\"static/chunks/9da6db1e-fe005e7e52eb3467.js\",\"326\",\"static/chunks/326-f0b929b9e51900a5.js\",\"185\",\"static/chunks/app/layout-2ffae3625ca75b72.js\"],\"CSPostHogProvider\"]\na:I[7821,[\"878\",\"static/chunks/9da6db1e-fe005e7e52eb3467.js\",\"326\",\"static/chunks/326-f0b929b9e51900a5.js\",\"185\",\"static/chunks/app/layout-2ffae3625ca75b72.js\"],\"ThemeProviders\"]\nb:I[8326,[\"326\",\"static/chunks/326-f0b929b9e51900a5.js\",\"202\",\"static/chunks/app/(blog)/%5B...slug%5D/page-47a78e5a6d2f"])</script><script>self.__next_f.push([1,"c851.js\"],\"\"]\nc:I[5235,[\"878\",\"static/chunks/9da6db1e-fe005e7e52eb3467.js\",\"326\",\"static/chunks/326-f0b929b9e51900a5.js\",\"185\",\"static/chunks/app/layout-2ffae3625ca75b72.js\"],\"\"]\nd:I[6954,[],\"\"]\ne:I[7264,[],\"\"]\n"])</script><script>self.__next_f.push([1,"4:[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/cd219d613ad8989f.css\",\"precedence\":\"next\",\"crossOrigin\":\"\"}],[\"$\",\"link\",\"1\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/959e61cd6bf7e234.css\",\"precedence\":\"next\",\"crossOrigin\":\"\"}]],[\"$\",\"$L6\",null,{\"buildId\":\"8A17WgayQp_T-PygQTLuw\",\"assetPrefix\":\"\",\"initialCanonicalUrl\":\"/gpt3-now\",\"initialTree\":[\"\",{\"children\":[\"(blog)\",{\"children\":[[\"slug\",\"gpt3-now\",\"c\"],{\"children\":[\"__PAGE__?{\\\"slug\\\":[\\\"gpt3-now\\\"]}\",{}]}]}]},\"$undefined\",\"$undefined\",true],\"initialHead\":[false,\"$L7\"],\"globalErrorComponent\":\"$8\",\"children\":[null,[\"$\",\"html\",null,{\"lang\":\"en-us\",\"className\":\"__variable_bc0dcf scroll-smooth\",\"suppressHydrationWarning\":true,\"children\":[[\"$\",\"link\",null,{\"rel\":\"apple-touch-icon\",\"sizes\":\"76x76\",\"href\":\"/favicon.svg\"}],[\"$\",\"link\",null,{\"rel\":\"icon\",\"type\":\"image/png\",\"sizes\":\"32x32\",\"href\":\"/favicon.svg\"}],[\"$\",\"link\",null,{\"rel\":\"icon\",\"type\":\"image/png\",\"sizes\":\"16x16\",\"href\":\"/favicon.svg\"}],[\"$\",\"link\",null,{\"rel\":\"manifest\",\"href\":\"/static/favicons/site.webmanifest\"}],[\"$\",\"link\",null,{\"rel\":\"mask-icon\",\"href\":\"/favicon.svg\",\"color\":\"#5bbad5\"}],[\"$\",\"meta\",null,{\"name\":\"msapplication-TileColor\",\"content\":\"#000000\"}],[\"$\",\"meta\",null,{\"name\":\"theme-color\",\"media\":\"(prefers-color-scheme: light)\",\"content\":\"#fff\"}],[\"$\",\"meta\",null,{\"name\":\"theme-color\",\"media\":\"(prefers-color-scheme: dark)\",\"content\":\"#000\"}],[\"$\",\"link\",null,{\"rel\":\"alternate\",\"type\":\"application/rss+xml\",\"href\":\"/feed.xml\"}],[\"$\",\"$L9\",null,{\"children\":[\"$\",\"body\",null,{\"className\":\"m-auto max-w-2xl dark:text-gray-100\",\"children\":[\"$\",\"$La\",null,{\"children\":[[\"$\",\"main\",null,{\"className\":\"min-h-screen p-6 pt-3 md:pt-6\",\"children\":[[\"$\",\"header\",null,{\"className\":\"mb-5 flex items-center md:mb-10\",\"children\":[[\"$\",\"span\",null,{\"className\":\"text-md whitespace-nowrap font-bold md:text-lg\",\"children\":[\"$\",\"$Lb\",null,{\"href\":\"/\",\"className\":\"-ml-2 rounded-sm p-2 transition-[background-color] hover:bg-gray-200 active:bg-gray-300 dark:hover:bg-[#313131] dark:active:bg-[#242424]\",\"children\":\"Omar Abid\"}]}],[\"$\",\"nav\",null,{\"className\":\"flex grow items-center justify-end gap-1 font-mono text-xs md:gap-3\",\"children\":[[\"$\",\"$Lc\",null,{}],[\"$\",\"a\",null,{\"className\":\"inline-flex rounded-sm p-2 transition-[background-color] hover:bg-gray-200 active:bg-gray-300 dark:hover:bg-[#313131] dark:active:bg-[#242424]\",\"href\":\"/about\",\"children\":\"About\"}]]}]]}],[\"$\",\"$Ld\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"loadingScripts\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$Le\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[\"$\",\"div\",null,{\"className\":\"flex flex-col items-start justify-start md:mt-24 md:flex-row md:items-center md:justify-center md:space-x-6\",\"children\":[[\"$\",\"div\",null,{\"className\":\"space-x-2 pb-8 pt-6 md:space-y-5\",\"children\":[\"$\",\"h1\",null,{\"className\":\"text-6xl font-extrabold leading-9 tracking-tight text-gray-900 dark:text-gray-100 md:border-r-2 md:px-6 md:text-8xl md:leading-14\",\"children\":\"404\"}]}],[\"$\",\"div\",null,{\"className\":\"max-w-md\",\"children\":[[\"$\",\"p\",null,{\"className\":\"mb-4 text-xl font-bold leading-normal md:text-2xl\",\"children\":\"Sorry we couldn't find this page.\"}],[\"$\",\"p\",null,{\"className\":\"mb-8\",\"children\":\"But dont worry, you can find plenty of other things on our homepage.\"}],[\"$\",\"$Lb\",null,{\"href\":\"/\",\"className\":\"focus:shadow-outline-blue inline rounded-lg border border-transparent bg-blue-600 px-4 py-2 text-sm font-medium leading-5 text-white shadow transition-colors duration-150 hover:bg-blue-700 focus:outline-none dark:hover:bg-blue-500\",\"children\":\"Back to homepage\"}]]}]]}],\"notFoundStyles\":[],\"initialChildNode\":[\"$\",\"$Ld\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"(blog)\",\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"loadingScripts\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$Le\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"initialChildNode\":[\"$\",\"$Ld\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"(blog)\",\"children\",[\"slug\",\"gpt3-now\",\"c\"],\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"loadingScripts\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$Le\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"initialChildNode\":[\"$Lf\",\"$L10\",null],\"childPropSegment\":\"__PAGE__?{\\\"slug\\\":[\\\"gpt3-now\\\"]}\",\"styles\":[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/c1c99bc127b9f571.css\",\"precedence\":\"next\",\"crossOrigin\":\"\"}]]}],\"childPropSegment\":[\"slug\",\"gpt3-now\",\"c\"],\"styles\":null}],\"childPropSegment\":\"(blog)\",\"styles\":null}]]}],[\"$\",\"footer\",null,{\"className\":\"mt-3 flex p-6 pb-6 pt-3 text-center font-mono text-xs text-gray-500 dark:text-gray-400\",\"children\":[[\"$\",\"div\",null,{\"className\":\"grow text-left\",\"children\":[\"Omar Abid (\",[\"$\",\"a\",null,{\"className\":\"border-b border-gray-300 text-gray-600 transition-[border-color] hover:border-gray-600 dark:border-gray-500 dark:text-white dark:hover:border-white \",\"target\":\"_blank\",\"href\":\"https://github.com/omarabid\",\"children\":\"@omarabid\"}],\")\"]}],[\"$\",\"div\",null,{}]]}]]}]}]}]]}],null]}]]\n"])</script><script>self.__next_f.push([1,"11:I[1514,[\"326\",\"static/chunks/326-f0b929b9e51900a5.js\",\"202\",\"static/chunks/app/(blog)/%5B...slug%5D/page-47a78e5a6d2fc851.js\"],\"\"]\n12:I[2529,[\"326\",\"static/chunks/326-f0b929b9e51900a5.js\",\"202\",\"static/chunks/app/(blog)/%5B...slug%5D/page-47a78e5a6d2fc851.js\"],\"\"]\n13:I[6598,[\"326\",\"static/chunks/326-f0b929b9e51900a5.js\",\"202\",\"static/chunks/app/(blog)/%5B...slug%5D/page-47a78e5a6d2fc851.js\"],\"\"]\n"])</script><script>self.__next_f.push([1,"10:[[\"$\",\"script\",null,{\"type\":\"application/ld+json\",\"dangerouslySetInnerHTML\":{\"__html\":\"{\\\"@context\\\":\\\"https://schema.org\\\",\\\"@type\\\":\\\"BlogPosting\\\",\\\"headline\\\":\\\"GPT-3.5 and the latest models\\\",\\\"datePublished\\\":\\\"2025-03-12T00:00:00.000Z\\\",\\\"dateModified\\\":\\\"2025-03-12T00:00:00.000Z\\\",\\\"description\\\":\\\"Comparing GPT-3.5 to the latest models.\\\",\\\"url\\\":\\\"https://omarabid.com/gpt3-now\\\",\\\"author\\\":[{\\\"@type\\\":\\\"Person\\\"}]}\"}}],[\"$\",\"section\",null,{\"className\":\"mx-auto max-w-3xl px-4 sm:px-6 xl:max-w-5xl xl:px-0\",\"children\":[[\"$\",\"$L11\",null,{}],[\"$\",\"div\",null,{\"className\":\"xl:divide-y xl:divide-gray-200 xl:dark:divide-gray-700\",\"children\":[[\"$\",\"header\",null,{\"className\":\"pt-6 xl:pb-6\",\"children\":[[\"$\",\"h1\",null,{\"className\":\"text-2xl font-bold mb-1 dark:text-gray-100\",\"children\":\"GPT-3.5 and the latest models\"}],[\"$\",\"p\",null,{\"className\":\"font-mono flex text-xs text-gray-500 dark:text-gray-500\",\"children\":[[\"$\",\"span\",null,{\"className\":\"flex-grow\",\"children\":[[\"$\",\"span\",null,{\"className\":\"hidden md:inline\",\"children\":[[\"$\",\"span\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"https://github.com/omarabid\",\"className\":\"hover:text-gray-800 dark:hover:text-gray-400\",\"target\":\"_blank\",\"children\":\"@omarabid\"}]}],[\"$\",\"span\",null,{\"className\":\"mx-2\",\"children\":\"|\"}]]}],[\"$\",\"span\",null,{\"children\":[\"$\",\"time\",null,{\"dateTime\":\"2025-03-12T00:00:00.000Z\",\"children\":\"Wednesday, March 12, 2025\"}]}]]}],[\"$\",\"span\",null,{\"className\":\"pr-1.5\"}]]}]]}],[\"$\",\"article\",null,{\"className\":\"text-gray-800 dark:text-gray-300 mb-10\",\"children\":[\"$\",\"div\",null,{\"className\":\"prose max-w-none pb-8 pt-10 dark:prose-invert\",\"children\":[[[\"$\",\"p\",null,{\"children\":\"There is a lot of discussion about LLM benchmarks. The issue is that if models are getting better at benchmarks, why are they not getting smarter for use cases?\"}],[\"$\",\"p\",null,{\"children\":\"A simple run that I had lately, had me curious to see what GPT-3.5-turbo would answer. It is the oldest model that is still available on the Open AI API and was released in early 23. That's two years ago.\"}],[\"$\",\"p\",null,{\"children\":[\"First, the code. Nothing out of the ordinary but kinda random. I am creating a custom \",[\"$\",\"a\",null,{\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://en.wikipedia.org/wiki/Publish%E2%80%93subscribe_pattern\",\"children\":\"Event Bus\"}],\" in Rust for a Wasm worker. The goal is to be able to tag a function with proc-macros and have it executed when a certain event is emitted.\"]}],[\"$\",\"p\",null,{\"children\":\"However, the code at this stage is still a very early prototype. The EventBus struct holds two HashMaps, one for events and one for handlers. Can you spot the issue with the handlers HashMap?\"}],[\"$\",\"$L12\",null,{\"className\":\"language-rust\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-rust code-highlight\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"mod\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token namespace module-declaration\",\"children\":\"hooks\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"mod\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token namespace module-declaration\",\"children\":\"macros\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"use\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token namespace\",\"children\":[\"std\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}]]}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token namespace\",\"children\":[\"any\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}]]}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Any\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token namespace\",\"children\":[\"cell\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}]]}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"OnceCell\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"RefCell\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token namespace\",\"children\":[\"collections\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}]]}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"HashMap\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token namespace\",\"children\":[\"sync\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}]]}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"LazyLock\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Mutex\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"pub\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"static\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token constant\",\"children\":\"EVENT_BUS\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"LazyLock\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"EventBus\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"LazyLock\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"new\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token closure-params\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation closure-punctuation\",\"children\":\"|\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation closure-punctuation\",\"children\":\"|\"}]]}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"EventBus\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"new\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"pub\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"struct\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name type-definition\",\"children\":\"EventBus\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    events\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"RefCell\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"HashMap\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"String\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Vec\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Box\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"dyn\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Any\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\u003e\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\u003e\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    handlers\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"RefCell\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"HashMap\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"String\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Box\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"dyn\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Fn\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Vec\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Box\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"dyn\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Any\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\u003e\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\u003e\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"unsafe\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"impl\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Sync\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"for\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"EventBus\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"unsafe\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"impl\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Send\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"for\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"EventBus\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"impl\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"EventBus\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"fn\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function function-definition\",\"children\":\"new\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\u003e\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"Self\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"Self\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"            events\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"RefCell\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"new\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"HashMap\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"new\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"            handlers\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"RefCell\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"new\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"HashMap\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"new\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"pub\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"fn\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function function-definition\",\"children\":\"emit\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"self\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" event_name\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"str\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" args\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Vec\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Box\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"dyn\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Any\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\u003e\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"self\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"events\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"            \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"borrow_mut\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"            \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"insert\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"event_name\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"to_string\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" args\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"pub\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"fn\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function function-definition\",\"children\":\"register\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"self\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" event_name\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"str\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" func\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Box\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"dyn\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Fn\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Vec\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Box\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"dyn\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Any\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\u003e\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"self\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"handlers\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"            \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"borrow_mut\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"            \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"insert\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"event_name\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"to_string\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" func\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"pub\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"fn\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function function-definition\",\"children\":\"collect\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"self\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// register whatever functions we have in the app\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"self\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"register\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"WORKER_START\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Box\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"new\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token namespace\",\"children\":[\"hooks\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}]]}],\"print_something\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// run through the emited events\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"let\"}],\" events \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"self\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"events\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"replace\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"HashMap\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"new\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        events\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"into_iter\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"for_each\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token closure-params\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation closure-punctuation\",\"children\":\"|\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"event_name\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" args\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation closure-punctuation\",\"children\":\"|\"}]]}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"            \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"if\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"let\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Some\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"handler\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"self\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"handlers\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"borrow\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"get\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\"}],\"event_name\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"                \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"handler\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"args\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"            \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}]]}]}],[\"$\",\"p\",null,{\"children\":\"As a single event can have multiple handlers, the current design has a flaw in it. It only allows one handler per event. If you register more handlers for the same event, the previous one will be overwritten.\"}],[\"$\",\"p\",null,{\"children\":\"Can the AI spot this issue? To avoid steering the model in a direction, I will provide a rather minimal prompt:\"}],[\"$\",\"blockquote\",null,{\"children\":[\"$\",\"p\",null,{\"children\":\"do you think the type of handlers is correct?\"}]}],[\"$\",\"h3\",null,{\"id\":\"claude-35\",\"children\":[[\"$\",\"a\",null,{\"href\":\"#claude-35\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"icon icon-link\"}]}],\"claude 3.5\"]}],[\"$\",\"blockquote\",null,{\"children\":[[\"$\",\"p\",null,{\"children\":[\"Looking at the code, there might be an issue with the type of \",[\"$\",\"code\",null,{\"children\":\"handlers\"}],\" in the \",[\"$\",\"code\",null,{\"children\":\"EventBus\"}],\" struct. Currently, it's defined as:\"]}],[\"$\",\"$L12\",null,{\"className\":\"language-rust\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-rust code-highlight\",\"children\":[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"handlers\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"RefCell\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"HashMap\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"String\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Box\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"dyn\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Fn\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Vec\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Box\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"dyn\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Any\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\u003e\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\u003e\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\"}],\"\\n\"]}]}]}],[\"$\",\"p\",null,{\"children\":[\"The issue is that this type forces all handlers to accept exactly a \",[\"$\",\"code\",null,{\"children\":\"Vec\u003cBox\u003cdyn Any\u003e\u003e\"}],\", which is quite restrictive and not type-safe. When you emit an event with specific types, you lose type information when storing them as \",[\"$\",\"code\",null,{\"children\":\"Box\u003cdyn Any\u003e\"}],\", and there's no guarantee that the handler will receive the correct types.\"]}],[\"$\",\"p\",null,{\"children\":\"A more flexible and type-safe approach would be to use generics. Here's a suggestion:\"}],[\"$\",\"p\",null,{\"children\":[[\"$\",\"a\",null,{\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"src/pubsub/mod.rs\",\"children\":\"file:src/pubsub/mod.rs\"}],\" line:13-16\"]}],[\"$\",\"$L12\",null,{\"className\":\"language-rust\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-rust code-highlight\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"pub\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"struct\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name type-definition\",\"children\":\"EventBus\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    events\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"RefCell\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"HashMap\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"String\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Vec\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Box\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"dyn\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Any\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\u003e\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\u003e\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    handlers\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"RefCell\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"HashMap\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"String\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Box\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"dyn\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Any\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\u003e\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}]]}]}],[\"$\",\"p\",null,{\"children\":\"And then modify the register method to accept generic types:\"}],[\"$\",\"p\",null,{\"children\":[[\"$\",\"a\",null,{\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"src/pubsub/mod.rs\",\"children\":\"file:src/pubsub/mod.rs\"}],\" line:35-39\"]}],[\"$\",\"$L12\",null,{\"className\":\"language-rust\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-rust code-highlight\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"pub\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"fn\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function function-definition\",\"children\":\"register\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"F\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Args\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"self\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" event_name\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"str\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" func\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"F\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"where\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"F\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Fn\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Args\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"+\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token lifetime-annotation symbol\",\"children\":\"'static\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Args\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token lifetime-annotation symbol\",\"children\":\"'static\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"self\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"handlers\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"borrow_mut\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"insert\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"event_name\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"to_string\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Box\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"new\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"func\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}]]}]}],[\"$\",\"p\",null,{\"children\":[\"However, this would require additional changes to the \",[\"$\",\"code\",null,{\"children\":\"collect\"}],\" method to properly handle type casting and matching. Would you like me to suggest a complete type-safe implementation?\"]}]]}],[\"$\",\"p\",null,{\"children\":\"I am not really sure what the model is trying to do here. So I ask it to \\\"carry on\\\".\"}],[\"$\",\"blockquote\",null,{\"children\":[[\"$\",\"p\",null,{\"children\":\"I'll propose a more type-safe implementation that handles proper type matching between events and their handlers. Here's the complete revision:\"}],[\"$\",\"p\",null,{\"children\":[[\"$\",\"a\",null,{\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"src/pubsub/mod.rs\",\"children\":\"file:src/pubsub/mod.rs\"}],\" line:13-52\"]}],[\"$\",\"$L12\",null,{\"className\":\"language-rust\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-rust code-highlight\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"pub\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"struct\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name type-definition\",\"children\":\"EventBus\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    events\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"RefCell\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"HashMap\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"String\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Box\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"dyn\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Any\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\u003e\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    handlers\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"RefCell\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"HashMap\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"String\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Box\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"dyn\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Any\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\u003e\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"impl\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"EventBus\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"fn\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function function-definition\",\"children\":\"new\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\u003e\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"Self\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"Self\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"            events\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"RefCell\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"new\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"HashMap\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"new\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"            handlers\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"RefCell\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"new\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"HashMap\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"new\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"pub\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"fn\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function function-definition\",\"children\":\"emit\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"T\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token lifetime-annotation symbol\",\"children\":\"'static\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"self\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" event_name\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"str\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" args\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"T\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"self\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"events\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"            \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"borrow_mut\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"            \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"insert\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"event_name\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"to_string\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Box\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"new\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"args\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"pub\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"fn\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function function-definition\",\"children\":\"register\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"F\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"T\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"self\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" event_name\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"str\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" handler\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"F\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"where\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"F\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Fn\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"T\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"+\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token lifetime-annotation symbol\",\"children\":\"'static\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"T\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token lifetime-annotation symbol\",\"children\":\"'static\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"self\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"handlers\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"            \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"borrow_mut\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"            \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"insert\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"event_name\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"to_string\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Box\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"new\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"handler\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"pub\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"fn\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function function-definition\",\"children\":\"collect\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"self\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// register whatever functions we have in the app\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"self\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"register\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"WORKER_START\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token namespace\",\"children\":[\"hooks\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}]]}],\"print_something\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// run through the emitted events\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"let\"}],\" events \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"self\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"events\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"replace\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"HashMap\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"new\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"        \\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"for\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"event_name\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" args\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"in\"}],\" events \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"            \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"if\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"let\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Some\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"handler\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"self\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"handlers\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"borrow\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"get\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\"}],\"event_name\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"                \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"if\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"let\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Some\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"handler\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Some\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"args\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"                    handler\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"downcast_ref\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Box\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"dyn\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Fn\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"T\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\u003e\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"                    args\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"downcast_ref\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"                \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"                    \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"handler\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"args\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"                \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"            \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}]]}]}],[\"$\",\"p\",null,{\"children\":\"Key changes:\"}],[\"$\",\"ol\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":[\"Changed \",[\"$\",\"code\",null,{\"children\":\"events\"}],\" to store single values instead of vectors\"]}],[\"$\",\"li\",null,{\"children\":[\"Modified \",[\"$\",\"code\",null,{\"children\":\"emit\"}],\" to accept a generic type \",[\"$\",\"code\",null,{\"children\":\"T\"}],\" instead of \",[\"$\",\"code\",null,{\"children\":\"Vec\u003cBox\u003cdyn Any\u003e\u003e\"}]]}],[\"$\",\"li\",null,{\"children\":[\"Modified \",[\"$\",\"code\",null,{\"children\":\"register\"}],\" to accept a generic handler \",[\"$\",\"code\",null,{\"children\":\"F\"}],\" that takes a specific type \",[\"$\",\"code\",null,{\"children\":\"T\"}]]}],[\"$\",\"li\",null,{\"children\":[\"Updated \",[\"$\",\"code\",null,{\"children\":\"collect\"}],\" to properly downcast both the handler and arguments to their correct types\"]}]]}],[\"$\",\"p\",null,{\"children\":\"However, there's still a challenge with type erasure and matching. We might need to add type information to ensure proper matching between events and handlers. Would you like me to show how to handle this with type IDs or a more sophisticated type matching system?\"}]]}],[\"$\",\"p\",null,{\"children\":\"It is clearly going nowhere. Let's move to Claude 3.7\"}],[\"$\",\"h3\",null,{\"id\":\"claude-37\",\"children\":[[\"$\",\"a\",null,{\"href\":\"#claude-37\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"icon icon-link\"}]}],\"claude 3.7\"]}],[\"$\",\"blockquote\",null,{\"children\":[[\"$\",\"p\",null,{\"children\":[\"Looking at your EventBus implementation, I see a potential issue with the \",[\"$\",\"code\",null,{\"children\":\"handlers\"}],\" type. The current implementation only allows for a single handler per event name, which might not be what you want in a typical pub/sub system. Usually, multiple subscribers should be able to listen to the same event.\"]}],[\"$\",\"p\",null,{\"children\":\"The current type:\"}],[\"$\",\"$L12\",null,{\"className\":\"language-rust\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-rust code-highlight\",\"children\":[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"handlers\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"RefCell\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"HashMap\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"String\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Box\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"dyn\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Fn\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Vec\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Box\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"dyn\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Any\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\u003e\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\u003e\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\"}],\"\\n\"]}]}]}],[\"$\",\"p\",null,{\"children\":\"would be better as:\"}],[\"$\",\"$L12\",null,{\"className\":\"language-rust\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-rust code-highlight\",\"children\":[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"handlers\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"RefCell\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"HashMap\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"String\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Vec\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Box\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"dyn\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Fn\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Vec\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Box\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"dyn\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Any\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\u003e\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\u003e\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\u003e\"}],\"\\n\"]}]}]}],[\"$\",\"p\",null,{\"children\":[\"This would allow multiple handlers to be registered for the same event name. If that's what you're aiming for, you'd need to update your \",[\"$\",\"code\",null,{\"children\":\"register\"}],\" and \",[\"$\",\"code\",null,{\"children\":\"collect\"}],\" methods accordingly to handle multiple handlers per event.\"]}],[\"$\",\"p\",null,{\"children\":\"Would you like me to show you how to modify the implementation for multiple handlers per event?\"}]]}],[\"$\",\"p\",null,{\"children\":\"Thank you. Claude 3.7 was more succinct and even if it can't provide a working solution, it did steer us in the right direction.\"}],[\"$\",\"p\",null,{\"children\":\"What about Deep Seek? The thinking model.\"}],[\"$\",\"h3\",null,{\"id\":\"deekseek-r1-copilot\",\"children\":[[\"$\",\"a\",null,{\"href\":\"#deekseek-r1-copilot\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"icon icon-link\"}]}],\"DeekSeek R1 (copilot)\"]}],[\"$\",\"blockquote\",null,{\"children\":[[\"$\",\"p\",null,{\"children\":[\"The handler type \",[\"$\",\"code\",null,{\"children\":\"Box\u003cdyn Fn(Vec\u003cBox\u003cdyn Any\u003e\u003e)\u003e\"}],\" has two potential issues:\"]}],[\"$\",\"ol\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Thread Safety\"}],\": For a static \",[\"$\",\"code\",null,{\"children\":\"EventBus\"}],\" that might be used across threads, handlers should be \",[\"$\",\"code\",null,{\"children\":\"Send + Sync\"}]]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Argument Type\"}],\": \",[\"$\",\"code\",null,{\"children\":\"Vec\u003cBox\u003cdyn Any\u003e\u003e\"}],\" requires manual downcasting - consider \",[\"$\",\"code\",null,{\"children\":\"Box\u003cdyn Any\u003e\"}],\" instead if single argument is intended\"]}]]}],[\"$\",\"p\",null,{\"children\":\"Recommended fix for thread safety:\"}],[\"$\",\"p\",null,{\"children\":[[\"$\",\"a\",null,{\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"src/pubsub/mod.rs\",\"children\":\"file:src/pubsub/mod.rs\"}],\" line:14-16\"]}],[\"$\",\"$L12\",null,{\"className\":\"language-rust\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-rust code-highlight\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    events\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Mutex\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"HashMap\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"String\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Vec\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Box\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"dyn\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Any\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"+\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Send\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\u003e\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\u003e\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    handlers\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Mutex\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"HashMap\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"String\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Box\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"dyn\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Fn\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Vec\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Box\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"dyn\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Any\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"+\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Send\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\u003e\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"+\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Send\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"+\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Sync\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\u003e\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\"\\n\"]}]]}]}],[\"$\",\"p\",null,{\"children\":\"This change:\"}],[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":[\"Replaces \",[\"$\",\"code\",null,{\"children\":\"RefCell\"}],\" with \",[\"$\",\"code\",null,{\"children\":\"Mutex\"}],\" for thread safety\"]}],[\"$\",\"li\",null,{\"children\":[\"Adds \",[\"$\",\"code\",null,{\"children\":\"Send\"}],\" bound to trait objects for cross-thread use\"]}],[\"$\",\"li\",null,{\"children\":[\"Adds \",[\"$\",\"code\",null,{\"children\":\"Send + Sync\"}],\" to handler functions\"]}]]}],[\"$\",\"p\",null,{\"children\":\"Would you like me to provide the full thread-safety refactor for the implementation?\"}]]}],[\"$\",\"p\",null,{\"children\":\"No dice. Its thinking tokens were not better either. It essentially start making all kinda non-sense scenarios though I usually ignore these as most of the time it converges back to sanity.\"}],[\"$\",\"p\",null,{\"children\":\"Still, its suggestions have no value and will steer to nowhere.\"}],[\"$\",\"p\",null,{\"children\":\"What about Google?\"}],[\"$\",\"h3\",null,{\"id\":\"gemini-20-pro-google-studio\",\"children\":[[\"$\",\"a\",null,{\"href\":\"#gemini-20-pro-google-studio\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"icon icon-link\"}]}],\"Gemini 2.0 Pro (Google Studio)\"]}],[\"$\",\"p\",null,{\"children\":[\"Gemini answer is too long to put here. You can see it in this \",[\"$\",\"a\",null,{\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://gist.github.com/omarabid/546782044881b7c6ed5f2bc09781c10a\",\"children\":\"Gist\"}],\".\"]}],[\"$\",\"p\",null,{\"children\":[\"Gemini answer is what I would describe as a Rust developer who went mentally \",[\"$\",\"em\",null,{\"children\":\"insane\"}],\". Gemini 2.0 is great if you want to bring absolute chaos to your code base. The model is completely unhinged. What about OpenAI models?\"]}],[\"$\",\"h3\",null,{\"id\":\"o1-copilot\",\"children\":[[\"$\",\"a\",null,{\"href\":\"#o1-copilot\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"icon icon-link\"}]}],\"O1 (copilot)\"]}],[\"$\",\"blockquote\",null,{\"children\":[\"$\",\"p\",null,{\"children\":[\"GitHub Copilot:\",[\"$\",\"br\",null,{}],\"If you only need single-threaded closures that take \",[\"$\",\"code\",null,{\"children\":\"Vec\u003cBox\u003cdyn Any\u003e\u003e\"}],\" and return nothing, it’s fine. However, since you mark EventBus as Sync, you might want Fn + Send + Sync for true thread safety, and replace RefCell with a thread-safe type like Mutex.\"]}]}],[\"$\",\"p\",null,{\"children\":\"Okay... Let's try on the API platform\"}],[\"$\",\"h3\",null,{\"id\":\"o1-apimedium-thinking\",\"children\":[[\"$\",\"a\",null,{\"href\":\"#o1-apimedium-thinking\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"icon icon-link\"}]}],\"O1 (API/Medium Thinking)\"]}],[\"$\",\"blockquote\",null,{\"children\":[\"$\",\"p\",null,{\"children\":[\"Request too large for o1 in organization org-6g94fxw3wiuDxcFSOYvukNgE on tokens per min (TPM): Limit 30000, Requested 100431. The input or output tokens must be reduced in order to run successfully. Visit \",[\"$\",\"a\",null,{\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://platform.openai.com/account/rate-limits\",\"children\":\"https://platform.openai.com/account/rate-limits\"}],\" to learn more.\"]}]}],[\"$\",\"p\",null,{\"children\":\"Okay... Pretty sure we are below the 30K token limit, unless it can predict how many tokens it will output?\"}],[\"$\",\"h3\",null,{\"id\":\"gpt-4o\",\"children\":[[\"$\",\"a\",null,{\"href\":\"#gpt-4o\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"icon icon-link\"}]}],\"GPT-4o\"]}],[\"$\",\"blockquote\",null,{\"children\":[\"$\",\"$L12\",null,{\"className\":\"language-js\",\"children\":[\"$\",\"code\",null,{\"className\":\"code-highlight\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"The\"}],\" type \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"of\"}],\" handlers \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"in\"}],\" your \",[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"EventBus\"}],\" struct is defined \",[\"$\",\"span\",null,{\"className\":\"token keyword module\",\"children\":\"as\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"RefCell\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"HashMap\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token class-name known-class-name\",\"children\":\"String\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"Box\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],\"dyn \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"Fn\"}]}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"Vec\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"Box\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],\"dyn \",[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"Any\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\u003e\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\u003e\u003e\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token property-access\",\"children\":[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"This\"}]}],\" means that you expect each event handler to be a \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"function\"}],\" or closure that takes a \",[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"Vec\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"Box\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],\"dyn \",[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"Any\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\u003e\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword module\",\"children\":\"as\"}],\" its argument\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token property-access\",\"children\":[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"In\"}]}],\" many event\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\"}],\"driven architectures\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" event handlers often take a more specific type or a reference to an event object to allow the handler to extract and use the information more effectively\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token property-access\",\"children\":[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"By\"}]}],\" using \",[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"Vec\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"Box\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],\"dyn \",[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"Any\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\u003e\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword control-flow\",\"children\":\"while\"}],\" flexible\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" you are forcing handlers to perform potentially unsafe type casts to retrieve the actual values they need\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token constant\",\"children\":\"A\"}],\" potentially more type\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\"}],\"safe approach could involve defining a trait or a struct \",[\"$\",\"span\",null,{\"className\":\"token keyword control-flow\",\"children\":\"for\"}],\" event arguments\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token property-access\",\"children\":[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"However\"}]}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword control-flow\",\"children\":\"if\"}],\" you prefer to keep the system \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"this\"}],\" flexible\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" then the current handler type is technically correct\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" albeit less type\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\"}],\"safe\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token property-access\",\"children\":[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"If\"}]}],\" you \",[\"$\",\"span\",null,{\"className\":\"token keyword control-flow\",\"children\":\"do\"}],\" want to enhance type safety\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" consider using strongly\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\"}],\"typed event arguments\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" such \",[\"$\",\"span\",null,{\"className\":\"token keyword module\",\"children\":\"as\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"pub trait \",[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"Event\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"Any\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"+\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"Send\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"+\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"Sync\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    fn \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"as_any\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\"}],\"self\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\"}],\"dyn \",[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"Any\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"pub struct \",[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"MyEvent\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    pub data\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name known-class-name\",\"children\":\"String\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"impl \",[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"Event\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword control-flow\",\"children\":\"for\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"MyEvent\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    fn \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"as_any\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\"}],\"self\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\"}],\"dyn \",[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"Any\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"        self\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"type \",[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"Handler\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"Box\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],\"dyn \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"Fn\"}]}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\"}],\"dyn \",[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"Event\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"This\"}],\" approach requires more design upfront but results \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"in\"}],\" greater type safety\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"\\n\"]}]]}]}]}],[\"$\",\"p\",null,{\"children\":\"Just some non-sense.\"}],[\"$\",\"h3\",null,{\"id\":\"gpt-45-preview\",\"children\":[[\"$\",\"a\",null,{\"href\":\"#gpt-45-preview\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"icon icon-link\"}]}],\"GPT-4.5-preview\"]}],[\"$\",\"blockquote\",null,{\"children\":[[\"$\",\"p\",null,{\"children\":[\"No, the type signature you've used in your \",[\"$\",\"code\",null,{\"children\":\"handlers\"}],\" field is problematic. Let's closely examine why it's problematic and how you can correct it:\"]}],[\"$\",\"h2\",null,{\"id\":\"original-problematic-definition\",\"children\":[[\"$\",\"a\",null,{\"href\":\"#original-problematic-definition\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"icon icon-link\"}]}],\"Original problematic definition:\"]}],[\"$\",\"$L12\",null,{\"className\":\"language-rust\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-rust code-highlight\",\"children\":[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"handlers\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"RefCell\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"HashMap\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"String\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Box\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"dyn\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Fn\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Vec\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Box\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"dyn\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Any\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\u003e\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\u003e\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\"\\n\"]}]}]}],[\"$\",\"p\",null,{\"children\":[\"The current signature represents a handler function that takes ownership of the vector of boxed arguments (\",[\"$\",\"code\",null,{\"children\":\"Vec\u003cBox\u003cdyn Any\u003e\u003e\"}],\"). While owning arguments is possible, this design may have these issues:\"]}],[\"$\",\"ol\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Ownership and usability\"}],\":\",[\"$\",\"br\",null,{}],\"Once you pass arguments to handlers, they take ownership from the event dispatcher permanently. This means your handlers may consume the arguments, and after that point, those arguments cannot be reused or accessed anymore in any manner.\"]}]}],[\"$\",\"li\",null,{\"children\":[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Single-handler restriction\"}],\":\",[\"$\",\"br\",null,{}],\"Your current signature implies that each event key (\",[\"$\",\"code\",null,{\"children\":\"\\\"WORKER_START\\\"\"}],\") maps to a \",[\"$\",\"strong\",null,{\"children\":\"single function handler\"}],\". Typically, an event system should be able to register \",[\"$\",\"strong\",null,{\"children\":\"multiple\"}],\" handlers per event.\"]}]}]]}],[\"$\",\"h2\",null,{\"id\":\"recommended-approach\",\"children\":[[\"$\",\"a\",null,{\"href\":\"#recommended-approach\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"icon icon-link\"}]}],\"Recommended approach:\"]}],[\"$\",\"h3\",null,{\"id\":\"1-multiple-handlers-per-event\",\"children\":[[\"$\",\"a\",null,{\"href\":\"#1-multiple-handlers-per-event\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"icon icon-link\"}]}],\"1) Multiple Handlers per Event\"]}],[\"$\",\"p\",null,{\"children\":\"Usually, you'd expect multiple listeners or subscribers for any given event:\"}],[\"$\",\"$L12\",null,{\"className\":\"language-rust\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-rust code-highlight\",\"children\":[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"handlers\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"RefCell\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"HashMap\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"String\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Vec\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Box\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"dyn\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Fn\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"[\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Box\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"dyn\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Any\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"]\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\u003e\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\u003e\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\"\\n\"]}]}]}],[\"$\",\"p\",null,{\"children\":[\"This new definition allows multiple handlers for the same event by using a vector (\",[\"$\",\"code\",null,{\"children\":\"Vec\"}],\") of callbacks.\"]}],[\"$\",\"h3\",null,{\"id\":\"2-arguments-passed-by-reference\",\"children\":[[\"$\",\"a\",null,{\"href\":\"#2-arguments-passed-by-reference\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"icon icon-link\"}]}],\"2) Arguments Passed by Reference\"]}],[\"$\",\"p\",null,{\"children\":[\"Passing a reference (\",[\"$\",\"code\",null,{\"children\":\"\u0026[Box\u003cdyn Any\u003e]\"}],\") rather than ownership improves usability and efficiency, and allows multiple handlers to inspect the arguments:\"]}],[\"$\",\"h3\",null,{\"id\":\"improved-definition\",\"children\":[[\"$\",\"a\",null,{\"href\":\"#improved-definition\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"icon icon-link\"}]}],\"Improved definition:\"]}],[\"$\",\"$L12\",null,{\"className\":\"language-rust\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-rust code-highlight\",\"children\":[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"handlers\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"RefCell\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"HashMap\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"String\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Vec\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Box\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"dyn\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Fn\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"[\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Box\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"dyn\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Any\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"]\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\u003e\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\u003e\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\"\\n\"]}]}]}],[\"$\",\"h3\",null,{\"id\":\"the-corrected-eventbus-structure-will-become\",\"children\":[[\"$\",\"a\",null,{\"href\":\"#the-corrected-eventbus-structure-will-become\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"icon icon-link\"}]}],\"The corrected \",[\"$\",\"code\",null,{\"children\":\"EventBus\"}],\" structure will become:\"]}],[\"$\",\"$L12\",null,{\"className\":\"language-rust\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-rust code-highlight\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"pub\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"struct\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name type-definition\",\"children\":\"EventBus\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    events\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"RefCell\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"HashMap\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"String\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Vec\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Box\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"dyn\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Any\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\u003e\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\u003e\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    handlers\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"RefCell\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"HashMap\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"String\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Vec\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Box\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"dyn\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Fn\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"[\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Box\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"dyn\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Any\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"]\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\u003e\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\u003e\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}]]}]}],[\"$\",\"h3\",null,{\"id\":\"corresponding-corrected-methods\",\"children\":[[\"$\",\"a\",null,{\"href\":\"#corresponding-corrected-methods\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"icon icon-link\"}]}],\"Corresponding corrected methods:\"]}],[\"$\",\"h4\",null,{\"id\":\"emission-method\",\"children\":[[\"$\",\"a\",null,{\"href\":\"#emission-method\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"icon icon-link\"}]}],\"Emission method:\"]}],[\"$\",\"$L12\",null,{\"className\":\"language-rust\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-rust code-highlight\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"pub\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"fn\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function function-definition\",\"children\":\"emit\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"self\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" event_name\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"str\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" args\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Vec\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Box\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"dyn\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Any\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\u003e\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"self\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"events\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"borrow_mut\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"insert\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"event_name\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"to_string\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" args\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}]]}]}],[\"$\",\"p\",null,{\"children\":[\"You emit the event with arguments once.\",[\"$\",\"br\",null,{}],\"When collecting, you iterate through stored events and for each corresponding handler, call the handlers with references.\"]}],[\"$\",\"h4\",null,{\"id\":\"registration-method\",\"children\":[[\"$\",\"a\",null,{\"href\":\"#registration-method\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"icon icon-link\"}]}],\"Registration method:\"]}],[\"$\",\"$L12\",null,{\"className\":\"language-rust\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-rust code-highlight\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"pub\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"fn\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function function-definition\",\"children\":\"register\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"F\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"self\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" event_name\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"str\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" func\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"F\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"where\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"F\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Fn\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"[\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Box\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"dyn\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Any\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"]\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"+\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token lifetime-annotation symbol\",\"children\":\"'static\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"self\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"handlers\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"borrow_mut\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"entry\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"event_name\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"to_string\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"or_default\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"push\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Box\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"new\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"func\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}]]}]}],[\"$\",\"p\",null,{\"children\":\"This provides a safer, more idiomatic Rust API allowing multiple handler registration.\"}],[\"$\",\"h4\",null,{\"id\":\"collecting-method-updated-accordingly\",\"children\":[[\"$\",\"a\",null,{\"href\":\"#collecting-method-updated-accordingly\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"icon icon-link\"}]}],\"Collecting method updated accordingly:\"]}],[\"$\",\"$L12\",null,{\"className\":\"language-rust\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-rust code-highlight\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"pub\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"fn\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function function-definition\",\"children\":\"collect\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"self\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// Register functions\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"self\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"register\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"WORKER_START\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token namespace\",\"children\":[\"hooks\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}]]}],\"print_something\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// Handle emitted events\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"let\"}],\" emitted_events \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"self\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"events\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"replace\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"HashMap\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"new\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    emitted_events\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"into_iter\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"for_each\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token closure-params\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation closure-punctuation\",\"children\":\"|\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"event_name\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" args\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation closure-punctuation\",\"children\":\"|\"}]]}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"if\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"let\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Some\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"handlers\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"self\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"handlers\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"borrow\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"get\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\"}],\"event_name\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"            \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"for\"}],\" handler \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"in\"}],\" handlers \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"                \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"handler\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\"}],\"args\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"            \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}]]}]}],[\"$\",\"h3\",null,{\"id\":\"conclusion\",\"children\":[[\"$\",\"a\",null,{\"href\":\"#conclusion\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"icon icon-link\"}]}],\"Conclusion:\"]}],[\"$\",\"p\",null,{\"children\":[\"Your current \",[\"$\",\"code\",null,{\"children\":\"handlers\"}],\" type signature is not ideal:\"]}],[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":\"You'd usually want multiple handlers for each event\"}],[\"$\",\"li\",null,{\"children\":\"You normally want handlers to borrow arguments via reference rather than taking ownership\"}]]}],[\"$\",\"p\",null,{\"children\":[\"So, updating \",[\"$\",\"code\",null,{\"children\":\"handlers\"}],\" to:\"]}],[\"$\",\"$L12\",null,{\"className\":\"language-rust\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-rust code-highlight\",\"children\":[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"handlers\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"RefCell\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"HashMap\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"String\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Vec\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Box\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"dyn\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Fn\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"[\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Box\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"dyn\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Any\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"]\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\u003e\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\u003e\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\"\\n\"]}]}]}],[\"$\",\"p\",null,{\"children\":\"will give you cleaner, idiomatic, and reusable code.\"}]]}],[\"$\",\"p\",null,{\"children\":\"Actually, this is pretty good. It caught two issues, the original and another one that has to do with ownership. It was a bit too pricey though consuming $0.12 for this single run.\"}],[\"$\",\"p\",null,{\"children\":\"Now how do these compare to the original GPT-3.5.\"}],[\"$\",\"h3\",null,{\"id\":\"gpt-35\",\"children\":[[\"$\",\"a\",null,{\"href\":\"#gpt-35\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"icon icon-link\"}]}],\"GPT-3.5\"]}],[\"$\",\"p\",null,{\"children\":\"Now how do these compare to the original GPT-3.5?\"}],[\"$\",\"blockquote\",null,{\"children\":[\"$\",\"p\",null,{\"children\":\"The handler is functionally correct for accepting a single vector of trait objects. Depending on your desired use case, the handler could be altered to also include the event name needed to parse the types of args or changed to handle the arguments as timely as they arrive. However, with the correct trait bounds added to the argument and implementation of handler, it should work fine.\"}]}],[\"$\",\"p\",null,{\"children\":\"Pretty useless though it is tuned-down on the insanity logic department. Can it be steered to a correct answer?\"}],[\"$\",\"blockquote\",null,{\"children\":[\"$\",\"p\",null,{\"children\":\"we are registering multiple functions for an event\"}]}],[\"$\",\"blockquote\",null,{\"children\":[[\"$\",\"p\",null,{\"children\":[\"If you want to register multiple functions for an event, you can modify the type of the handlers HashMap to allow storing multiple functions for a single event. One way to achieve this is to change the value type of the handlers HashMap to a vector of \",[\"$\",\"code\",null,{\"children\":\"Box\u003cdyn Fn(Vec\u003cBox\u003cdyn Any\u003e\u003e)\u003e\"}],\". Here's how you can modify the EventBus struct to support registering multiple functions for an event:\"]}],[\"$\",\"$L12\",null,{\"className\":\"language-rust\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-rust code-highlight\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"pub\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"struct\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name type-definition\",\"children\":\"EventBus\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    events\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"RefCell\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"HashMap\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"String\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Vec\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Box\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"dyn\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Any\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\u003e\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\u003e\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    handlers\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"RefCell\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"HashMap\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"String\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Vec\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Box\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"dyn\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Fn\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Vec\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Box\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"dyn\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Any\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\u003e\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\u003e\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"impl\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"EventBus\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// Other methods remain the same\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"pub\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"fn\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function function-definition\",\"children\":\"register\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"self\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" event_name\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"str\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" func\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Box\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"dyn\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Fn\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Vec\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Box\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"dyn\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Any\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\u003e\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// Check if the event_name already exists in the handlers HashMap\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"if\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"let\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Some\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"event_handlers\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"self\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"handlers\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"borrow_mut\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"get_mut\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"event_name\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"            \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// If the event_name exists, add the new function to the existing vector\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"            event_handlers\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"push\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"func\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"else\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"            \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// If the event_name does not exist, create a new vector with the function\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"            \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"self\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"handlers\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"borrow_mut\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"insert\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"event_name\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"to_string\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token macro property\",\"children\":\"vec!\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"[\"}],\"func\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"]\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// Additional method to unregister a function from an event\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"pub\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"fn\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function function-definition\",\"children\":\"unregister\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"self\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" event_name\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"str\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" func\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"dyn\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Fn\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Vec\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Box\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"dyn\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Any\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\u003e\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"if\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"let\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Some\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"event_handlers\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"self\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"handlers\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"borrow_mut\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"get_mut\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"event_name\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"            event_handlers\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"retain\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token closure-params\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation closure-punctuation\",\"children\":\"|\"}],\"handler\",[\"$\",\"span\",null,{\"className\":\"token punctuation closure-punctuation\",\"children\":\"|\"}]]}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"!\"}],[\"$\",\"span\",null,{\"className\":\"token namespace\",\"children\":[\"std\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}],\"ptr\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}]]}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"eq\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"handler\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"as_ref\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" func\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}]]}]}],[\"$\",\"p\",null,{\"children\":[\"With this modification, you can now register multiple functions for the same event using the \",[\"$\",\"code\",null,{\"children\":\"register\"}],\" method. The \",[\"$\",\"code\",null,{\"children\":\"unregister\"}],\" method allows you to remove a specific function from the list of handlers for an event.\"]}]]}],[\"$\",\"p\",null,{\"children\":[\"Yes, though it does add an additional \",[\"$\",\"code\",null,{\"children\":\"unregister\"}],\" method that we didn't ask for.\"]}],[\"$\",\"h2\",null,{\"id\":\"conclusion-1\",\"children\":[[\"$\",\"a\",null,{\"href\":\"#conclusion-1\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"icon icon-link\"}]}],\"Conclusion\"]}],[\"$\",\"ol\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":[\"Claude 3.7 and GPT-4.5-preview were both successful. GPT-4.5 gets two bonus points for its ownership finding while remaining on topic. Two because the ownership issue requires \",[\"$\",\"em\",null,{\"children\":\"thinking forward\"}],\" into the future.\"]}],[\"$\",\"li\",null,{\"children\":[\"GPT-3.5 ranks second for not going insane. O1 can rank just below it for \",[\"$\",\"em\",null,{\"children\":\"not saying\"}],\" much.\"]}],[\"$\",\"li\",null,{\"children\":\"Claude 3.5, DeepSeek R1 and GPT-4o were not successful but also steered us in a wrong direction.\"}],[\"$\",\"li\",null,{\"children\":\"Gemini 2.0 Pro should not be used.\"}]]}]],[\"$\",\"$L13\",null,{}]]}]}]]}]]}]]\n"])</script><script>self.__next_f.push([1,"7:[[\"$\",\"meta\",\"0\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}],[\"$\",\"meta\",\"1\",{\"charSet\":\"utf-8\"}],[\"$\",\"title\",\"2\",{\"children\":\"GPT-3.5 and the latest models | Omar Abid - Personal Blog\"}],[\"$\",\"meta\",\"3\",{\"name\":\"description\",\"content\":\"Comparing GPT-3.5 to the latest models.\"}],[\"$\",\"meta\",\"4\",{\"name\":\"robots\",\"content\":\"index, follow\"}],[\"$\",\"meta\",\"5\",{\"name\":\"googlebot\",\"content\":\"index, follow, max-video-preview:-1, max-image-preview:large, max-snippet:-1\"}],[\"$\",\"link\",\"6\",{\"rel\":\"canonical\",\"href\":\"https://omarabid.com/gpt3-now\"}],[\"$\",\"link\",\"7\",{\"rel\":\"alternate\",\"type\":\"application/rss+xml\",\"href\":\"https://omarabid.com/feed.xml\"}],[\"$\",\"meta\",\"8\",{\"property\":\"og:title\",\"content\":\"GPT-3.5 and the latest models\"}],[\"$\",\"meta\",\"9\",{\"property\":\"og:description\",\"content\":\"Comparing GPT-3.5 to the latest models.\"}],[\"$\",\"meta\",\"10\",{\"property\":\"og:url\",\"content\":\"https://omarabid.com/gpt3-now\"}],[\"$\",\"meta\",\"11\",{\"property\":\"og:site_name\",\"content\":\"Omar Abid - Personal Blog\"}],[\"$\",\"meta\",\"12\",{\"property\":\"og:locale\",\"content\":\"en_US\"}],[\"$\",\"meta\",\"13\",{\"property\":\"og:type\",\"content\":\"article\"}],[\"$\",\"meta\",\"14\",{\"property\":\"article:published_time\",\"content\":\"2025-03-12T00:00:00.000Z\"}],[\"$\",\"meta\",\"15\",{\"property\":\"article:modified_time\",\"content\":\"2025-03-12T00:00:00.000Z\"}],[\"$\",\"meta\",\"16\",{\"name\":\"twitter:card\",\"content\":\"summary_large_image\"}],[\"$\",\"meta\",\"17\",{\"name\":\"twitter:title\",\"content\":\"GPT-3.5 and the latest models\"}],[\"$\",\"meta\",\"18\",{\"name\":\"twitter:description\",\"content\":\"Comparing GPT-3.5 to the latest models.\"}],[\"$\",\"meta\",\"19\",{\"name\":\"next-size-adjust\"}]]\n"])</script><script>self.__next_f.push([1,"f:null\n"])</script><script>self.__next_f.push([1,""])</script></body></html>